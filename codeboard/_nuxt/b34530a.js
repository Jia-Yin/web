(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{775:function(e,t,r){var content=r(853);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(42).default)("597c869f",content,!0,{sourceMap:!1})},852:function(e,t,r){"use strict";r(775)},853:function(e,t,r){(t=r(41)(!1)).push([e.i,".container-fluid[data-v-05d5c620]{display:flex}.sectionA[data-v-05d5c620]{flex:2 2 0}.sectionA[data-v-05d5c620],.sectionB[data-v-05d5c620]{margin-top:24px;padding:10px;border:1px solid #d3d3d3}.sectionB[data-v-05d5c620]{flex:3 3 0}.scontent[data-v-05d5c620]{padding:6px 50px}h1[data-v-05d5c620]{font-size:120%;color:#00f;padding:12px}input[data-v-05d5c620]{display:inline-block;width:60%;vertical-align:bottom}p[data-v-05d5c620]{margin-top:18px}span[data-v-05d5c620]{display:inline-block;padding:6px}",""]),e.exports=t},912:function(e,t,r){"use strict";r.r(t);var n,o=r(0),c=(r(53),r(11)),l=(r(3),r(2),r(5),r(18),r(181),r(13)),d={data:function(){return{s_solved:{},s_submits:{},dupsolved:[],dupsubmits:[],totalsolved:0,totalsubmits:0,username:"",userid:null,usersummary:{},userallsubmits:{},usersolved:{},usersubmits:{},candidates:[],probnames:{}}},computed:{getUsername:function(){if(!this.userid||!this.users)return"N/A";for(var i=0;i<this.users.length;i++)if(this.users[i].id===this.userid)return this.users[i].name},usummary:function(){return this.userid&&this.usersummary[this.userid]||[]},usolved:function(){console.log("Usolved Called");var e=this.userid&&this.usersolved[this.userid]||[];return console.log("Usolved = ",e),e},usubmits:function(){return this.userid&&this.usersubmits[this.userid]||{}},usubmitslengths:function(){var e=Object.keys(this.usubmits),t=0;e&&(t=e.length);var r=0;return this.userallsubmits[this.userid]&&(r=this.userallsubmits[this.userid].length),"".concat(t," problems, ").concat(r," submits")},problems:function(){return this.$store.state.admin.problems},users:function(){return this.$store.state.admin.users},submits:function(){return this.$store.state.admin.submits},totalsummary:function(){return this.$store.state.admin.summary}},methods:(n={probnamearr:function(e){var t=this;return e?e.map((function(e){return t.probname(e)})):[]},probname:function(e){var t=this;return this.probnames[e]?this.probnames[e]:(t.$set(t.probnames,e,"載入中..."),l.c.collection("problems").doc(e).get().then((function(r){t.$set(t.probnames,e,r.data().name)})),e)},getUserSummary:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=[],o=t,r.next=4,l.c.collection("summary").where("user","==",e.id).get().then((function(t){t.empty||t.docs.forEach((function(e){var t=e.data();t.id=e.id,n.push(t)})),o.$set(o.usersummary,e.id,n)}));case 4:case"end":return r.stop()}}),r)})))()},findUser:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.users){t.next=3;break}return t.next=3,e.readUsers();case 3:for(e.candidates=[],i=0;i<e.users.length;i++)e.users[i].name.indexOf(e.username)>=0&&e.candidates.push(e.users[i]);case 5:case"end":return t.stop()}}),t)})))()},readSummary:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var i,r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.totalsummary){t.next=4;break}return t.next=3,e.$store.dispatch("admin/getCollection","summary");case 3:for(i=0;i<totalsummary.length;i++)"solved"===(r=totalsummary[i]).type&&(e.totalsolved++,s_solved[r.user]?(console.log("Duplicate Solved",r.user),dupsolved.push(r.user)):s_solved[r.user]=r.solved),"submits"===r.type&&(e.totalsubmits++,n=r.user+"/"+r.problem,s_submits[n]?(console.log("Duplicate Submits",n),dupsubmits.push(n)):s_submits[n]=r.submits);case 4:case"end":return t.stop()}}),t)})))()},readUsers:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$store.state.admin.users){t.next=3;break}return t.next=3,e.$store.dispatch("admin/getCollection","users");case 3:case"end":return t.stop()}}),t)})))()},readSubmits:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$store.state.admin.submits){t.next=3;break}return t.next=3,e.$store.dispatch("admin/getCollection","submits");case 3:case"end":return t.stop()}}),t)})))()},readProblems:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$store.state.admin.problems){t.next=3;break}return t.next=3,e.$store.dispatch("admin/getCollection","problems");case 3:case"end":return t.stop()}}),t)})))()},existed:function(e,t){for(var i=0;i<e.length;i++){if(e[i]===t)return!0}return!1},UpdateAllUsersSummary:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var i,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=0;case 1:if(!(i<e.users.length)){t.next=11;break}return r=e.users[i],console.log("Update User",r.name),t.next=6,e.selectUser(r);case 6:return t.next=8,e.writeUserSummary();case 8:i++,t.next=1;break;case 11:case"end":return t.stop()}}),t)})))()},selectUser:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(console.log("Select User Called",e.name),t.userid=e.id,t.usersubmits[e.id]){r.next=5;break}return r.next=5,t.createSummary(e);case 5:console.log("Select User Finished",e.name);case 6:case"end":return r.stop()}}),r)})))()},createSummary:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var n,o,c,l,d,code,m,f,h,v,x,w;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(console.log("Create Summary Called",e.name),console.log("UserID",t.userid),t.submits){r.next=5;break}return r.next=5,t.readSubmits();case 5:for(console.log("Submits",t.submits),(n=t.usersubmits[e.id])||(n=[],t.submits.forEach((function(t){t.user===e.id&&n.push(t)})),n=n.sort((function(a,b){return a.created>b.created?1:-1}))),console.log("User = ",e.name),console.log("Total User Submits Len = ",n.length),console.log("User Submits = ",n),o=[],c={code:""},l=0;l<n.length;l++)d=n[l],""===(code=d.code)?o.push(d.id):code===c.code?(o.push(c.id),c=d):c=d;for(console.log("Redundant records to delete",o.length,o),n=n.filter((function(e){return o.indexOf(e.id)<0})),t.userallsubmits[e.id]=n,console.log("Filtered user submits",n.length,n),m=[],f={},h=0;h<n.length;h++)v=n[h],x=0,"AC"===v.status&&(x=1,m.indexOf(v.problem)<0&&m.push(v.problem)),w=v.created+"/"+x+"/"+v.id,f[v.problem]?f[v.problem].push(w):f[v.problem]=[w];console.log("Summary Solved",m),console.log("Summary Submits",f),t.usersolved[e.id]=m,t.usersubmits[e.id]=f,console.log("Create Summary Finished",e.name);case 27:case"end":return r.stop()}}),r)})))()},writeUserSummary:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.c.collection("users").doc(e.userid).update({solved:e.usolved,submits:e.usubmits,timestamp:e.curtime()}).then((function(t){console.log("User Summary Updated",e.getUsername,t)}));case 2:case"end":return t.stop()}}),t)})))()},twod:function(e){return e<=9?"0"+e:e},curtime:function(){var e=new Date;return""+e.getFullYear()+this.twod(e.getMonth()+1)+this.twod(e.getDate())+this.twod(e.getHours())+this.twod(e.getMinutes())+this.twod(e.getSeconds())},processSolved:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var i,data;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(i=0;i<e.length;i++)uid=e[i],l.c.collection("summary").where("type","==","nonexist").get().then((function(e){console.log("Results",e),console.log("Results.docs",e.docs)})),data={type:"solved",user:uid,solved:t[uid]},l.c.collection("summary").add(data);case 1:case"end":return r.stop()}}),r)})))()}},Object(o.a)(n,"twod",(function(e){return e<=9?"0"+e:e})),Object(o.a)(n,"subtime",(function(e){var t=new Date;return e&&(t=new Date(e)),""+t.getFullYear()+this.twod(t.getMonth()+1)+this.twod(t.getDate())+this.twod(t.getHours())+this.twod(t.getMinutes())+this.twod(t.getSeconds())})),n)},m=(r(852),r(29)),component=Object(m.a)(d,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",{attrs:{fluid:""}},[r("section",{staticClass:"sectionA"},[r("p",[r("b-button",{attrs:{variant:"danger"},on:{click:e.UpdateAllUsersSummary}},[e._v("Update All Users Summary")])],1),e._v(" "),r("p",[e._v("All users = "+e._s(e.users&&e.users.length))]),e._v(" "),r("b-form-input",{model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),e._v(" "),r("b-button",{attrs:{variant:"success"},on:{click:e.findUser}},[e._v("Find User Summary")]),e._v(" "),e.candidates.length>0?r("div",e._l(e.candidates,(function(t,n){return r("p",{key:n},[r("b-button",{attrs:{variant:"outline-success"},on:{click:function(r){return e.selectUser(t)}}},[e._v("Select")]),e._v(" "),r("span",[e._v(e._s(n+1)+". "+e._s(t.name+" ("+t.email+")"))])],1)})),0):e._e()],1),e._v(" "),r("section",{staticClass:"sectionB"},[r("b-button",{attrs:{variant:"success"},on:{click:function(t){return e.writeUserSummary()}}},[e._v("Write User Summary")]),e._v("\n    "+e._s(e.getUsername)+"\n    "),r("p",[e._v("User Summary: "+e._s(e.usummary.length))]),e._v(" "),r("p",[e._v("User Solved: "+e._s(e.usolved.length))]),e._v(" "),r("ol",e._l(e.usolved,(function(t,n){return r("li",{key:n},[e._v(e._s(e.probname(t)))])})),0),e._v(" "),r("p",[e._v("User Submits: "+e._s(e.usubmitslengths))]),e._v(" "),r("ol",e._l(e.usubmits,(function(t,n){return r("li",{key:n},[e._v("\n        "+e._s(e.probname(n))+" : "+e._s(t.length))])})),0)],1)])}),[],!1,null,"05d5c620",null);t.default=component.exports}}]);