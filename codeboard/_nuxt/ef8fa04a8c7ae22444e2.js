(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{405:function(e,t,r){var content=r(474);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(31).default)("1dad4c25",content,!0,{sourceMap:!1})},473:function(e,t,r){"use strict";var n=r(405);r.n(n).a},474:function(e,t,r){(e.exports=r(30)(!1)).push([e.i,".container-fluid[data-v-48f7a7ac]{display:flex}.sectionA[data-v-48f7a7ac]{flex:2 2 0}.sectionA[data-v-48f7a7ac],.sectionB[data-v-48f7a7ac]{margin-top:24px;padding:10px;border:1px solid #d3d3d3}.sectionB[data-v-48f7a7ac]{flex:3 3 0}.scontent[data-v-48f7a7ac]{padding:6px 50px}h1[data-v-48f7a7ac]{font-size:120%;color:#00f;padding:12px}input[data-v-48f7a7ac]{display:inline-block;width:60%;vertical-align:bottom}p[data-v-48f7a7ac]{margin-top:18px}span[data-v-48f7a7ac]{display:inline-block;padding:6px}",""])},516:function(e,t,r){"use strict";r.r(t);var n,o,c,m,l,d,h,f,v,w,x,y,S,R,k,U,C,O=r(0),_=(r(22),r(41),r(10)),j=(r(33),r(11)),D={data:function(){return{s_solved:{},s_submits:{},dupsolved:[],dupsubmits:[],totalsolved:0,totalsubmits:0,username:"",semestername:"",userid:null,usersummary:{},userallsubmits:{},usersolved:{},usersubmits:{},candidates:[],probnames:{},tempSolvedName:"",tempSubmitsName:"",tempGroupsName:"",courseid:null}},mounted:(C=Object(_.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.$store.state.admin.users||this.$store.dispatch("admin/getCollection","users"),this.$store.state.admin.courses||this.$store.dispatch("admin/getCollection","courses");case 2:case"end":return e.stop()}}),e,this)}))),function(){return C.apply(this,arguments)}),computed:{getUsername:function(){if(!this.userid||!this.users)return"N/A";for(var i=0;i<this.users.length;i++)if(this.users[i].id===this.userid)return this.users[i].name},getCoursename:function(){if(!this.courseid||!this.courses)return"N/A";for(var i=0;i<this.courses.length;i++)if(this.courses[i].id===this.courseid)return this.courses[i].name},users:function(){return this.$store.state.admin.users},courses:function(){return this.$store.state.admin.courses}},methods:(n={setUsersSemesterName:function(){console.log("users = ",this.users);for(var i=0;i<this.users.length;i++)this.tempSolvedName="s"+this.semestername+"solved",this.tempSubmitsName="s"+this.semestername+"submits",this.userid=this.users[i].id,this.writeToUsersFireDb(i)},setCoursesSemesterName:function(){for(var i=0;i<this.courses.length;i++)this.tempGroupsName="s"+this.semestername+"groups",this.courseid=this.courses[i].id,this.writeToCoursesFireDb(i)},setSemesterName:function(){this.setUsersSemesterName(),this.setCoursesSemesterName()},clearCurrentData:function(){for(var i=0;i<this.users.length;i++)this.userid=this.users[i].id,this.clearUsersData();for(var e=0;e<this.courses.length;e++)this.courseid=this.courses[e].id,this.clearCoursesData()},writeToUsersFireDb:(U=Object(_.a)(regeneratorRuntime.mark((function e(t){var r,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.c.collection("users").doc(this.userid).update((r={},Object(O.a)(r,this.tempSolvedName,this.users[t].solved),Object(O.a)(r,this.tempSubmitsName,this.users[t].submits),r)).then((function(e){console.log("User.solved & submits Copy OK",n.getUsername,e)}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return U.apply(this,arguments)}),writeToCoursesFireDb:(k=Object(_.a)(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.c.collection("courses").doc(this.courseid).update(Object(O.a)({},this.tempGroupsName,this.courses[t].groups)).then((function(e){console.log("Courses.gropu Copy OK",r.getCoursename,e)}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)}),clearUsersData:(R=Object(_.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.c.collection("users").doc(this.userid).update({solved:[],submits:{}}).then((function(e){console.log("User.solved & submits Cleared",t.getUsername,e)}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return R.apply(this,arguments)}),clearCoursesData:(S=Object(_.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.c.collection("courses").doc(this.courseid).update({groups:[]}).then((function(e){console.log("Courses.groups Cleared",t.getCoursename,e)}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return S.apply(this,arguments)}),probnamearr:function(e){var t=this;return e?e.map((function(e){return t.probname(e)})):[]},probname:function(e){var t=this;return this.probnames[e]?this.probnames[e]:(t.$set(t.probnames,e,"載入中..."),j.c.collection("problems").doc(e).get().then((function(r){t.$set(t.probnames,e,r.data().name)})),e)},getUserSummary:(y=Object(_.a)(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],n=this,e.next=4,j.c.collection("summary").where("user","==",t.id).get().then((function(e){e.empty||e.docs.forEach((function(e){var t=e.data();t.id=e.id,r.push(t)})),n.$set(n.usersummary,t.id,r)}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)}),findUser:(x=Object(_.a)(regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.users){e.next=3;break}return e.next=3,this.readUsers();case 3:for(this.candidates=[],i=0;i<this.users.length;i++)this.users[i].name.indexOf(this.username)>=0&&this.candidates.push(this.users[i]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)}),readSummary:(w=Object(_.a)(regeneratorRuntime.mark((function e(){var i,t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.totalsummary){e.next=4;break}return e.next=3,this.$store.dispatch("admin/getCollection","summary");case 3:for(i=0;i<totalsummary.length;i++)"solved"===(t=totalsummary[i]).type&&(this.totalsolved++,s_solved[t.user]?(console.log("Duplicate Solved",t.user),dupsolved.push(t.user)):s_solved[t.user]=t.solved),"submits"===t.type&&(this.totalsubmits++,r=t.user+"/"+t.problem,s_submits[r]?(console.log("Duplicate Submits",r),dupsubmits.push(r)):s_submits[r]=t.submits);case 4:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)}),readUsers:(v=Object(_.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.$store.state.admin.users){e.next=3;break}return e.next=3,this.$store.dispatch("admin/getCollection","users");case 3:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)}),readSubmits:(f=Object(_.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.$store.state.admin.submits){e.next=3;break}return e.next=3,this.$store.dispatch("admin/getCollection","submits");case 3:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)}),readProblems:(h=Object(_.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.$store.state.admin.problems){e.next=3;break}return e.next=3,this.$store.dispatch("admin/getCollection","problems");case 3:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)}),existed:function(e,t){for(var i=0;i<e.length;i++){if(e[i]===t)return!0}return!1},UpdateAllUsersSummary:(d=Object(_.a)(regeneratorRuntime.mark((function e(){var i,t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=0;case 1:if(!(i<this.users.length)){e.next=11;break}return t=this.users[i],console.log("Update User",t.name),e.next=6,this.selectUser(t);case 6:return e.next=8,this.writeUserSummary();case 8:i++,e.next=1;break;case 11:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)}),selectUser:(l=Object(_.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Select User Called",t.name),this.userid=t.id,this.usersubmits[t.id]){e.next=5;break}return e.next=5,this.createSummary(t);case 5:console.log("Select User Finished",t.name);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)}),createSummary:(m=Object(_.a)(regeneratorRuntime.mark((function e(t){var r,n,o,c,m,code,l,d,h,f,v,w;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Create Summary Called",t.name),console.log("UserID",this.userid),this.submits){e.next=5;break}return e.next=5,this.readSubmits();case 5:for(console.log("Submits",this.submits),(r=this.usersubmits[t.id])||(r=[],this.submits.forEach((function(e){e.user===t.id&&r.push(e)})),r=r.sort((function(a,b){return a.created>b.created?1:-1}))),console.log("User = ",t.name),console.log("Total User Submits Len = ",r.length),console.log("User Submits = ",r),n=[],o={code:""},c=0;c<r.length;c++)m=r[c],""===(code=m.code)?n.push(m.id):code===o.code?(n.push(o.id),o=m):o=m;for(console.log("Redundant records to delete",n.length,n),r=r.filter((function(e){return n.indexOf(e.id)<0})),this.userallsubmits[t.id]=r,console.log("Filtered user submits",r.length,r),l=[],d={},h=0;h<r.length;h++)f=r[h],v=0,"AC"===f.status&&(v=1,l.indexOf(f.problem)<0&&l.push(f.problem)),w=f.created+"/"+v+"/"+f.id,d[f.problem]?d[f.problem].push(w):d[f.problem]=[w];console.log("Summary Solved",l),console.log("Summary Submits",d),this.usersolved[t.id]=l,this.usersubmits[t.id]=d,console.log("Create Summary Finished",t.name);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)}),writeUserSummary:(c=Object(_.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.c.collection("users").doc(this.userid).update({solved:this.usolved,submits:this.usubmits,timestamp:this.curtime()}).then((function(e){console.log("User Summary Updated",t.getUsername,e)}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)}),twod:function(e){return e<=9?"0"+e:e},curtime:function(){var e=new Date;return""+e.getFullYear()+this.twod(e.getMonth()+1)+this.twod(e.getDate())+this.twod(e.getHours())+this.twod(e.getMinutes())+this.twod(e.getSeconds())},processSolved:(o=Object(_.a)(regeneratorRuntime.mark((function e(t,r){var i,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=0;i<t.length;i++)uid=t[i],j.c.collection("summary").where("type","==","nonexist").get().then((function(e){console.log("Results",e),console.log("Results.docs",e.docs)})),data={type:"solved",user:uid,solved:r[uid]},j.c.collection("summary").add(data);case 1:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)})},Object(O.a)(n,"twod",(function(e){return e<=9?"0"+e:e})),Object(O.a)(n,"subtime",(function(e){var t=new Date;return e&&(t=new Date(e)),""+t.getFullYear()+this.twod(t.getMonth()+1)+this.twod(t.getDate())+this.twod(t.getHours())+this.twod(t.getMinutes())+this.twod(t.getSeconds())})),n)},N=(r(473),r(16)),component=Object(N.a)(D,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",{attrs:{fluid:""}},[r("section",{staticClass:"sectionA"},[r("h2",[e._v("請輸入舊學期的名稱")]),e._v(" "),r("b-form-input",{model:{value:e.semestername,callback:function(t){e.semestername=t},expression:"semestername"}}),e._v(" "),r("div",[r("li",[e._v("\n        按下此按鈕，會先複製以下舊資料\n        "),r("br"),e._v(" "),r("ol",[e._v("users.id.solved")]),e._v(" "),r("ol",[e._v("user.id.submits")]),e._v(" "),r("ol",[e._v("courses.id.groups")])]),e._v(" "),r("li",[e._v("將欄位名稱前面都加上「舊學期名稱」，例如︰輸入1081，複製的欄位名稱為s1081solved")]),e._v(" "),r("li",[e._v("最後將原本的三個欄位都清空")])]),e._v(" "),r("b-button",{attrs:{variant:"success"},on:{click:e.setSemesterName}},[e._v("Set Semester Name")]),e._v(" "),r("b-button",{attrs:{variant:"success"},on:{click:e.clearCurrentData}},[e._v("Clear Current Data")])],1)])}),[],!1,null,"48f7a7ac",null);t.default=component.exports}}]);