(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{774:function(e,t,r){var content=r(851);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(42).default)("1dad4c25",content,!0,{sourceMap:!1})},850:function(e,t,r){"use strict";r(774)},851:function(e,t,r){(t=r(41)(!1)).push([e.i,".container-fluid[data-v-48f7a7ac]{display:flex}.sectionA[data-v-48f7a7ac]{flex:2 2 0}.sectionA[data-v-48f7a7ac],.sectionB[data-v-48f7a7ac]{margin-top:24px;padding:10px;border:1px solid #d3d3d3}.sectionB[data-v-48f7a7ac]{flex:3 3 0}.scontent[data-v-48f7a7ac]{padding:6px 50px}h1[data-v-48f7a7ac]{font-size:120%;color:#00f;padding:12px}input[data-v-48f7a7ac]{display:inline-block;width:60%;vertical-align:bottom}p[data-v-48f7a7ac]{margin-top:18px}span[data-v-48f7a7ac]{display:inline-block;padding:6px}",""]),e.exports=t},911:function(e,t,r){"use strict";r.r(t);var n,o,c=r(0),m=(r(18),r(53),r(11)),d=(r(181),r(13)),l={data:function(){return{s_solved:{},s_submits:{},dupsolved:[],dupsubmits:[],totalsolved:0,totalsubmits:0,username:"",semestername:"",userid:null,usersummary:{},userallsubmits:{},usersolved:{},usersubmits:{},candidates:[],probnames:{},tempSolvedName:"",tempSubmitsName:"",tempGroupsName:"",courseid:null}},mounted:(o=Object(m.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.$store.state.admin.users||this.$store.dispatch("admin/getCollection","users"),this.$store.state.admin.courses||this.$store.dispatch("admin/getCollection","courses");case 2:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)}),computed:{getUsername:function(){if(!this.userid||!this.users)return"N/A";for(var i=0;i<this.users.length;i++)if(this.users[i].id===this.userid)return this.users[i].name},getCoursename:function(){if(!this.courseid||!this.courses)return"N/A";for(var i=0;i<this.courses.length;i++)if(this.courses[i].id===this.courseid)return this.courses[i].name},users:function(){return this.$store.state.admin.users},courses:function(){return this.$store.state.admin.courses}},methods:(n={setUsersSemesterName:function(){console.log("users = ",this.users);for(var i=0;i<this.users.length;i++)this.tempSolvedName="s"+this.semestername+"solved",this.tempSubmitsName="s"+this.semestername+"submits",this.userid=this.users[i].id,this.writeToUsersFireDb(i)},setCoursesSemesterName:function(){for(var i=0;i<this.courses.length;i++)this.tempGroupsName="s"+this.semestername+"groups",this.courseid=this.courses[i].id,this.writeToCoursesFireDb(i)},setSemesterName:function(){this.setUsersSemesterName(),this.setCoursesSemesterName()},clearCurrentData:function(){for(var i=0;i<this.users.length;i++)this.userid=this.users[i].id,this.clearUsersData();for(var e=0;e<this.courses.length;e++)this.courseid=this.courses[e].id,this.clearCoursesData()},writeToUsersFireDb:function(e){var t=this;return Object(m.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,d.c.collection("users").doc(t.userid).update((n={},Object(c.a)(n,t.tempSolvedName,t.users[e].solved),Object(c.a)(n,t.tempSubmitsName,t.users[e].submits),n)).then((function(e){console.log("User.solved & submits Copy OK",t.getUsername,e)}));case 2:case"end":return r.stop()}}),r)})))()},writeToCoursesFireDb:function(e){var t=this;return Object(m.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,d.c.collection("courses").doc(t.courseid).update(Object(c.a)({},t.tempGroupsName,t.courses[e].groups)).then((function(e){console.log("Courses.gropu Copy OK",t.getCoursename,e)}));case 2:case"end":return r.stop()}}),r)})))()},clearUsersData:function(){var e=this;return Object(m.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.c.collection("users").doc(e.userid).update({solved:[],submits:{}}).then((function(t){console.log("User.solved & submits Cleared",e.getUsername,t)}));case 2:case"end":return t.stop()}}),t)})))()},clearCoursesData:function(){var e=this;return Object(m.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.c.collection("courses").doc(e.courseid).update({groups:[]}).then((function(t){console.log("Courses.groups Cleared",e.getCoursename,t)}));case 2:case"end":return t.stop()}}),t)})))()},probnamearr:function(e){var t=this;return e?e.map((function(e){return t.probname(e)})):[]},probname:function(e){var t=this;return this.probnames[e]?this.probnames[e]:(t.$set(t.probnames,e,"載入中..."),d.c.collection("problems").doc(e).get().then((function(r){t.$set(t.probnames,e,r.data().name)})),e)},getUserSummary:function(e){var t=this;return Object(m.a)(regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=[],o=t,r.next=4,d.c.collection("summary").where("user","==",e.id).get().then((function(t){t.empty||t.docs.forEach((function(e){var t=e.data();t.id=e.id,n.push(t)})),o.$set(o.usersummary,e.id,n)}));case 4:case"end":return r.stop()}}),r)})))()},findUser:function(){var e=this;return Object(m.a)(regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.users){t.next=3;break}return t.next=3,e.readUsers();case 3:for(e.candidates=[],i=0;i<e.users.length;i++)e.users[i].name.indexOf(e.username)>=0&&e.candidates.push(e.users[i]);case 5:case"end":return t.stop()}}),t)})))()},readSummary:function(){var e=this;return Object(m.a)(regeneratorRuntime.mark((function t(){var i,r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.totalsummary){t.next=4;break}return t.next=3,e.$store.dispatch("admin/getCollection","summary");case 3:for(i=0;i<totalsummary.length;i++)"solved"===(r=totalsummary[i]).type&&(e.totalsolved++,s_solved[r.user]?(console.log("Duplicate Solved",r.user),dupsolved.push(r.user)):s_solved[r.user]=r.solved),"submits"===r.type&&(e.totalsubmits++,n=r.user+"/"+r.problem,s_submits[n]?(console.log("Duplicate Submits",n),dupsubmits.push(n)):s_submits[n]=r.submits);case 4:case"end":return t.stop()}}),t)})))()},readUsers:function(){var e=this;return Object(m.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$store.state.admin.users){t.next=3;break}return t.next=3,e.$store.dispatch("admin/getCollection","users");case 3:case"end":return t.stop()}}),t)})))()},readSubmits:function(){var e=this;return Object(m.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$store.state.admin.submits){t.next=3;break}return t.next=3,e.$store.dispatch("admin/getCollection","submits");case 3:case"end":return t.stop()}}),t)})))()},readProblems:function(){var e=this;return Object(m.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$store.state.admin.problems){t.next=3;break}return t.next=3,e.$store.dispatch("admin/getCollection","problems");case 3:case"end":return t.stop()}}),t)})))()},existed:function(e,t){for(var i=0;i<e.length;i++){if(e[i]===t)return!0}return!1},UpdateAllUsersSummary:function(){var e=this;return Object(m.a)(regeneratorRuntime.mark((function t(){var i,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=0;case 1:if(!(i<e.users.length)){t.next=11;break}return r=e.users[i],console.log("Update User",r.name),t.next=6,e.selectUser(r);case 6:return t.next=8,e.writeUserSummary();case 8:i++,t.next=1;break;case 11:case"end":return t.stop()}}),t)})))()},selectUser:function(e){var t=this;return Object(m.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(console.log("Select User Called",e.name),t.userid=e.id,t.usersubmits[e.id]){r.next=5;break}return r.next=5,t.createSummary(e);case 5:console.log("Select User Finished",e.name);case 6:case"end":return r.stop()}}),r)})))()},createSummary:function(e){var t=this;return Object(m.a)(regeneratorRuntime.mark((function r(){var n,o,c,m,d,code,l,f,h,v,w,x;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(console.log("Create Summary Called",e.name),console.log("UserID",t.userid),t.submits){r.next=5;break}return r.next=5,t.readSubmits();case 5:for(console.log("Submits",t.submits),(n=t.usersubmits[e.id])||(n=[],t.submits.forEach((function(t){t.user===e.id&&n.push(t)})),n=n.sort((function(a,b){return a.created>b.created?1:-1}))),console.log("User = ",e.name),console.log("Total User Submits Len = ",n.length),console.log("User Submits = ",n),o=[],c={code:""},m=0;m<n.length;m++)d=n[m],""===(code=d.code)?o.push(d.id):code===c.code?(o.push(c.id),c=d):c=d;for(console.log("Redundant records to delete",o.length,o),n=n.filter((function(e){return o.indexOf(e.id)<0})),t.userallsubmits[e.id]=n,console.log("Filtered user submits",n.length,n),l=[],f={},h=0;h<n.length;h++)v=n[h],w=0,"AC"===v.status&&(w=1,l.indexOf(v.problem)<0&&l.push(v.problem)),x=v.created+"/"+w+"/"+v.id,f[v.problem]?f[v.problem].push(x):f[v.problem]=[x];console.log("Summary Solved",l),console.log("Summary Submits",f),t.usersolved[e.id]=l,t.usersubmits[e.id]=f,console.log("Create Summary Finished",e.name);case 27:case"end":return r.stop()}}),r)})))()},writeUserSummary:function(){var e=this;return Object(m.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.c.collection("users").doc(e.userid).update({solved:e.usolved,submits:e.usubmits,timestamp:e.curtime()}).then((function(t){console.log("User Summary Updated",e.getUsername,t)}));case 2:case"end":return t.stop()}}),t)})))()},twod:function(e){return e<=9?"0"+e:e},curtime:function(){var e=new Date;return""+e.getFullYear()+this.twod(e.getMonth()+1)+this.twod(e.getDate())+this.twod(e.getHours())+this.twod(e.getMinutes())+this.twod(e.getSeconds())},processSolved:function(e,t){return Object(m.a)(regeneratorRuntime.mark((function r(){var i,data;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(i=0;i<e.length;i++)uid=e[i],d.c.collection("summary").where("type","==","nonexist").get().then((function(e){console.log("Results",e),console.log("Results.docs",e.docs)})),data={type:"solved",user:uid,solved:t[uid]},d.c.collection("summary").add(data);case 1:case"end":return r.stop()}}),r)})))()}},Object(c.a)(n,"twod",(function(e){return e<=9?"0"+e:e})),Object(c.a)(n,"subtime",(function(e){var t=new Date;return e&&(t=new Date(e)),""+t.getFullYear()+this.twod(t.getMonth()+1)+this.twod(t.getDate())+this.twod(t.getHours())+this.twod(t.getMinutes())+this.twod(t.getSeconds())})),n)},f=(r(850),r(29)),component=Object(f.a)(l,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",{attrs:{fluid:""}},[r("section",{staticClass:"sectionA"},[r("h2",[e._v("請輸入舊學期的名稱")]),e._v(" "),r("b-form-input",{model:{value:e.semestername,callback:function(t){e.semestername=t},expression:"semestername"}}),e._v(" "),r("div",[r("li",[e._v("\n        按下此按鈕，會先複製以下舊資料\n        "),r("br"),e._v(" "),r("ol",[e._v("users.id.solved")]),e._v(" "),r("ol",[e._v("user.id.submits")]),e._v(" "),r("ol",[e._v("courses.id.groups")])]),e._v(" "),r("li",[e._v("將欄位名稱前面都加上「舊學期名稱」，例如︰輸入1081，複製的欄位名稱為s1081solved")]),e._v(" "),r("li",[e._v("最後將原本的三個欄位都清空")])]),e._v(" "),r("b-button",{attrs:{variant:"success"},on:{click:e.setSemesterName}},[e._v("Set Semester Name")]),e._v(" "),r("b-button",{attrs:{variant:"success"},on:{click:e.clearCurrentData}},[e._v("Clear Current Data")])],1)])}),[],!1,null,"48f7a7ac",null);t.default=component.exports}}]);