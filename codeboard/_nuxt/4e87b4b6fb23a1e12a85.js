(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{405:function(e,t,r){var content=r(475);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(31).default)("597c869f",content,!0,{sourceMap:!1})},474:function(e,t,r){"use strict";var n=r(405);r.n(n).a},475:function(e,t,r){(e.exports=r(30)(!1)).push([e.i,".container-fluid[data-v-05d5c620]{display:flex}.sectionA[data-v-05d5c620]{flex:2 2 0}.sectionA[data-v-05d5c620],.sectionB[data-v-05d5c620]{margin-top:24px;padding:10px;border:1px solid #d3d3d3}.sectionB[data-v-05d5c620]{flex:3 3 0}.scontent[data-v-05d5c620]{padding:6px 50px}h1[data-v-05d5c620]{font-size:120%;color:#00f;padding:12px}input[data-v-05d5c620]{display:inline-block;width:60%;vertical-align:bottom}p[data-v-05d5c620]{margin-top:18px}span[data-v-05d5c620]{display:inline-block;padding:6px}",""])},516:function(e,t,r){"use strict";r.r(t);var n,o,c,l,d,m,h,f,v,y,x,w,_=r(0),U=(r(41),r(10)),S=(r(3),r(1),r(5),r(22),r(33),r(11)),k={data:function(){return{s_solved:{},s_submits:{},dupsolved:[],dupsubmits:[],totalsolved:0,totalsubmits:0,username:"",userid:null,usersummary:{},userallsubmits:{},usersolved:{},usersubmits:{},candidates:[],probnames:{}}},computed:{getUsername:function(){if(!this.userid||!this.users)return"N/A";for(var i=0;i<this.users.length;i++)if(this.users[i].id===this.userid)return this.users[i].name},usummary:function(){return this.userid&&this.usersummary[this.userid]||[]},usolved:function(){console.log("Usolved Called");var e=this.userid&&this.usersolved[this.userid]||[];return console.log("Usolved = ",e),e},usubmits:function(){return this.userid&&this.usersubmits[this.userid]||{}},usubmitslengths:function(){var e=Object.keys(this.usubmits),t=0;e&&(t=e.length);var r=0;return this.userallsubmits[this.userid]&&(r=this.userallsubmits[this.userid].length),"".concat(t," problems, ").concat(r," submits")},problems:function(){return this.$store.state.admin.problems},users:function(){return this.$store.state.admin.users},submits:function(){return this.$store.state.admin.submits},totalsummary:function(){return this.$store.state.admin.summary}},methods:(n={probnamearr:function(e){var t=this;return e?e.map((function(e){return t.probname(e)})):[]},probname:function(e){var t=this;return this.probnames[e]?this.probnames[e]:(t.$set(t.probnames,e,"載入中..."),S.c.collection("problems").doc(e).get().then((function(r){t.$set(t.probnames,e,r.data().name)})),e)},getUserSummary:(w=Object(U.a)(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],n=this,e.next=4,S.c.collection("summary").where("user","==",t.id).get().then((function(e){e.empty||e.docs.forEach((function(e){var t=e.data();t.id=e.id,r.push(t)})),n.$set(n.usersummary,t.id,r)}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)}),findUser:(x=Object(U.a)(regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.users){e.next=3;break}return e.next=3,this.readUsers();case 3:for(this.candidates=[],i=0;i<this.users.length;i++)this.users[i].name.indexOf(this.username)>=0&&this.candidates.push(this.users[i]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)}),readSummary:(y=Object(U.a)(regeneratorRuntime.mark((function e(){var i,t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.totalsummary){e.next=4;break}return e.next=3,this.$store.dispatch("admin/getCollection","summary");case 3:for(i=0;i<totalsummary.length;i++)"solved"===(t=totalsummary[i]).type&&(this.totalsolved++,s_solved[t.user]?(console.log("Duplicate Solved",t.user),dupsolved.push(t.user)):s_solved[t.user]=t.solved),"submits"===t.type&&(this.totalsubmits++,r=t.user+"/"+t.problem,s_submits[r]?(console.log("Duplicate Submits",r),dupsubmits.push(r)):s_submits[r]=t.submits);case 4:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)}),readUsers:(v=Object(U.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.$store.state.admin.users){e.next=3;break}return e.next=3,this.$store.dispatch("admin/getCollection","users");case 3:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)}),readSubmits:(f=Object(U.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.$store.state.admin.submits){e.next=3;break}return e.next=3,this.$store.dispatch("admin/getCollection","submits");case 3:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)}),readProblems:(h=Object(U.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.$store.state.admin.problems){e.next=3;break}return e.next=3,this.$store.dispatch("admin/getCollection","problems");case 3:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)}),existed:function(e,t){for(var i=0;i<e.length;i++){if(e[i]===t)return!0}return!1},UpdateAllUsersSummary:(m=Object(U.a)(regeneratorRuntime.mark((function e(){var i,t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=0;case 1:if(!(i<this.users.length)){e.next=11;break}return t=this.users[i],console.log("Update User",t.name),e.next=6,this.selectUser(t);case 6:return e.next=8,this.writeUserSummary();case 8:i++,e.next=1;break;case 11:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)}),selectUser:(d=Object(U.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Select User Called",t.name),this.userid=t.id,this.usersubmits[t.id]){e.next=5;break}return e.next=5,this.createSummary(t);case 5:console.log("Select User Finished",t.name);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)}),createSummary:(l=Object(U.a)(regeneratorRuntime.mark((function e(t){var r,n,o,c,l,code,d,m,h,f,v,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Create Summary Called",t.name),console.log("UserID",this.userid),this.submits){e.next=5;break}return e.next=5,this.readSubmits();case 5:for(console.log("Submits",this.submits),(r=this.usersubmits[t.id])||(r=[],this.submits.forEach((function(e){e.user===t.id&&r.push(e)})),r=r.sort((function(a,b){return a.created>b.created?1:-1}))),console.log("User = ",t.name),console.log("Total User Submits Len = ",r.length),console.log("User Submits = ",r),n=[],o={code:""},c=0;c<r.length;c++)l=r[c],""===(code=l.code)?n.push(l.id):code===o.code?(n.push(o.id),o=l):o=l;for(console.log("Redundant records to delete",n.length,n),r=r.filter((function(e){return n.indexOf(e.id)<0})),this.userallsubmits[t.id]=r,console.log("Filtered user submits",r.length,r),d=[],m={},h=0;h<r.length;h++)f=r[h],v=0,"AC"===f.status&&(v=1,d.indexOf(f.problem)<0&&d.push(f.problem)),y=f.created+"/"+v+"/"+f.id,m[f.problem]?m[f.problem].push(y):m[f.problem]=[y];console.log("Summary Solved",d),console.log("Summary Submits",m),this.usersolved[t.id]=d,this.usersubmits[t.id]=m,console.log("Create Summary Finished",t.name);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)}),writeUserSummary:(c=Object(U.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.c.collection("users").doc(this.userid).update({solved:this.usolved,submits:this.usubmits,timestamp:this.curtime()}).then((function(e){console.log("User Summary Updated",t.getUsername,e)}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)}),twod:function(e){return e<=9?"0"+e:e},curtime:function(){var e=new Date;return""+e.getFullYear()+this.twod(e.getMonth()+1)+this.twod(e.getDate())+this.twod(e.getHours())+this.twod(e.getMinutes())+this.twod(e.getSeconds())},processSolved:(o=Object(U.a)(regeneratorRuntime.mark((function e(t,r){var i,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=0;i<t.length;i++)uid=t[i],S.c.collection("summary").where("type","==","nonexist").get().then((function(e){console.log("Results",e),console.log("Results.docs",e.docs)})),data={type:"solved",user:uid,solved:r[uid]},S.c.collection("summary").add(data);case 1:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)})},Object(_.a)(n,"twod",(function(e){return e<=9?"0"+e:e})),Object(_.a)(n,"subtime",(function(e){var t=new Date;return e&&(t=new Date(e)),""+t.getFullYear()+this.twod(t.getMonth()+1)+this.twod(t.getDate())+this.twod(t.getHours())+this.twod(t.getMinutes())+this.twod(t.getSeconds())})),n)},R=(r(474),r(16)),component=Object(R.a)(k,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",{attrs:{fluid:""}},[r("section",{staticClass:"sectionA"},[r("p",[r("b-button",{attrs:{variant:"danger"},on:{click:e.UpdateAllUsersSummary}},[e._v("Update All Users Summary")])],1),e._v(" "),r("p",[e._v("All users = "+e._s(e.users&&e.users.length))]),e._v(" "),r("b-form-input",{model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),e._v(" "),r("b-button",{attrs:{variant:"success"},on:{click:e.findUser}},[e._v("Find User Summary")]),e._v(" "),e.candidates.length>0?r("div",e._l(e.candidates,(function(t,n){return r("p",{key:n},[r("b-button",{attrs:{variant:"outline-success"},on:{click:function(r){return e.selectUser(t)}}},[e._v("Select")]),e._v(" "),r("span",[e._v(e._s(n+1)+". "+e._s(t.name+" ("+t.email+")"))])],1)})),0):e._e()],1),e._v(" "),r("section",{staticClass:"sectionB"},[r("b-button",{attrs:{variant:"success"},on:{click:function(t){return e.writeUserSummary()}}},[e._v("Write User Summary")]),e._v("\n    "+e._s(e.getUsername)+"\n    "),r("p",[e._v("User Summary: "+e._s(e.usummary.length))]),e._v(" "),r("p",[e._v("User Solved: "+e._s(e.usolved.length))]),e._v(" "),r("ol",e._l(e.usolved,(function(t,n){return r("li",{key:n},[e._v(e._s(e.probname(t)))])})),0),e._v(" "),r("p",[e._v("User Submits: "+e._s(e.usubmitslengths))]),e._v(" "),r("ol",e._l(e.usubmits,(function(t,n){return r("li",{key:n},[e._v("\n        "+e._s(e.probname(n))+" : "+e._s(t.length))])})),0)],1)])}),[],!1,null,"05d5c620",null);t.default=component.exports}}]);