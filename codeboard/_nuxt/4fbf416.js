(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{759:function(t,e,r){"use strict";r(293)},767:function(t,e,r){var content=r(836);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(42).default)("264e03ca",content,!0,{sourceMap:!1})},835:function(t,e,r){"use strict";r(767)},836:function(t,e,r){(e=r(41)(!1)).push([t.i,'input[data-v-3ffe2373]{margin-left:12px;line-height:210%;border-radius:10px;width:300px;vertical-align:bottom}p[data-v-3ffe2373]{margin-top:12px}.row[data-v-3ffe2373]{display:flex;justify-content:space-between;margin:32px 0 18px}.filedata[data-v-3ffe2373]{text-align:left;max-height:70vh}.filedata[data-v-3ffe2373],.submitalert[data-v-3ffe2373]{position:fixed;left:30vw;top:20vh;padding:24px;width:40vw;background:#fafad2;border:8px solid #f08080;border-radius:24px;overflow:auto}.submitalert[data-v-3ffe2373]{text-align:center;max-height:60vh}.custom-file-input~.custom-file-label[data-v-3ffe2373]:after{content:"B";vertical-align:bottom}',""]),t.exports=e},903:function(t,e,r){"use strict";r.r(e);r(18),r(17),r(20),r(53);var n,o=r(11),l=r(13),c=r(181),d=(r(759),{data:function(){return{qstr:"",sid:"",showlen:24,showsubmit:!1,searchresults:[],file:null,fcontents:"",showfile:!1,iprobs:[]}},mounted:(n=Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.$store.state.admin.problems||this.$store.dispatch("admin/getCollection","problems"),this.$store.state.admin.users||this.$store.dispatch("admin/getCollection","users");case 2:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)}),computed:{mark:function(){return this.$store.state.admin.mark},users:function(){return this.$store.state.admin.users},problems:function(){return""===this.qstr?this.$store.state.admin.problems:this.$store.getters["admin/filter"]({dkey:"problems",dvalue:this.qstr})},submits:function(){return this.$store.state.admin.submits}},methods:{importProbs:function(){var t=this;this.iprobs.forEach((function(e){delete e.content.id,console.log("IMPORT",e.content),l.c.collection("problems").add(e.content).then((function(r){e.content.id=r.id,t.$store.commit("admin/addData",{dkey:"problems",dvalue:e.content})}))})),this.showfile=!1},handleFileUpload:function(){var t=this,e=new FileReader;e.onload=function(e){t.fcontents=e.target.result;for(var r=t.fcontents.split("\n"),n="HEAD",head="",content="",i=0;i<r.length;i++){var line=r[i];if(""!==line)if("HEAD"===n)head=line.replace(/^#\s*/,""),console.log("RES",head),n="CONTENT";else if("CONTENT"===n){content=JSON.parse(line),console.log(head,content),n="HEAD";var o={head:head,content:content};t.iprobs.push(o)}}console.log("import",t.iprobs),t.showfile=!0},e.readAsText(this.file)},saveStringToFile:function(t,data){var e=new Blob([data],{type:"text/plain;charset=utf-8"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(e,t);else{var r=window.document.createElement("a");r.href=window.URL.createObjectURL(e),r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r)}},exportProblem:function(){for(var text="",i=0;i<this.problems.length;i++){var t=this.problems[i];text+="# "+t.name+"\n\n",text+=JSON.stringify(t),text+="\n\n"}this.saveStringToFile("problems.txt",text)},toggleMark:function(){this.$store.commit("admin/toggleMark")},toggleItem:function(t){var e=this;this.$store.commit("admin/toggleItem",{dkey:"problems",dvalue:t.id}),this.toggleMark(),this.$nextTick((function(){e.toggleMark()}))},shorten:function(t){return t?t.length>this.showlen?t.slice(0,this.showlen)+"...":t:"Error"},totalnum:function(t){return this.submits?this.submits.filter((function(e){return e.problem===t.id})).length:0},passnum:function(t){return this.submits?this.submits.filter((function(e){return e.problem===t.id&&"AC"===e.status})).length:0},searchSubmit:function(){var t=this,e=this.sid.length,r=this.sid.charCodeAt(e-1),n=this.sid.substr(0,e-1)+String.fromCharCode(r+1);l.c.collection("submits").where(c.a.firestore.FieldPath.documentId(),">",this.sid).where(c.a.firestore.FieldPath.documentId(),"<=",n).get().then((function(e){var r=[];if(!e.empty)for(var n=e.docs,i=0;i<n.length;i++){var o=n[i].data();o.id=n[i].id,r.push(o)}t.showsubmit=!0,t.searchresults=r})).catch((function(t){console.log("Search Error: ",t)}))},debug:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var data;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e.$store.commit("person/setObjectField",{key:"path",field:"problem",value:e.problemBySubmit(t)}),data={code:t.code,lang:t.lang},e.$store.commit("person/setObjectField",{key:"savecodes",field:t.problem,value:data}),e.$router.push("/coding");case 4:case"end":return r.stop()}}),r)})))()},tryProblem:function(t){console.log("index 291, item = ",t),this.$store.commit("person/setObjectField",{key:"path",field:"problem",value:t}),this.$router.push("/coding")},viewProblem:function(t){this.$store.commit("person/setObjectField",{key:"path",field:"problem",value:t}),this.$router.push("/admin/problem/view")},deleteProblem:function(t){1==confirm("所有相關的資料都會被刪除！！確定要刪除嗎？（小心使用，刪除之後請登出再登入以刷新資料！）")&&this.$store.dispatch("admin/deleteProblem",t.id).then((function(){console.log("Problem Deleted!",t.id)}))},problemtitle:function(t){return t.name||t.title},problemBySubmit:function(t){if(this.problems)for(var i=0;i<this.problems.length;i++){var e=this.problems[i];if(e.id===t.problem)return e}return null},userBySubmit:function(t){if(this.users)for(var i=0;i<this.users.length;i++){var e=this.users[i];if(e.id===t.user)return e}return null},problemNameBySubmit:function(t){var e=this.problemBySubmit(t),r=this.userBySubmit(t),n="";return r&&(n+=r.name+"--"),e?n+"".concat(e.name," (").concat(t.id.slice(0,8),")"):"找不到"}}}),m=(r(835),r(29)),component=Object(m.a)(d,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-container",{attrs:{fluid:""}},[t.showsubmit?r("div",{staticClass:"submitalert",attrs:{show:""}},[r("b-container",[0==t.searchresults.length?r("div",[r("p",[t._v("找不到這個提交號碼！")])]):r("div",[r("p",[t._v("選哪一個？")]),t._v(" "),t._l(t.searchresults,(function(e,n){return r("p",{key:n},[r("b-button",{attrs:{pill:"",block:"",variant:"warning"},on:{click:function(r){return t.debug(e)}}},[t._v(t._s(t.problemNameBySubmit(e)))])],1)}))],2),t._v(" "),r("b-button",{attrs:{variant:"success"},on:{click:function(e){t.showsubmit=!1}}},[t._v("取消")])],1)],1):t._e(),t._v(" "),t.showfile?r("div",{staticClass:"filedata",attrs:{show:""}},[r("b-container",[r("b-button",{attrs:{variant:"success"},on:{click:function(e){t.showfile=!1}}},[t._v("取消")]),t._v(" "),r("b-button",{attrs:{variant:"success"},on:{click:t.importProbs}},[t._v("滙入")]),t._v(" "),t._l(t.iprobs,(function(e,n){return r("div",{key:n},[r("p",[t._v(t._s(e.head))]),t._v(" "),r("p",[t._v(t._s(e.content))])])}))],2)],1):t._e(),t._v(" "),r("b-row",[r("span",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.qstr,expression:"qstr"}],attrs:{type:"text",placeholder:" 搜尋..."},domProps:{value:t.qstr},on:{input:function(e){e.target.composing||(t.qstr=e.target.value)}}}),t._v("  \n      "),r("b-button",{attrs:{pill:"",variant:"outline-primary",to:"/admin/problem/new"}},[t._v("新增")]),t._v(" "),t.mark?r("span",[r("b-button",{attrs:{pill:"",variant:"primary"},on:{click:function(e){return t.toggleMark()}}},[t._v("標記")])],1):r("span",[r("b-button",{attrs:{pill:"",variant:"outline-primary"},on:{click:function(e){return t.toggleMark()}}},[t._v("標記")])],1),t._v(" "),r("b-button",{attrs:{pill:"",variant:"outline-primary"},on:{click:function(e){return t.exportProblem()}}},[t._v("匯出")]),t._v(" "),r("b-form-file",{staticClass:"mx-4",staticStyle:{display:"inline-block",width:"300px"},attrs:{placeholder:"選擇檔案匯入","drop-placeholder":"把檔案拖到這裡來..."},on:{input:function(e){return t.handleFileUpload()}},model:{value:t.file,callback:function(e){t.file=e},expression:"file"}})],1),t._v(" "),r("span",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.sid,expression:"sid"}],attrs:{type:"text",placeholder:" 提交號碼..."},domProps:{value:t.sid},on:{input:function(e){e.target.composing||(t.sid=e.target.value)}}}),t._v("  \n      "),r("b-button",{attrs:{pill:"",variant:"outline-primary",disabled:""==t.sid},on:{click:t.searchSubmit}},[t._v("尋找")])],1)]),t._v(" "),r("table",{staticClass:"table table-hover table-striped"},[r("thead",[r("tr",[r("th",{attrs:{scope:"col"}},[t._v("#")]),t._v(" "),r("th",{attrs:{scope:"col"}},[t._v("題目")]),t._v(" "),r("th",{attrs:{scope:"col"}},[t._v("描述")]),t._v(" "),r("th",{attrs:{scope:"col"}},[t._v("提交")]),t._v(" "),r("th",{attrs:{scope:"col"}},[t._v("通過")]),t._v(" "),r("th",{attrs:{scope:"col"}},[t._v("通過率")]),t._v(" "),r("th",{attrs:{scope:"col"}},[t._v("操作")])])]),t._v(" "),r("tbody",t._l(t.problems,(function(e,n){return r("tr",{key:n},[r("td",[t._v(t._s(n+1))]),t._v(" "),r("td",[t._v(t._s(t.problemtitle(e)))]),t._v(" "),r("td",[t._v(t._s(t.shorten(e.description)))]),t._v(" "),r("td",[t._v(t._s(t.totalnum(e)))]),t._v(" "),r("td",[t._v(t._s(t.passnum(e)))]),t._v(" "),r("td",[t._v(t._s(Math.floor(100*t.passnum(e)/t.totalnum(e))/100))]),t._v(" "),r("td",[t.mark?r("span",[r("b-form-checkbox",{attrs:{checked:e.mark},on:{change:function(r){return t.toggleItem(e)}}})],1):r("span",[r("b-button",{attrs:{size:"sm",pill:"",variant:"outline-primary"},on:{click:function(r){return t.tryProblem(e)}}},[r("fa",{attrs:{icon:"play-circle"}})],1),t._v(" "),r("b-button",{attrs:{size:"sm",pill:"",variant:"outline-primary"},on:{click:function(r){return t.viewProblem(e)}}},[r("fa",{attrs:{icon:["far","eye"]}})],1),t._v(" "),r("b-button",{attrs:{size:"sm",pill:"",variant:"outline-primary"},on:{click:function(r){return t.deleteProblem(e)}}},[r("fa",{attrs:{icon:["far","trash-alt"]}})],1)],1)])])})),0)])],1)}),[],!1,null,"3ffe2373",null);e.default=component.exports}}]);