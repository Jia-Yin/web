(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{831:function(t,e,r){"use strict";var n=r(22),o=r(832),l=r(282),c=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(l);n(n.P+n.F*c,"String",{padStart:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},832:function(t,e,r){var n=r(49),o=r(283),l=r(53);t.exports=function(t,e,r,c){var d=String(l(t)),m=d.length,h=void 0===r?" ":String(r),f=n(e);if(f<=m||""==h)return d;var v=f-m,x=o.call(h,Math.ceil(v/h.length));return x.length>v&&(x=x.slice(0,v)),c?x+d:d+x}},855:function(t,e,r){"use strict";r.r(e);r(5),r(2),r(3),r(1),r(4),r(831),r(59);var n=r(14),o=r(0),l=r(738),c=r.n(l),d=r(760),m=r(761),h=r(762),f=r(763),v=r(99);function x(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}var y={middleware:["authenticated"],layout:"answer",components:{RTSingle:d.a,RTFillin:m.a,FuncTest:h.a,ProgTest:f.a},data:function(){return{time:10,timer:null,index:0,numCorrect:0,totalScore:0,lastskip:1e6,skip:!1,finished:!1,problems:[],exam:null,selectedquizzes:{},listidx:[],record:{userid:null,examid:null,date:null,submits:[],score:0}}},computed:function(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?x(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):x(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}({ready:function(){return this.problems&&this.problems.length>0}},Object(v.b)({user:function(t){return t.user},exams:function(t){return t.exams},quizzes:function(t){return t.quizzes}})),created:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t.$store.state.params.examid&&t.$router.push("/admin/examlist"),!t.quizzes||0!==t.quizzes.length){e.next=4;break}return e.next=4,t.$store.dispatch("getCollection","quizzes").then((function(){}));case 4:if(!t.exams||0!==t.exams.length){e.next=7;break}return e.next=7,t.$store.dispatch("getCollection","exams").then((function(){}));case 7:t.$store.dispatch("getCollectionItem",{collection:"exams",id:t.$store.state.params.examid}).then((function(e){console.log("Get Exam",e),t.setExam(e),t.record.userid=t.user.id,t.record.examid=e.id,t.record.date=t.getToday(),t.score=0,t.submits=[]}));case 8:case"end":return e.stop()}}),e)})))()},mounted:function(){var t=this;console.log("Start timer"),this.timer=setInterval((function(){t.time--,0===t.time&&t.leave()}),1e3)},methods:{getToday:function(){var t=new Date,dd=String(t.getDate()).padStart(2,"0"),e=String(t.getMonth()+1).padStart(2,"0");return t.getFullYear()+e+dd},getquizscore:function(t,e){for(var i=0;i<t.probs.length;i++)if(e===t.probs[i].id)return t.probs[i].score;return 0},getquiztime:function(t,e){for(var i=0;i<t.probs.length;i++)if(e===t.probs[i].id)return t.probs[i].timelimit;return 30},setExam:function(t){for(var e=t.probs.map((function(t){return t.id})),r=[],n=[],o=[],l=[],i=0;i<this.quizzes.length;i++){var d=this.quizzes[i];e.indexOf(d.id)>=0&&(this.selectedquizzes[d.id]=d,"singlechoice"===d.type?r.push(d.id):"fillin"===d.type?n.push(d.id):"functest"===d.type?o.push(d.id):"progtest"===d.type&&l.push(d.id))}r=c.a.shuffle(r),n=c.a.shuffle(n),o=c.a.shuffle(o),l=c.a.shuffle(l),this.listidx=r.concat(n,o,l);for(var m=[],h=0;h<this.listidx.length;h++){var f=this.listidx[h],v=JSON.parse(JSON.stringify(this.selectedquizzes[f]));v.timelimit=this.getquiztime(t,f),v.score=this.getquizscore(t,f),m.push(v)}this.time=t.timelimit,this.problems=m},skipproblem:function(){this.lastskip>this.time+1&&(this.lastskip=this.time,this.skip=!0)},submit:function(t){var e=this;if(console.log("Answer = ",t),t.correct&&(this.totalScore+=this.problems[this.index].score),t.qid=this.problems[this.index].id,this.record.submits.push(t),this.record.score=this.totalScore,console.log("Record = ",this.record),0==this.index)this.$store.dispatch("createAnswer",this.record).then((function(t){console.log("FS: Answer created, id = ",t),e.record.id=t}));else{var data={id:this.record.id,updates:{submits:this.record.submits,score:this.totalScore}};this.$store.dispatch("updateAnswer",data).then((function(){console.log("FS: Answer updated!")}))}!this.finished&&this.index<this.problems.length-1?(this.skip=!1,this.index++):(console.log("Finished, Leave Out!"),this.leave())},leave:function(){var t=this;clearInterval(this.timer),this.skip=!0,this.finished=!0,setTimeout((function(){t.$router.push("/end")}),100)},pad:function(t){return("0"+t).slice(-2)},hhmmss:function(t){var e=Math.floor(t/60);t%=60;var r=Math.floor(e/60);return e%=60,"".concat(this.pad(r),":").concat(this.pad(e),":").concat(this.pad(t))}}},k=r(31),component=Object(k.a)(y,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-container",[r("b-navbar",{attrs:{variant:"light"}},[r("b-navbar-nav",{staticClass:"mr-auto"},[r("b-nav-text",{staticClass:"text-dark"},[t._v(t._s(t.user&&t.user.name))])],1),t._v(" "),r("b-navbar-nav",{staticClass:"mr-auto"},[r("b-nav-text",{staticClass:"text-primary"},[t._v("總共剩餘時間 "+t._s(t.hhmmss(t.time)))])],1),t._v(" "),r("b-navbar-nav",{staticClass:"mr-auto"},[r("b-button",{staticClass:"ml-3 btn-sm btn-outline-success",attrs:{variant:"outline-success"},on:{click:function(e){return t.skipproblem()}}},[t._v("跳過本題")]),t._v(" "),r("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.modal-leave",modifiers:{"modal-leave":!0}}],staticClass:"ml-3 btn btn-sm btn-outline-danger",attrs:{variant:"outline-danger"}},[t._v("離開考場")]),t._v(" "),r("b-modal",{attrs:{id:"modal-leave",title:"溫馨提醒","ok-title":"確定","cancel-title":"取消","no-close-on-esc":!0,"no-close-on-backdrop":!0},on:{ok:function(e){return t.leave()}}},[r("p",{staticClass:"mt-4 text-danger"},[t._v("此視窗顯示時，計時不會暫停。")]),t._v(" "),r("p",{staticClass:"my-4 text-danger"},[t._v("\n          離開考場等於交卷，不得再次進入！\n          "),r("br"),t._v("確定要離開嗎？\n        ")])])],1),t._v(" "),r("b-navbar-nav",[r("b-nav-text",{staticClass:"text-dark"},[t._v(t._s(t.index+1)+" / "+t._s(t.problems&&t.problems.length))])],1)],1),t._v(" "),t.ready&&"singlechoice"==t.problems[t.index].type?r("RTSingle",{key:t.index,attrs:{shuffle:!0,times:t.problems[t.index].timelimit,quiz:t.problems[t.index],submit:t.submit,skip:t.skip}}):t._e(),t._v(" "),t.ready&&"fillin"==t.problems[t.index].type?r("RTFillin",{key:t.index,attrs:{times:t.problems[t.index].timelimit,quiz:t.problems[t.index],submit:t.submit,skip:t.skip}}):t._e(),t._v(" "),t.ready&&"functest"==t.problems[t.index].type?r("FuncTest",{key:t.index,attrs:{times:t.problems[t.index].timelimit,quiz:t.problems[t.index],submit:t.submit,skip:t.skip}}):t._e(),t._v(" "),t.ready&&"progtest"==t.problems[t.index].type?r("ProgTest",{key:t.index,attrs:{times:t.problems[t.index].timelimit,quiz:t.problems[t.index],submit:t.submit,skip:t.skip}}):t._e()],1)}),[],!1,null,null,null);e.default=component.exports}}]);