(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{744:function(e,t,r){"use strict";r(745);var n={pad:function(e){return("0"+e).slice(-2)},mmss:function(e){var t=Math.floor(e/60);return e%=60,"".concat(this.pad(t),":").concat(this.pad(e))},hhmmss:function(e){var t=Math.floor(e/60);e%=60;var r=Math.floor(t/60);return t%=60,"".concat(this.pad(r),":").concat(this.pad(t),":").concat(this.pad(e))},getToday:function(){var e=new Date,dd=String(e.getDate()).padStart(2,"0"),t=String(e.getMonth()+1).padStart(2,"0");return e.getFullYear()+t+dd}};t.a=n},745:function(e,t,r){"use strict";var n=r(23),o=r(746),l=r(285),c=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(l);n(n.P+n.F*c,"String",{padStart:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0,!0)}})},746:function(e,t,r){var n=r(50),o=r(286),l=r(52);e.exports=function(e,t,r,c){var f=String(l(e)),m=f.length,d=void 0===r?" ":String(r),h=n(t);if(h<=m||""==d)return f;var v=h-m,x=o.call(d,Math.ceil(v/d.length));return x.length>v&&(x=x.slice(0,v)),c?x+f:f+x}},772:function(e,t,r){var content=r(821);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(40).default)("cd66f6de",content,!0,{sourceMap:!1})},773:function(e,t,r){var content=r(823);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(40).default)("3e4f83d8",content,!0,{sourceMap:!1})},820:function(e,t,r){"use strict";var n=r(772);r.n(n).a},821:function(e,t,r){(t=r(39)(!1)).push([e.i,".modal-content[data-v-5ea817ae]{position:fixed;left:365px;top:365px;width:50%;height:50%;background:#e0ffff}",""]),e.exports=t},822:function(e,t,r){"use strict";var n=r(773);r.n(n).a},823:function(e,t,r){(t=r(39)(!1)).push([e.i,".modal-content[data-v-52431adf]{position:fixed;left:365px;top:365px;width:50%;height:50%;background:#e0ffff}",""]),e.exports=t},894:function(e,t,r){"use strict";r.r(t);r(5),r(2),r(20),r(3),r(1),r(4),r(58);var n=r(14),o=r(0),l=r(100),c=r(744);function f(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}var m={data:function(){return{items:[],fields:[{key:"user",label:"User",sortable:!0,sortDirection:"desc"},{key:"score",label:"Score",sortable:!0},{key:"details",label:"Details",sortable:!1},{key:"actions",label:"Action",class:"text-center"}],totalRows:1,currentPage:1,perPage:5,pageOptions:[5,10,15],sortBy:"",sortDesc:!1,sortDirection:"asc",filter:null,filterOn:[],todel:null,cacheexam:{}}},computed:function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):f(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},Object(l.b)({user:function(e){return e.user},quizzes:function(e){return e.quizzes},exams:function(e){return e.exams}})),mounted:function(){},created:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.quizzes||0!==e.quizzes.length){t.next=3;break}return t.next=3,e.$store.dispatch("getCollection","quizzes").then((function(){}));case 3:if(!e.exams||0!==e.exams.length){t.next=6;break}return t.next=6,e.$store.dispatch("getCollection","exams").then((function(){e.totalRows=e.exams.length}));case 6:case"end":return t.stop()}}),t)})))()},methods:{onFiltered:function(e){this.totalRows=e.length,this.currentPage=1},exportscore:function(){},mmss:function(e){return c.a.mmss(e)},hhmmss:function(e){return c.a.hhmmss(e)}},watch:{}},d=(r(820),r(33)),h=Object(d.a)(m,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"qpanel"},[r("b-row",[r("b-col",{staticClass:"my-1",attrs:{md:"4"}},[r("b-form-group",{staticClass:"mb-0",attrs:{label:"Filter","label-cols-sm":"3","label-align-sm":"right","label-size":"sm","label-for":"filterInput"}},[r("b-input-group",{attrs:{size:"sm"}},[r("b-form-input",{attrs:{type:"search",id:"filterInput",placeholder:"Type to Search"},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}}),e._v(" "),r("b-input-group-append",[r("b-button",{attrs:{disabled:!e.filter},on:{click:function(t){e.filter=""}}},[e._v("Clear")])],1)],1)],1)],1),e._v(" "),r("b-col",{staticClass:"my-1",attrs:{md:"2"}},[r("b-form-group",{staticClass:"mb-0",attrs:{label:"N","label-cols-sm":"6","label-cols-md":"4","label-cols-lg":"3","label-align-sm":"right","label-size":"sm","label-for":"perPageSelect"}},[r("b-form-select",{attrs:{id:"perPageSelect",size:"sm",options:e.pageOptions},model:{value:e.perPage,callback:function(t){e.perPage=t},expression:"perPage"}})],1)],1),e._v(" "),r("b-col",{staticClass:"my-1",attrs:{md:"6"}},[r("b-pagination",{staticClass:"my-0",attrs:{"total-rows":e.totalRows,"per-page":e.perPage,align:"fill",size:"sm"},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}})],1)],1),e._v(" "),r("b-table",{staticClass:"mt-3",attrs:{"show-empty":"",small:"",stacked:"md",selectable:!0,"select-mode":"range",items:e.items,fields:e.fields,"current-page":e.currentPage,"per-page":e.perPage,filter:e.filter,filterIncludedFields:e.filterOn,"sort-by":e.sortBy,"sort-desc":e.sortDesc,"sort-direction":e.sortDirection},on:{"update:sortBy":function(t){e.sortBy=t},"update:sort-by":function(t){e.sortBy=t},"update:sortDesc":function(t){e.sortDesc=t},"update:sort-desc":function(t){e.sortDesc=t},filtered:e.onFiltered},scopedSlots:e._u([{key:"cell(actions)",fn:function(t){return[r("b-button-group",[r("b-button",{attrs:{size:"sm",variant:"outline-primary"},on:{click:function(r){return e.exportscore(t.item)}}},[e._v("\n          Export\n        ")])],1)]}}])})],1)}),[],!1,null,"5ea817ae",null).exports;function v(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}var x={data:function(){return{items:[],fields:[{key:"title",label:"Title",sortable:!0,sortDirection:"desc"},{key:"totalscore",label:"Score",sortable:!0},{key:"timelimit",label:"Time",sortable:!0},{key:"usercount",label:"User Count",sortable:!0}],totalRows:1,currentPage:1,perPage:5,pageOptions:[5,10,15],sortBy:"",sortDesc:!1,sortDirection:"asc",filter:null,filterOn:[],todel:null,cachequiz:{}}},computed:function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?v(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):v(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},Object(l.b)({user:function(e){return e.user},quizzes:function(e){return e.quizzes},exams:function(e){return e.exams},params:function(e){return e.params}})),mounted:function(){this.totalRows=this.items.length},created:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.quizzes||0!==e.quizzes.length){t.next=3;break}return t.next=3,e.$store.dispatch("getCollection","quizzes").then((function(){}));case 3:if(!e.exams||0!==e.exams.length){t.next=6;break}return t.next=6,e.$store.dispatch("getCollection","exams").then((function(){}));case 6:e.items=e.exams.map((function(t){var r=JSON.parse(JSON.stringify(t));return e.params.examcount&&e.params.examcount[t.id]?r.usercount=e.params.examcount[t.id]:r.usercount=-1,r})),e.totalRows=e.items.length;case 8:case"end":return t.stop()}}),t)})))()},methods:{onRowSelected:function(e){this.$emit("rowSelected",e)},onFiltered:function(e){this.totalRows=e.length,this.currentPage=1},quizbyid:function(e){if(this.cachequiz[e])return this.cachequiz[e];for(var i=0;i<this.quizzes.length;i++)if(this.quizzes[i].id===e)return this.cachequiz[e]=this.quizzes[i],this.quizzes[i];return null},quiztitle:function(e){if(this.cachequiztitle[e])return this.cachequiztitle[e];for(var i=0;i<this.quizzes.length;i++)if(this.quizzes[i].id===e)return this.cachequiztitle[e]=this.quizzes[i].title,this.quizzes[i].title;return"Unknown"},mmss:function(e){return c.a.mmss(e)},hhmmss:function(e){return c.a.hhmmss(e)}},watch:{exams:function(e){this.totalRows=this.exams.length}}},y=(r(822),Object(d.a)(x,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"qpanel"},[r("b-row",[r("b-col",{staticClass:"my-1",attrs:{md:"4"}},[r("b-form-group",{staticClass:"mb-0",attrs:{label:"Filter","label-cols-sm":"3","label-align-sm":"right","label-size":"sm","label-for":"filterInput"}},[r("b-input-group",{attrs:{size:"sm"}},[r("b-form-input",{attrs:{type:"search",id:"filterInput",placeholder:"Type to Search"},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}}),e._v(" "),r("b-input-group-append",[r("b-button",{attrs:{disabled:!e.filter},on:{click:function(t){e.filter=""}}},[e._v("Clear")])],1)],1)],1)],1),e._v(" "),r("b-col",{staticClass:"my-1",attrs:{md:"2"}},[r("b-form-group",{staticClass:"mb-0",attrs:{label:"N","label-cols-sm":"6","label-cols-md":"4","label-cols-lg":"3","label-align-sm":"right","label-size":"sm","label-for":"perPageSelect"}},[r("b-form-select",{attrs:{id:"perPageSelect",size:"sm",options:e.pageOptions},model:{value:e.perPage,callback:function(t){e.perPage=t},expression:"perPage"}})],1)],1),e._v(" "),r("b-col",{staticClass:"my-1",attrs:{md:"6"}},[r("b-pagination",{staticClass:"my-0",attrs:{"total-rows":e.totalRows,"per-page":e.perPage,align:"fill",size:"sm"},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}})],1)],1),e._v(" "),r("b-modal",{attrs:{id:"modal-delete",title:"確認刪除"},on:{ok:function(t){return e.deleteexam()}}},[r("p",{staticClass:"my-4"},[e._v(e._s(e.todel&&e.todel.title))])]),e._v(" "),r("b-table",{staticClass:"mt-3",attrs:{"show-empty":"",small:"",stacked:"md",selectable:!0,"select-mode":"single",items:e.items,fields:e.fields,"current-page":e.currentPage,"per-page":e.perPage,filter:e.filter,filterIncludedFields:e.filterOn,"sort-by":e.sortBy,"sort-desc":e.sortDesc,"sort-direction":e.sortDirection},on:{"update:sortBy":function(t){e.sortBy=t},"update:sort-by":function(t){e.sortBy=t},"update:sortDesc":function(t){e.sortDesc=t},"update:sort-desc":function(t){e.sortDesc=t},filtered:e.onFiltered,"row-selected":e.onRowSelected},scopedSlots:e._u([{key:"cell(usercount)",fn:function(data){return[data.value<0?r("span",[e._v("?")]):r("span",[e._v(e._s(data.value))])]}}])})],1)}),[],!1,null,"52431adf",null).exports),w=r(19);function z(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}var O={components:{ScoreMan:h,ExamManLite:y},data:function(){return{monitor:!1,monitorStatus:"None",examselected:null,curexamanswers:[],curexamanswersmap:{},fields:[{key:"user",label:"User",sortable:!0,sortDirection:"desc"},{key:"score",label:"Score",sortable:!0}],totalRows:0,currentPage:1,perPage:5,pageOptions:[5,10,15],sortBy:"",sortDesc:!1,sortDirection:"asc",filter:null,filterOn:[],lusers:{},lquizzes:{},lexams:{},livelisten:null,updating:!1}},computed:function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?z(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):z(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},Object(l.b)({user:function(e){return e.user},users:function(e){return e.users},quizzes:function(e){return e.quizzes},exams:function(e){return e.exams},examanswers:function(e){return e.examanswers}})),mounted:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.users||0!==e.users.length){t.next=3;break}return t.next=3,e.$store.dispatch("getCollection","users");case 3:if(!e.quizzes||0!==e.quizzes.length){t.next=6;break}return t.next=6,e.$store.dispatch("getCollection","quizzes");case 6:if(!e.exams||0!==e.exams.length){t.next=9;break}return t.next=9,e.$store.dispatch("getCollection","exams");case 9:e.lusers=e.convertarrtomap(e.users,"id"),e.lquizzes=e.convertarrtomap(e.quizzes,"id"),e.lexams=e.convertarrtomap(e.exams,"id");case 12:case"end":return t.stop()}}),t)})))()},methods:{monitorStop:function(){this.monitor=!1,this.monitorStatus="None",this.perPage=5,this.currentPage=1},convertarrtomap:function(e,t){return e.reduce((function(map,e){return map[e[t]]=e,map}),{})},onFiltered:function(e){this.totalRows=e.length,this.currentPage=1},buildfields:function(e){var t=this;return[{key:"user",sortable:!0,class:"text-center"},{key:"score",sortable:!0,class:"text-center"}].concat(e.probs.map((function(e){var r={key:e.id};return r.label=t.lquizzes[e.id].title,r.sortable=!1,r.class="text-center",r})))},examine:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.examselected){t.next=2;break}return t.abrupt("return");case 2:r=e.examselected,setTimeout((function(){e.fields=e.buildfields(r),e.updateTable()}),1e3),n=e,e.curexamanswersmap={},e.livelisten=w.c.collection("answers").where("examid","==",e.examselected.id).onSnapshot((function(e){e.docChanges().forEach((function(e){"added"===e.type&&(n.curexamanswersmap[e.doc.id]=e.doc.data()),"modified"===e.type&&(n.curexamanswersmap[e.doc.id]=e.doc.data(),n.updateTable())}))})),e.monitor=!0,e.monitorStatus=r.title;case 9:case"end":return t.stop()}}),t)})))()},updateTable:function(){var e=this;if(!this.updating){this.updating=!0;var t=Object.keys(this.curexamanswersmap).map((function(t){var r=e.curexamanswersmap[t],n={userid:r.userid};return n.user=e.lusers[n.userid].name,n.score=r.score,r.submits.forEach((function(e){n[e.qid]=e.correct?1:0})),n}));this.curexamanswers=t,this.totalRows=this.curexamanswers.length,this.perPage=this.totalRows>20?20:this.totalRows,this.currentPage=1,this.updating=!1}},examRowSelected:function(e){this.examselected=e[0]},stopexam:function(){var e=this;this.$store.dispatch("updateCollectionItem",{collection:"comms",id:"exam",start:!1,examid:null}).then((function(t){e.runningexam=null}))}}},P=Object(d.a)(O,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",{attrs:{fluid:""}},[r("h2",{staticClass:"my-4"},[e._v("Score Panel")]),e._v(" "),r("p",[e._v("\n    Total Users = "+e._s(e.totalRows)+",\n    Monitor = "+e._s(e.monitorStatus)+"    \n    "),r("b-button",{attrs:{variant:"outline-success",size:"sm"},on:{click:e.monitorStop}},[e._v("Stop Monitor")])],1),e._v(" "),r("b-row",[r("b-col",{staticClass:"my-1",attrs:{md:"4"}},[r("b-form-group",{staticClass:"mb-0",attrs:{label:"Filter","label-cols-sm":"3","label-align-sm":"right","label-size":"sm","label-for":"filterInput"}},[r("b-input-group",{attrs:{size:"sm"}},[r("b-form-input",{attrs:{type:"search",id:"filterInput",placeholder:"Type to Search"},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}}),e._v(" "),r("b-input-group-append",[r("b-button",{attrs:{disabled:!e.filter},on:{click:function(t){e.filter=""}}},[e._v("Clear")])],1)],1)],1)],1),e._v(" "),r("b-col",{staticClass:"my-1",attrs:{md:"2"}},[r("b-form-group",{staticClass:"mb-0",attrs:{label:"N","label-cols-sm":"6","label-cols-md":"4","label-cols-lg":"3","label-align-sm":"right","label-size":"sm","label-for":"perPageSelect"}},[r("b-form-select",{attrs:{id:"perPageSelect",size:"sm",options:e.pageOptions},model:{value:e.perPage,callback:function(t){e.perPage=t},expression:"perPage"}})],1)],1),e._v(" "),r("b-col",{staticClass:"my-1",attrs:{md:"6"}},[r("b-pagination",{staticClass:"my-0",attrs:{"total-rows":e.totalRows,"per-page":e.perPage,align:"fill",size:"sm"},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}})],1)],1),e._v(" "),r("b-table",{staticClass:"mt-3",attrs:{"show-empty":"",small:"",stacked:"md",selectable:!0,"select-mode":"range",responsive:!0,items:e.curexamanswers,fields:e.fields,"current-page":e.currentPage,"per-page":e.perPage,filter:e.filter,filterIncludedFields:e.filterOn,"sort-by":e.sortBy,"sort-desc":e.sortDesc,"sort-direction":e.sortDirection},on:{"update:sortBy":function(t){e.sortBy=t},"update:sort-by":function(t){e.sortBy=t},"update:sortDesc":function(t){e.sortDesc=t},"update:sort-desc":function(t){e.sortDesc=t},filtered:e.onFiltered}}),e._v(" "),e.monitor?e._e():r("div",[r("hr"),e._v(" "),r("b-button",{attrs:{size:"sm",variant:"outline-success"},on:{click:e.examine}},[e._v("檢視")]),e._v(" "),r("ExamManLite",{staticClass:"mt-4",on:{rowSelected:e.examRowSelected}})],1)],1)}),[],!1,null,null,null);t.default=P.exports}}]);