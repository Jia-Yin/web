(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{1047:function(t,e,r){"use strict";r(895)},1048:function(t,e,r){(e=r(60)(!1)).push([t.i,".cname[data-v-6258e324]{padding:6px 12px;border:1px solid green;text-align:center}",""]),t.exports=e},1126:function(t,e,r){"use strict";r.r(e);r(30),r(28),r(104),r(49);var n=r(8),c=r(32),o=r(843),d={data:function(){return{processing:!1}},computed:{cid:function(){return this.$route.params.course},prepath:function(){return"/admin/"+this.$route.params.course},course:function(){var t=this.$route.params.course;return this.$store.state.courseCache[t]||{}}},created:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("playground"!=t.cid){e.next=2;break}return e.abrupt("return",t.$router.push("/user"));case 2:return e.next=4,t.setCourse();case 4:return e.next=6,t.processCourseTask();case 6:case"end":return e.stop()}}),e)})))()},methods:{setCourse:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("getCourse",t.cid);case 2:case"end":return e.stop()}}),e)})))()},processCourseTask:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n,d,l,f,v,h,m,x,i,k,S,w,_,$,y,T,C,N,u,O,j,M;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.processing=!0,t.course&&t.course.name){e.next=7;break}return e.next=4,t.$store.dispatch("getCourse",t.cid);case 4:r=e.sent,e.next=8;break;case 7:r=t.course;case 8:return n=r.students?t.$copyObject(r.students):{},d=r.scores?t.$copyObject(r.scores):{},e.next=12,c.d.collection("problems").doc("STAT").get();case 12:if((l=e.sent).exists){e.next=20;break}return f={updated:o.a.getNow()},e.next=17,c.d.collection("problems").doc("STAT").set(f);case 17:v=f,e.next=22;break;case 20:(v=l.data()).updated=o.a.getNow();case 22:h=r.units,m=3,(x=t.$system("setting"))&&x.queueNumber&&(m=x.queueNumber),r.queueNumber&&(m=r.queueNumber),i=0;case 28:if(!(i<m)){e.next=61;break}return k="queue"+(i+1),e.next=32,c.d.collection("courses").doc(t.cid).collection("tasks").doc(k).get();case 32:if(!(S=e.sent).exists){e.next=58;break}w=S.data(),e.t0=regeneratorRuntime.keys(w);case 36:if((e.t1=e.t0()).done){e.next=55;break}if("updated"!=(_=e.t1.value)){e.next=40;break}return e.abrupt("continue",36);case 40:if("S_"!=_.substring(0,2)){e.next=51;break}if($=_.substring(2),n[$]||(n[$]={name:w[_].name,stdID:w[_].stdID}),!w[_].score){e.next=51;break}return e.next=46,c.d.collection("users").doc($).get();case 46:if(y=e.sent,T=y.data(),C=[],T.courses&&T.courses[t.cid])for(N=T.courses[t.cid].units,u=0;u<h.length;u++)O=h[u].name,N[O]?C.push(N[O].score):C.push(0);d[$]=C;case 51:"P_"==_.substring(0,2)&&(j=_.substring(20),v[j]||(v[j]={TS:0,TP:0}),v[j].TS+=1,1==w[_]&&(v[j].TP+=1)),w[_]=c.b.firestore.FieldValue.delete(),e.next=36;break;case 55:return w.updated=o.a.getNow(),e.next=58,c.d.collection("courses").doc(t.cid).collection("tasks").doc(k).update(w);case 58:i++,e.next=28;break;case 61:return e.next=63,c.d.collection("problems").doc("STAT").set(v);case 63:return M={scores:d,students:n,updated:o.a.getNow()},e.next=66,t.$store.dispatch("updateCourse",{id:t.cid,value:M});case 66:t.processing=!1;case 67:case"end":return e.stop()}}),e)})))()}},watch:{cid:function(t){this.setCourse()}}},l=(r(1047),r(55)),component=Object(l.a)(d,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("p",{staticClass:"cname"},[t._v(t._s(t.course&&t.course.name))]),t._v(" "),r("b-modal",{attrs:{title:"Course Processing"},model:{value:t.processing,callback:function(e){t.processing=e},expression:"processing"}},[r("b-spinner",{attrs:{variant:"primary",label:"Spinning"}}),t._v(" "),r("b-spinner",{attrs:{variant:"primary",label:"Spinning"}}),t._v(" "),r("b-spinner",{attrs:{variant:"primary",label:"Spinning"}})],1),t._v(" "),r("b-nav",{attrs:{tabs:""}},[r("b-nav-item",{attrs:{to:t.prepath,active:t.$route.path=="/admin/"+t.cid}},[t._v("Basic")]),t._v(" "),r("b-nav-item",{attrs:{to:t.prepath+"/units",active:t.$route.path=="/admin/"+t.cid+"/units"}},[t._v("Units")]),t._v(" "),r("b-nav-item",{attrs:{to:t.prepath+"/exams",active:t.$route.path=="/admin/"+t.cid+"/exams"}},[t._v("Exams")]),t._v(" "),r("b-nav-item",{attrs:{to:t.prepath+"/students",active:t.$route.path=="/admin/"+t.cid+"/students"}},[t._v("Students")]),t._v(" "),r("b-nav-item",{attrs:{to:t.prepath+"/scores",active:t.$route.path=="/admin/"+t.cid+"/scores"}},[t._v("Scores")]),t._v(" "),r("b-nav-item",{attrs:{to:t.prepath+"/setting",active:t.$route.path=="/admin/"+t.cid+"/setting"}},[t._v("Setting")])],1),t._v(" "),r("nuxt-child",{staticClass:"mt-4",attrs:{course:t.course}})],1)}),[],!1,null,"6258e324",null);e.default=component.exports},843:function(t,e,r){"use strict";r(10),r(14),r(22),r(103),r(9),r(844),r(27),r(15);var n=r(227),c=r.n(n),o={pad:function(t){return("0"+t).slice(-2)},mmss:function(t){var e=Math.floor(t/60);return t%=60,"".concat(this.pad(e),":").concat(this.pad(t))},hhmmss:function(t){var e=Math.floor(t/60);t%=60;var r=Math.floor(e/60);return e%=60,"".concat(this.pad(r),":").concat(this.pad(e),":").concat(this.pad(t))},getToday:function(){var t=new Date,dd=String(t.getDate()).padStart(2,"0"),e=String(t.getMonth()+1).padStart(2,"0");return t.getFullYear()+e+dd},getNow:function(){var t=new Date;return""+t.getFullYear()+this.pad(t.getMonth()+1)+this.pad(t.getDate())+this.pad(t.getHours())+this.pad(t.getMinutes())+this.pad(t.getSeconds())},obj2arr:function(t){var e=[],r=Object.keys(t);return r.sort(),r.forEach((function(r){e.push(Object.assign({id:r},t[r]))})),e},arr2obj:function(t){var e={};return t.forEach((function(t){var r=JSON.parse(JSON.stringify(t)),n=t.id;delete r.id,e[n]=r})),e},getOptions:function(t){var e=[];return t.split("#@@#").forEach((function(t){var s=t.split("#@");e.push({text:s[0],value:s[1]})})),e},findIdPos:function(t,e){if(!t)return-1;for(var r=0;r<t.length;r++)if(e==t[r].id)return r;return-1},encode:function(t,e){return new c.a(t).encrypt(e)},decode:function(t,e){return new c.a(t).decrypt(e)}};e.a=o},844:function(t,e,r){"use strict";var n=r(7),c=r(845).start;n({target:"String",proto:!0,forced:r(846)},{padStart:function(t){return c(this,t,arguments.length>1?arguments[1]:void 0)}})},845:function(t,e,r){var n=r(50),c=r(228),o=r(52),d=Math.ceil,l=function(t){return function(e,r,l){var f,v,h=String(o(e)),m=h.length,x=void 0===l?" ":String(l),k=n(r);return k<=m||""==x?h:(f=k-m,(v=c.call(x,d(f/x.length))).length>f&&(v=v.slice(0,f)),t?h+v:v+h)}};t.exports={start:l(!1),end:l(!0)}},846:function(t,e,r){var n=r(127);t.exports=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(n)},895:function(t,e,r){var content=r(1048);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(61).default)("62e7a78e",content,!0,{sourceMap:!1})}}]);