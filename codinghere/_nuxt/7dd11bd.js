(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{1032:function(e,o,r){"use strict";r(890)},1033:function(e,o,r){(o=r(59)(!1)).push([e.i,".container-fluid[data-v-d225e378]{margin:40px}[data-v-d225e378] label{color:#00f;border-radius:4px;text-align:right;margin-right:40px}.error[data-v-d225e378]{width:100%;padding:20px 20px 10px 30px;background:#fffacd;color:red;line-height:180%}.perrors[data-v-d225e378],form.errors[data-v-d225e378] :invalid{outline:2px solid red}button[data-v-d225e378]{width:50%;margin:36px auto}",""]),e.exports=o},1064:function(e,o,r){"use strict";r.r(o);r(54);var t=r(14),l=r(0),n=r(46),c=r(79),f=r(226);function d(object,e){var o=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),o.push.apply(o,r)}return o}var m={data:function(){return{errors:!1,confirm:!1,modify:!1,confirmTitle:"",confirmMessage:"",modPass:!1,origPassword:"",newPassword:"",newPassword2:"",localeText:{Profile_Name:"姓名",Profile_Email:"電子郵件",Profile_StdID:"學號",Profile_School:"學校",Profile_Dept:"科系",Profile_Grade:"年級",Profile_Locale:"語言",Profile_ModifyProfile:"修改資料",Profile_ModifyPassword:"修改密碼",Profile_PasswordModTitle:"修改密碼",Profile_CurrentPassword:"目前密碼",Profile_NewPassword:"更新密碼",Profile_NewPassword2:"重覆密碼",Profile_PasswordUpdateOK:"密碼更新完成！",Profile_PasswordUpdateFail:"密碼更新失敗！",Profile_ProfileUpdateOK:"資料更新完成，請重新載入頁面！",Profile_AllSchools:"中原大學#@CYCU#@@#其他#@Others",Profile_AllDepts:"電機工程學系#@EE#@@#電資學士班#@EECS#@@#其他#@Others",Profile_AllGrades:"大一#@1#@@#大二#@2#@@#大三#@3#@@#大四#@4#@@#研究所#@G#@@#教師#@T#@@#其他#@Others"},schools:[],depts:[],grades:[],locales:{zh:"中文"}}},computed:function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?d(Object(source),!0).forEach((function(o){Object(l.a)(e,o,source[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):d(Object(source)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(source,o))}))}return e}({},Object(c.b)({user:function(e){return e.user},locale:function(e){return e.user.locale},system:function(e){return e.system}})),created:function(){this.cuser=JSON.parse(JSON.stringify(this.user)),this.system.locales&&this.locale in this.system.locales.support&&(this.localeText=f.a.updateParams(this.system.locales[this.locale],this.localeText)),this.system.locales&&this.system.locales.support&&(this.locales=JSON.parse(JSON.stringify(this.system.locales.support))),this.schools=f.a.getOptions(this.localeText.Profile_AllSchools),this.depts=f.a.getOptions(this.localeText.Profile_AllDepts),this.grades=f.a.getOptions(this.localeText.Profile_AllGrades)},methods:{modifyPassword:function(){var e=this;return Object(t.a)(regeneratorRuntime.mark((function o(){var r,t;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(e.newPassword==e.newPassword2){o.next=3;break}return e.showConfirm("PasswordDiff"),o.abrupt("return");case 3:return r=e,o.next=6,n.b.auth.EmailAuthProvider.credential(e.user.email,e.origPassword);case 6:t=o.sent,n.c.currentUser.reauthenticateWithCredential(t).then((function(){n.c.currentUser.updatePassword(r.newPassword).then((function(){r.showConfirm("PasswordOK")})).catch((function(e){r.showConfirm("PasswordFail",e.message)}))})).catch((function(e){r.showConfirm("PasswordWrong")}));case 8:case"end":return o.stop()}}),o)})))()},onSubmit:function(e){var o=this;return Object(t.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.modify){e.next=5;break}o.modify=!0,o.localeText.modifyProfile="Update",e.next=13;break;case 5:return o.cuser,e.next=8,n.d.collection("users").doc(o.user.id).update(o.cuser);case 8:o.cuser.id=o.user.id,o.cuser.role=o.user.role,r=JSON.parse(JSON.stringify(o.cuser)),o.$store.commit("setData",{name:"user",value:r}),o.showConfirm("ProfileOK");case 13:case"end":return e.stop()}}),e)})))()},showConfirm:function(e,o){"ProfileOK"==e&&(this.confirmTitle=this.localeText.Profile_ModifyProfile,this.confirmMessage=o||this.localeText.Profile_ProfileUpdateOK,this.confirm=!0),"PasswordOK"==e&&(this.confirmTitle=this.localeText.Profile_ModifyPassword,this.confirmMessage=o||this.localeText.Profile_PasswordUpdateOK,this.confirm=!0),"PasswordDiff"==e&&(this.confirmTitle=this.localeText.Profile_ModifyPassword,this.confirmMessage=o||this.localeText.Profile_PasswordUpdateOK,this.confirm=!0),"PasswordWrong"==e&&(this.confirmTitle=this.localeText.Profile_ModifyPassword,this.confirmMessage=o||this.localeText.Profile_PasswordUpdateOK,this.confirm=!0),"PasswordFail"==e&&(this.confirmTitle=this.localeText.Profile_ModifyPassword,this.confirmMessage=o||this.localeText.Profile_PasswordUpdateFail,this.confirm=!0)},invalidateForm:function(){this.errors=!0}}},P=(r(1032),r(70)),component=Object(P.a)(m,(function(){var e=this,o=e.$createElement,r=e._self._c||o;return r("b-container",{attrs:{fluid:""}},[r("b-form",{class:!!this.errors&&"errors",on:{submit:function(o){return o.preventDefault(),e.onSubmit(o)}}},[r("b-form-group",{attrs:{"label-cols":"2","content-cols":"8",label:e.localeText.Profile_Name,"label-for":"form-name"}},[r("b-form-input",{staticClass:"form-control",attrs:{disabled:!e.modify,required:"",type:"text"},on:{invalid:e.invalidateForm},model:{value:e.cuser.name,callback:function(o){e.$set(e.cuser,"name",o)},expression:"cuser.name"}})],1),e._v(" "),r("b-form-group",{attrs:{"label-cols":"2","content-cols":"8",label:e.localeText.Profile_Email,"label-for":"form-email"}},[r("b-form-input",{staticClass:"form-control",attrs:{disabled:"",type:"text"},model:{value:e.cuser.email,callback:function(o){e.$set(e.cuser,"email",o)},expression:"cuser.email"}})],1),e._v(" "),r("b-form-group",{attrs:{"label-cols":"2","content-cols":"8",label:e.localeText.Profile_StdID,"label-for":"form-stdID"}},[r("b-form-input",{staticClass:"form-control",attrs:{required:"",disabled:!e.modify,type:"text",pattern:"[A-Z]?[0-9]+"},on:{invalid:e.invalidateForm},model:{value:e.cuser.stdID,callback:function(o){e.$set(e.cuser,"stdID",o)},expression:"cuser.stdID"}})],1),e._v(" "),r("b-form-group",{attrs:{"label-cols":"2","content-cols":"8",label:e.localeText.Profile_School,"label-for":"form-school"}},[r("b-form-select",{staticClass:"form-control",attrs:{disabled:!e.modify,options:e.schools},model:{value:e.cuser.school,callback:function(o){e.$set(e.cuser,"school",o)},expression:"cuser.school"}})],1),e._v(" "),r("b-form-group",{attrs:{"label-cols":"2","content-cols":"8",label:e.localeText.Profile_Dept,"label-for":"form-dept"}},[r("b-form-select",{staticClass:"form-control",attrs:{disabled:!e.modify,options:e.depts},model:{value:e.cuser.dept,callback:function(o){e.$set(e.cuser,"dept",o)},expression:"cuser.dept"}})],1),e._v(" "),r("b-form-group",{attrs:{"label-cols":"2","content-cols":"8",label:e.localeText.Profile_Grade,"label-for":"form-grade"}},[r("b-form-select",{staticClass:"form-control",attrs:{disabled:!e.modify,options:e.grades},model:{value:e.cuser.grade,callback:function(o){e.$set(e.cuser,"grade",o)},expression:"cuser.grade"}})],1),e._v(" "),r("b-form-group",{attrs:{"label-cols":"2","content-cols":"8",label:e.localeText.Profile_Locale,"label-for":"form-locale"}},[r("b-form-select",{staticClass:"form-control",attrs:{disabled:!e.modify,options:e.locales},model:{value:e.cuser.locale,callback:function(o){e.$set(e.cuser,"locale",o)},expression:"cuser.locale"}})],1),e._v(" "),r("b-button",{attrs:{pill:"",block:"",type:"submit",variant:"outline-primary"}},[e._v("\n                "+e._s(e.localeText.Profile_ModifyProfile)+"\n            ")]),e._v(" "),r("p",{attrs:{align:"center"}},[r("b-link",{on:{click:function(o){e.modPass=!0}}},[e._v("\n                    "+e._s(e.localeText.Profile_ModifyPassword)+"\n                ")])],1),e._v(" "),r("br"),e._v(" "),r("b-modal",{attrs:{title:e.confirmTitle},model:{value:e.confirm,callback:function(o){e.confirm=o},expression:"confirm"}},[e._v(e._s(e.confirmMessage))]),e._v(" "),r("b-modal",{attrs:{"ok-only":"",title:e.localeText.Profile_PasswordModTitle},on:{ok:e.modifyPassword},model:{value:e.modPass,callback:function(o){e.modPass=o},expression:"modPass"}},[r("label",[e._v(e._s(e.localeText.Profile_CurrentPassword))]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.origPassword,expression:"origPassword"}],attrs:{type:"password"},domProps:{value:e.origPassword},on:{input:function(o){o.target.composing||(e.origPassword=o.target.value)}}}),e._v(" "),r("label",[e._v(e._s(e.localeText.Profile_NewPassword))]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.newPassword,expression:"newPassword"}],attrs:{type:"password"},domProps:{value:e.newPassword},on:{input:function(o){o.target.composing||(e.newPassword=o.target.value)}}}),e._v(" "),r("label",[e._v(e._s(e.localeText.Profile_NewPassword2))]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.newPassword2,expression:"newPassword2"}],attrs:{type:"password"},domProps:{value:e.newPassword2},on:{input:function(o){o.target.composing||(e.newPassword2=o.target.value)}}})])],1)],1)}),[],!1,null,"d225e378",null);o.default=component.exports},890:function(e,o,r){var content=r(1033);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(60).default)("49129398",content,!0,{sourceMap:!1})}}]);