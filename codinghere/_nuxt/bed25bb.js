(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{1084:function(e,t,r){"use strict";r(916)},1085:function(e,t,r){(t=r(60)(!1)).push([e.i,".rightBox[data-v-411c3e3f]{position:absolute;right:24px;top:20px;color:red}.tabs[data-v-411c3e3f]{margin-right:60px}.container-fluid[data-v-411c3e3f]{margin:16px;position:relative}",""]),e.exports=t},1141:function(e,t,r){"use strict";r.r(t);r(22),r(156),r(30),r(49);var o=r(8),n=r(843),c=r(860),l=r(32),d={components:{ProblemSolver:c.default},asyncData:function(e){return Object(o.a)(regeneratorRuntime.mark((function t(){var r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.store,o=r.state.params.probSet,t.abrupt("return",{probSet:o});case 3:case"end":return t.stop()}}),t)})))()},data:function(){return{submitid:"",submitList:null,problem:null,baseProblems:null,demo:!1,pgKey:"Coding",lang:"c",langs:"c,cpp,py",initCode:"",lastcode:{},localeText:{Coding_Problem:"問題",Coding_Code:"程式",Coding_Result:"結果",Coding_Reference:"參考"}}},computed:{teaching:function(){var e=this.$user("role");return"teacher"==e||"assistant"==e}},created:function(){this.localeText=this.$updateLocaleText(this.localeText),this.problem=n.a.decode(this.pgKey,this.probSet.problem),this.probSet.initCode&&(this.initCode=this.probSet.initCode.code,this.lang=this.probSet.initCode.lang,this.lastcode={sourceLang:this.lang,sourceCode:this.initCode}),this.probSet.demo&&(this.demo=!0)},methods:{getBaseProblems:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.baseProblems){t.next=5;break}return t.next=3,l.d.collection("problems").doc("BASE").get();case 3:r=t.sent,e.baseProblems=r.data();case 5:case"end":return t.stop()}}),t)})))()},doSubmit:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.problem=e.problem,t.lang=e.lang,t.initCode="",t.$nextTick((function(){t.initCode=e.code})),t.demo=!0;case 5:case"end":return r.stop()}}),r)})))()},searchSubmit:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r,o,n,c,d,m,h,i,f,v;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((r=e.submitid.length)<4)){t.next=4;break}return alert("Code should have 4 chars!"),t.abrupt("return");case 4:return o=e.submitid.charCodeAt(r-1),n=e.submitid.substr(0,r-1)+String.fromCharCode(o+1),t.next=8,l.d.collection("submits").where(l.b.firestore.FieldPath.documentId(),">",e.submitid).where(l.b.firestore.FieldPath.documentId(),"<",n).get();case 8:if(!(c=t.sent).empty){t.next=12;break}return alert("No Match Results!"),t.abrupt("return");case 12:return d=c.docs,t.next=15,e.getBaseProblems();case 15:if(1!=d.length){t.next=20;break}return(m=d[0].data()).problem=e.baseProblems[m.pid],e.doSubmit(m),t.abrupt("return");case 20:h=[],i=0;case 22:if(!(i<d.length)){t.next=33;break}return(f=d[i].data()).problem=e.baseProblems[f.pid],t.next=27,l.d.collection("users").doc(f.uid).get();case 27:v=t.sent,f.user=v.data(),h.push(f);case 30:i++,t.next=22;break;case 33:e.submitList=h;case 34:case"end":return t.stop()}}),t)})))()},submit:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var o,c,d,m,h,f,v,x,S,C,w,_,k,P,i,$,L;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=e.cdata,c=e.result,o.sourceLang==t.lastcode.sourceLang&&o.sourceCode==t.lastcode.sourceCode){r.next=47;break}if(t.lastcode={sourceLang:o.sourceLang,sourceCode:o.sourceCode},d={uid:t.$user("id"),pid:t.problem.id,created:n.a.getNow(),lang:o.sourceLang,code:o.sourceCode,status:c.RunStatus,score:c.Score},!t.demo){r.next=7;break}return console.log("DEMO"),r.abrupt("return");case 7:return r.next=9,l.d.collection("submits").add(d);case 9:return m=r.sent,d.id=m.id,h=t.$user("id"),r.next=14,l.d.collection("users").doc(h).get();case 14:return f=r.sent,(v=f.data()).id=h,t.$store.commit("setData",{name:"user",value:v}),(x=t.$user("courses")?t.$copyObject(t.$user("courses")):{})[t.probSet.courseID]&&x[t.probSet.courseID].units||(x[t.probSet.courseID]={name:t.probSet.courseName,units:{}}),x[t.probSet.courseID].units[t.probSet.courseUnit]||(x[t.probSet.courseID].units[t.probSet.courseUnit]={score:0,TS:0,TP:0,probs:{}}),S=x[t.probSet.courseID].units[t.probSet.courseUnit],(C=S.probs[d.pid])?w=t.$copyObject(C):(w={title:t.problem.title,TS:0,TP:0,score:0,last5:[]},S.probs[d.pid]=w),S.TS+=1,w.TS+=1,"AC"==d.status&&(S.TP+=1,w.TP+=1),!t.probSet.practice&&d.score>w.score&&(S.score+=d.score-w.score,w.score=d.score),w.last5.splice(0,0,d.id),w.last5.length>5&&(w.last5=w.last5.slice(0,5)),S.probs[d.pid]=w,r.next=33,l.d.collection("users").doc(t.$user("id")).update({courses:x,updated:n.a.getNow()});case 33:if(t.$store.commit("setObjItem",{obj:"user",name:"courses",value:x}),!t.probSet.practice){r.next=36;break}return r.abrupt("return");case 36:for(_=t.probSet.courseQN||3,k="queue"+(1+Math.floor(Math.random()*_)),P="P_"+n.a.getNow(),i=0;i<3;i++)P+=Math.floor(10*Math.random());return P+="_"+t.problem.id,($={})[P]="AC"==d.status?1:0,L=t.$user(),$["S_"+L.id]={name:L.name,stdID:L.stdID,score:!0},r.next=47,l.d.collection("courses").doc(t.probSet.courseID).collection("tasks").doc(k).update($);case 47:case"end":return r.stop()}}),r)})))()}}},m=(r(1084),r(55)),component=Object(m.a)(d,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",{attrs:{fluid:""}},[e.teaching?r("p",{staticClass:"rightBox"},[r("span",{staticClass:"mr-2"},[e._v("Search:")]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.submitid,expression:"submitid"}],attrs:{size:"sm"},domProps:{value:e.submitid},on:{input:function(t){t.target.composing||(e.submitid=t.target.value)}}}),e._v(" "),r("button",{attrs:{size:"sm"},on:{click:e.searchSubmit}},[e._v("Search")])]):e._e(),e._v(" "),r("b-modal",{model:{value:e.submitList,callback:function(t){e.submitList=t},expression:"submitList"}},[r("p",{staticClass:"my-3"},[e._v("Which one?")]),e._v(" "),e._l(e.submitList,(function(t,o){return r("p",{key:t.id},[e._v("\n            "+e._s(o+1)+". "+e._s(t.user.name)+" -\n            "+e._s(e.$selectUserLocaleText(t.problem.title))+"\n        ")])}))],2),e._v(" "),r("problem-solver",{attrs:{problem:e.problem,initCode:e.initCode,lang:e.lang,langs:e.langs},on:{submit:e.submit}})],1)}),[],!1,null,"411c3e3f",null);t.default=component.exports;installComponents(component,{ProblemSolver:r(860).default})},916:function(e,t,r){var content=r(1085);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(61).default)("74c65e46",content,!0,{sourceMap:!1})}}]);