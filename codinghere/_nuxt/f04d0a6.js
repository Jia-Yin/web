(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{1114:function(e,t,r){"use strict";r(926)},1115:function(e,t,r){(t=r(60)(!1)).push([e.i,".rightBox[data-v-95e29bc2]{position:absolute;right:24px;top:20px;color:red}.tabs[data-v-95e29bc2]{margin-right:60px}.container-fluid[data-v-95e29bc2]{margin:16px;position:relative}",""]),e.exports=t},1182:function(e,t,r){"use strict";r.r(t);r(39),r(156),r(29),r(49);var o=r(7),n=r(843),c=r(851),l=r(32),d={components:{ProblemSolver:c.default},asyncData:function(e){return Object(o.a)(regeneratorRuntime.mark((function t(){var r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.store,o=r.state.params.probSet,t.abrupt("return",{probSet:o});case 3:case"end":return t.stop()}}),t)})))()},data:function(){return{submitid:"",submitList:null,problem:null,baseProblems:null,demo:!1,pgKey:"Coding",lang:"c",langs:"c,cpp,py",initCode:"",lastcode:{},localeText:{Coding_Problem:"問題",Coding_Code:"程式",Coding_Result:"結果",Coding_Reference:"參考"}}},computed:{teaching:function(){var e=this.$user("role");return"teacher"==e||"assistant"==e}},created:function(){this.localeText=this.$updateLocaleText(this.localeText),this.problem=n.a.decode(this.pgKey,this.probSet.problem),this.probSet.initCode&&(this.initCode=this.probSet.initCode.code,this.lang=this.probSet.initCode.lang,this.lastcode={sourceLang:this.lang,sourceCode:this.initCode}),this.probSet.demo&&(this.demo=!0)},methods:{getBaseProblems:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.baseProblems){t.next=5;break}return t.next=3,l.d.collection("problems").doc("BASE").get();case 3:r=t.sent,e.baseProblems=r.data();case 5:case"end":return t.stop()}}),t)})))()},doSubmit:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.problem=e.problem,t.lang=e.lang,t.initCode="",t.$nextTick((function(){t.initCode=e.code})),t.demo=!0;case 5:case"end":return r.stop()}}),r)})))()},searchSubmit:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r,o,n,c,d,m,h,i,f,x;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((r=e.submitid.length)<4)){t.next=4;break}return alert("Code should have 4 chars!"),t.abrupt("return");case 4:return o=e.submitid.charCodeAt(r-1),n=e.submitid.substr(0,r-1)+String.fromCharCode(o+1),t.next=8,l.d.collection("submits").where(l.b.firestore.FieldPath.documentId(),">",e.submitid).where(l.b.firestore.FieldPath.documentId(),"<",n).get();case 8:if(!(c=t.sent).empty){t.next=12;break}return alert("No Match Results!"),t.abrupt("return");case 12:return d=c.docs,t.next=15,e.getBaseProblems();case 15:if(1!=d.length){t.next=20;break}return(m=d[0].data()).problem=e.baseProblems[m.pid],e.doSubmit(m),t.abrupt("return");case 20:h=[],i=0;case 22:if(!(i<d.length)){t.next=33;break}return(f=d[i].data()).problem=e.baseProblems[f.pid],t.next=27,l.d.collection("users").doc(f.uid).get();case 27:x=t.sent,f.user=x.data(),h.push(f);case 30:i++,t.next=22;break;case 33:e.submitList=h;case 34:case"end":return t.stop()}}),t)})))()},submit:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var o,c,d,m,h,f,x,v,S,C,k,w,_,i,P,$,L,R,T,D;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=e.cdata,c=e.result,o.sourceLang==t.lastcode.sourceLang&&o.sourceCode==t.lastcode.sourceCode){r.next=62;break}if(t.lastcode={sourceLang:o.sourceLang,sourceCode:o.sourceCode},d={uid:t.$user("id"),pid:t.problem.id,created:n.a.getNow(),lang:o.sourceLang,code:o.sourceCode,status:c.RunStatus,score:c.Score},!t.demo){r.next=7;break}return console.log("DEMO"),r.abrupt("return");case 7:return r.next=9,l.d.collection("submits").add(d);case 9:return m=r.sent,d.id=m.id,h=t.$user("id"),r.next=14,l.d.collection("users").doc(h).get();case 14:if(f=r.sent,(x=f.data()).id=h,t.$store.commit("setData",{name:"user",value:x}),(v=t.$user("courses")?t.$copyObject(t.$user("courses")):{})[t.probSet.courseID]&&v[t.probSet.courseID].units||(v[t.probSet.courseID]={name:t.probSet.courseName,units:{}}),v[t.probSet.courseID].units[t.probSet.courseUnit]||(v[t.probSet.courseID].units[t.probSet.courseUnit]={score:0,TS:0,TP:0,probs:{}}),S=v[t.probSet.courseID].units[t.probSet.courseUnit],(C=S.probs[d.pid])?k=t.$copyObject(C):(k={title:t.problem.title,TS:0,TP:0,score:0,last5:[]},S.probs[d.pid]=k),S.TS+=1,k.TS+=1,w="0/","AC"==d.status&&(S.TP+=1,k.TP+=1,w="1/"),!t.probSet.practice&&d.score>k.score&&(S.score+=d.score-k.score,k.score=d.score),k.last5.splice(0,0,w+d.id),!(k.last5.length>5)){r.next=45;break}if(!(k.last5[5].indexOf("1/")>=0)){r.next=44;break}_=!0,i=0;case 34:if(!(i<5)){r.next=41;break}if(!(k.last5[i].indexOf("1/")>=0)){r.next=38;break}return _=!1,r.abrupt("break",41);case 38:i++,r.next=34;break;case 41:_?k.last5.splice(4,1):k.last5.splice(5,1),r.next=45;break;case 44:k.last5.splice(5,1);case 45:return S.probs[d.pid]=k,r.next=48,l.d.collection("users").doc(t.$user("id")).update({courses:v,updated:n.a.getNow()});case 48:if(t.$store.commit("setObjItem",{obj:"user",name:"courses",value:v}),!t.probSet.practice){r.next=51;break}return r.abrupt("return");case 51:for(P=t.probSet.courseQN||3,$="queue"+(1+Math.floor(Math.random()*P)),L="P_"+n.a.getNow(),R=0;R<3;R++)L+=Math.floor(10*Math.random());return L+="_"+t.problem.id,(T={})[L]="AC"==d.status?1:0,D=t.$user(),T["S_"+D.id]={name:D.name,stdID:D.stdID,score:!0},r.next=62,l.d.collection("courses").doc(t.probSet.courseID).collection("tasks").doc($).update(T);case 62:case"end":return r.stop()}}),r)})))()}}},m=(r(1114),r(55)),component=Object(m.a)(d,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",{attrs:{fluid:""}},[e.teaching?r("p",{staticClass:"rightBox"},[r("span",{staticClass:"mr-2"},[e._v("Search:")]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.submitid,expression:"submitid"}],attrs:{size:"sm"},domProps:{value:e.submitid},on:{input:function(t){t.target.composing||(e.submitid=t.target.value)}}}),e._v(" "),r("button",{attrs:{size:"sm"},on:{click:e.searchSubmit}},[e._v("Search")])]):e._e(),e._v(" "),r("b-modal",{model:{value:e.submitList,callback:function(t){e.submitList=t},expression:"submitList"}},[r("p",{staticClass:"my-3"},[e._v("Which one?")]),e._v(" "),e._l(e.submitList,(function(t,o){return r("p",{key:t.id},[e._v("\n            "+e._s(o+1)+". "+e._s(t.user.name)+" -\n            "+e._s(e.$selectUserLocaleText(t.problem.title))+"\n        ")])}))],2),e._v(" "),r("problem-solver",{attrs:{problem:e.problem,initCode:e.initCode,lang:e.lang,langs:e.langs},on:{submit:e.submit}})],1)}),[],!1,null,"95e29bc2",null);t.default=component.exports;installComponents(component,{ProblemSolver:r(851).default})},926:function(e,t,r){var content=r(1115);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(61).default)("122778da",content,!0,{sourceMap:!1})}}]);