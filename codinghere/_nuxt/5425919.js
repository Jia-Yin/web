(window.webpackJsonp=window.webpackJsonp||[]).push([[29,76],{1058:function(e,t,n){e.exports=n(1059)},1059:function(e,t,n){"use strict";function r(object){switch(typeof object){case"string":return function(e){for(var s=e.length,i=e.length-1;i>=0;i--){var code=e.charCodeAt(i);code>127&&code<=2047?s++:code>2047&&code<=65535&&(s+=2)}return s}(object)+1;case"boolean":return 1;case"number":return 8;case"object":return Array.isArray(object)?object.map(r).reduce((function(e,t){return e+t}),0):function(object){if(null===object)return 1;if(object.hasOwnProperty("_lat")&&"function"==typeof object.isEqual)return 16;if("function"==typeof object.toDate||"function"==typeof object.getDate)return 8;if("function"==typeof object.toUint8Array)return object.toUint8Array().byteLength;if("function"==typeof object.onSnapshot)return object._key.path.segments.slice(object._key.path.offset).reduce((function(e,t){return e+t.length+1}),16);var e=0;for(var t in object)if(Object.hasOwnProperty.call(object,t)){e+=r(t);try{e+=r(object[t])}catch(t){t instanceof RangeError&&(e=0)}}return e}(object);default:return 0}}e.exports=function(object){return 32+r(object)}},1060:function(e,t,n){"use strict";n(894)},1061:function(e,t,n){(t=n(56)(!1)).push([e.i,"[data-v-4d53b10c] h1{color:#00f;font-size:120%;margin:24px 0 20px}[data-v-4d53b10c] h2{color:#ff4500;font-size:110%;margin:16px 0 12px}[data-v-4d53b10c] h3{color:green;font-size:100%;margin:12px 0 6px}.showPanel[data-v-4d53b10c]{padding:6px 24px;border:1px solid #d3d3d3;background:#fafad2}.control[data-v-4d53b10c]{display:flex;padding:12px;background:#e0ffff}.desc[data-v-4d53b10c]{margin-left:24px;padding-top:5px;align-content:center;color:brown}[data-v-4d53b10c] code.hljs.language-c{background-color:#eee;padding:12px 18px}.one[data-v-4d53b10c],.two[data-v-4d53b10c]{overflow-x:scroll;height:100%}",""]),e.exports=t},1089:function(e,t,n){var content=n(1269);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(57).default)("44a7bb8d",content,!0,{sourceMap:!1})},1148:function(e,t,n){"use strict";n.r(t);n(10),n(36),n(18),n(12),n(30),n(27),n(79),n(87),n(368),n(49);var r=n(7),o=n(26),c=n(855),l=n(3),d=n(890),f=n.n(d),v=n(893),h=n.n(v);l.default.use(f.a),l.default.use(h.a);var m={data:function(){return{pscore:0,showContent:!1,showReaders:!1,showScore:!1,person:null,keyword:"",reports:null,readers:null,csAstudents:null,csBstudents:null,allStudents:{},guiders:[],isGuider:!1,records:[],scores:{},fields:[{key:"index",label:"編號"},{key:"name",label:"姓名",sortable:!0},{key:"stdID",label:"學號",sortable:!0},{key:"class",label:"班級",sortable:!0},{key:"conlen",label:"內容長度",sortable:!0},{key:"updated",label:"更新時間",sortable:!0},{key:"readers",label:"讀者"},{key:"score",label:"分數",sortable:!0}]}},created:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,r,c,l,d,f,i,v,h,m,k,x,y,w,_,s,S,C;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=null,e.csAstudents){t.next=12;break}return t.next=4,o.d.collection("courses").doc("C000003").get();case 4:n=t.sent,r=n.data(),e.csAstudents=r.students,c=[],r.teachers&&(c=r.teachers.map((function(e){return e.id}))),r.assistants&&(c=c.concat(r.assistants.map((function(e){return e.id})))),c.indexOf(e.$user("id"))>=0&&(e.isGuider=!0),e.guiders=e.guiders.concat(c);case 12:if(e.csBstudents){t.next=23;break}return t.next=15,o.d.collection("courses").doc("C000002").get();case 15:n=t.sent,l=n.data(),e.csBstudents=l.students,d=[],l.teachers&&(d=l.teachers.map((function(e){return e.id}))),l.assistants&&(d=d.concat(l.assistants.map((function(e){return e.id})))),d.indexOf(e.$user("id"))>=0&&(e.isGuider=!0),e.guiders=e.guiders.concat(d);case 23:if(e.isGuider){t.next=26;break}return e.$router.push("/user/report"),t.abrupt("return");case 26:if(e.reports){t.next=31;break}return t.next=29,o.d.collection("reports").get();case 29:if(!(f=t.sent).empty)for(e.reports={},i=0;i<f.docs.length;i++)"readers"===(v=f.docs[i]).id?e.readers=v.data():"scores"===v.id?e.scores=v.data():e.reports[v.id]=v.data();case 31:for(k in h=[],m=[{key:"甲",data:e.csAstudents},{key:"乙",data:e.csBstudents}],e.csAstudents)e.allStudents[k]=e.csAstudents[k];for(x in e.csBstudents)e.allStudents[x]=e.csBstudents[x];y=0;case 36:if(!(y<m.length)){t.next=54;break}w=m[y],t.t0=regeneratorRuntime.keys(w.data);case 39:if((t.t1=t.t0()).done){t.next=51;break}if(_=t.t1.value,!(e.guiders.indexOf(_)>=0)){t.next=43;break}return t.abrupt("continue",39);case 43:s=w.data[_],S={id:_,name:s.name,stdID:s.stdID,readers:"",class:w.key,content:"",conlen:0,score:0,updated:""},e.reports[_]&&(S.content=e.reports[_].content,S.conlen=S.content.length,S.updated=e.reports[_].updated),e.readers[_]&&(C=e.readers[_].readers)&&C.length>0&&(S.readers=C.join(",")),e.scores[_]&&(S.score=e.scores[_].score),h.push(S),t.next=39;break;case 51:y++,t.next=36;break;case 54:e.records=h;case 55:case"end":return t.stop()}}),t)})))()},methods:{saveStringToFile:function(e,data){var t=new Blob([data],{type:"text/plain;charset=utf-8"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(t,e);else{var n=window.document.createElement("a");n.href=window.URL.createObjectURL(t),n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)}},exportCSV:function(){var text="學號,姓名,班級,分數\n";for(var e in this.allStudents){var s=this.allStudents[e],t="乙";this.csAstudents[e]&&(t="甲");var n=0;this.scores[e]&&(n=this.scores[e].score),text+="".concat(s.stdID,",").concat(s.name,",").concat(t,",").concat(n,"\n")}this.saveStringToFile("scores.csv",text)},lookLink:function(e){for(var i=0;i<this.records.length;i++)if(this.records[i].id===e){this.person=this.records[i],this.pscore=this.records[i].score,this.showContent=!0;break}},lookPerson:function(p){this.person=p,this.pscore=p.score,this.showContent=!0},setScore:function(p){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.scores[p.id]={score:e.pscore,updated:c.a.getNow()},t.next=3,o.d.collection("reports").doc("scores").set(e.scores);case 3:i=0;case 4:if(!(i<e.records.length)){t.next=12;break}if(e.records[i].id===p.id){t.next=7;break}return t.abrupt("continue",9);case 7:return e.$set(e.records[i],"score",e.pscore),t.abrupt("break",12);case 9:i++,t.next=4;break;case 12:e.showContent=!1;case 13:case"end":return t.stop()}}),t)})))()}}},k=(n(1060),n(55)),component=Object(k.a)(m,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("b-modal",{attrs:{size:"xl","ok-only":""},model:{value:e.showContent,callback:function(t){e.showContent=t},expression:"showContent"}},[e.person?n("div",{domProps:{innerHTML:e._s(e.$md.render(e.person.content))}}):e._e(),e._v(" "),n("hr"),e._v(" "),n("div",{staticClass:"d-flex justify-content-start"},[n("span",[e._v("Score")]),e._v(" "),n("b-input",{staticClass:"ml-3 w-50",attrs:{size:"sm"},model:{value:e.pscore,callback:function(t){e.pscore=t},expression:"pscore"}}),e._v(" "),n("b-button",{staticClass:"ml-3",attrs:{size:"sm",variant:"success"},on:{click:function(t){return e.setScore(e.person)}}},[e._v("給分")])],1)]),e._v(" "),n("div",{staticClass:"mt-3 mb-2 d-flex justify-content-start"},[n("span",{staticClass:"mr-3"},[e._v("Keyword:")]),e._v(" "),n("b-input",{staticClass:"w-50",attrs:{size:"sm"},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),e._v(" "),n("b-button",{staticClass:"ml-2",attrs:{size:"sm",variant:"success"},on:{click:function(t){e.keyword=""}}},[e._v("清除")]),e._v(" "),n("b-button",{staticClass:"ml-2",attrs:{size:"sm",variant:"success"},on:{click:function(t){e.showReaders=!e.showReaders}}},[e._v("\n            "+e._s(e.showReaders?"隱藏讀者":"顯示讀者")+"\n        ")]),e._v(" "),n("b-button",{staticClass:"ml-2",attrs:{size:"sm",variant:"success"},on:{click:function(t){e.showScore=!e.showScore}}},[e._v("\n            "+e._s(e.showScore?"隱藏分數":"顯示分數")+"\n        ")]),e._v(" "),n("b-button",{staticClass:"ml-2",attrs:{size:"sm",variant:"success"},on:{click:e.exportCSV}},[e._v("\n            匯出\n        ")])],1),e._v(" "),n("b-table",{attrs:{items:e.records,fields:e.fields,small:"",striped:"","sticky-header":"700px",filter:e.keyword},scopedSlots:e._u([{key:"cell(index)",fn:function(data){return[e._v("\n            "+e._s(data.index+1)+"\n        ")]}},{key:"cell(name)",fn:function(data){return[n("b-link",{on:{click:function(t){return e.lookPerson(data.item)}}},[e._v(e._s(data.item.name))])]}},e.showReaders?{key:"cell(readers)",fn:function(data){return[data.value&&data.value.length>0?n("span",e._l(data.value.split(","),(function(t){return n("span",{key:"r"+t},[t!==data.item.id?n("b-link",{staticClass:"mr-2",on:{click:function(n){return e.lookLink(t)}}},[e._v(e._s(e.allStudents[t].name))]):e._e()],1)})),0):e._e()]}}:{key:"cell(readers)",fn:function(){return[e._v("隱藏")]},proxy:!0},e.showScore?null:{key:"cell(score)",fn:function(){return[e._v("隱藏")]},proxy:!0}],null,!0)})],1)}),[],!1,null,"4d53b10c",null);t.default=component.exports},1268:function(e,t,n){"use strict";n(1089)},1269:function(e,t,n){(t=n(56)(!1)).push([e.i,"[data-v-03d7fe6d] .row{margin:24px}",""]),e.exports=t},1406:function(e,t,n){"use strict";n.r(t);n(14),n(30),n(27),n(9),n(157),n(29),n(15),n(87),n(49);var r=n(7),o=n(26),c=n(855),l=n(1058),d=n.n(l),f=(n(1148),{computed:{user:function(){return this.$store.state.user}},data:function(){return{doc:"",docSize:"",person:"",ddata:"",dsubmits:"",roles:[],therole:null,fireConfig:null,key:"KEY",config:"",secret:""}},created:function(){},mounted:function(){},methods:{checkPerson:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,i,r,l,d,f,v,h,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.d.collection("users").where("name","==",e.person).get();case 2:if((n=t.sent).empty){t.next=21;break}e.ddata="",e.dsubmits="",i=0;case 7:if(!(i<n.docs.length)){t.next=21;break}return r=n.docs[i],l=r.id,e.ddata+="UID = "+l+"\n",d=JSON.stringify(r.data(),void 0,2),e.ddata+=d,f=c.a.getToday(),t.next=16,o.d.collection("submits").where("uid","==",l).where("created",">",f).where("created","<",f+"240000").get();case 16:if(!(v=t.sent).empty)for(h=0;h<v.docs.length;h++)m=v.docs[h],e.dsubmits+=m.id+"\n",e.dsubmits+=JSON.stringify(m.data(),void 0,2),e.dsubmits+="\n";case 18:i++,t.next=7;break;case 21:case"end":return t.stop()}}),t)})))()},rebuild:function(){return Object(r.a)(regeneratorRuntime.mark((function e(){var t,n,i,r,c,l,d,f,v,h,m,k,x,y,w,_;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.d.collection("courses").get();case 2:if(t=e.sent,n={},t.empty){e.next=16;break}i=0;case 6:if(!(i<t.docs.length)){e.next=16;break}if("LIST"!==(r=t.docs[i]).id){e.next=10;break}return e.abrupt("continue",13);case 10:if("playground"!==r.id){e.next=12;break}return e.abrupt("continue",13);case 12:n[r.id]=r.data();case 13:i++,e.next=6;break;case 16:return console.log("Courses",n),e.next=19,o.d.collection("users").get();case 19:if(c=e.sent,l={},!c.empty)for(d=0;d<c.docs.length;d++)f=c.docs[d],l[f.id]=f.data();for(v in console.log("Set course empty"),n)n[v].students={},n[v].scores={};console.log("Process Students"),e.t0=regeneratorRuntime.keys(l);case 26:if((e.t1=e.t0()).done){e.next=43;break}if(h=e.t1.value,(m=l[h]).courses){e.next=31;break}return e.abrupt("continue",26);case 31:e.t2=regeneratorRuntime.keys(m.courses);case 32:if((e.t3=e.t2()).done){e.next=41;break}if(k=e.t3.value,n[k]){e.next=36;break}return e.abrupt("continue",32);case 36:if(n[k].students[h]={name:m.name,stdID:m.stdID},x=[],n[k].units){for(y=0;y<n[k].units.length;y++)w=n[k].units[y].name,m.courses[k].units&&m.courses[k].units[w]?x.push(m.courses[k].units[w].score):x.push(0);n[k].scores[h]=x}e.next=32;break;case 41:e.next=26;break;case 43:e.t4=regeneratorRuntime.keys(n);case 44:if((e.t5=e.t4()).done){e.next=51;break}return _=e.t5.value,e.next=48,o.d.collection("courses").doc(_).update({students:n[_].students,scores:n[_].scores});case 48:console.log("Course ".concat(_," finished!")),e.next=44;break;case 51:case"end":return e.stop()}}),e)})))()},calDocSize:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.doc.split("##"),console.log("C, D",n[0],n[1]),t.next=4,o.d.collection(n[0]).doc(n[1]).get();case 4:r=t.sent,e.docSize=d()(r.data());case 6:case"end":return t.stop()}}),t)})))()},roleChange:function(e){this.$store.commit("setObjItem",{obj:"user",name:"role",value:e})},getObject:function(e){var t={},n=/\s*\"?(\w+)\"?:\s*\"([\w\d\-,\.:\/]+)\".*/i;return e.split("\n").forEach((function(line){var e=line.match(n);e&&(t[e[1]]=e[2])})),t},relogin:function(){var e=this.getObject(this.config);Object(o.a)(e)},encode:function(){var e=this.getObject(this.config);this.secret=c.a.encode(this.key,JSON.stringify(e))},decode:function(){var e=c.a.decode(this.key,this.secret);this.config=JSON.stringify(e,null,2)},getFire:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.d.collection("projects").doc("oa62QJj2WKcjb6ePozmJ").get().then((function(t){e.fireConfig=t.data()}));case 2:e.key=e.fireConfig.key,e.secret=e.fireConfig.prodconfig;case 4:case"end":return t.stop()}}),t)})))()},signOut:function(){this.$store.dispatch("logout",this.loginForm)},onSubmit:function(){this.$store.dispatch("login",this.loginForm)}}}),v=(n(1268),n(55)),component=Object(v.a)(f,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-container",[n("b-tabs",[n("b-tab",{attrs:{title:"User"}},[n("div",{staticClass:"mt-4"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.person,expression:"person"}],attrs:{size:"sm",placeholder:"User name"},domProps:{value:e.person},on:{input:function(t){t.target.composing||(e.person=t.target.value)}}}),e._v(" "),n("button",{attrs:{size:"sm"},on:{click:e.checkPerson}},[e._v("Check")]),e._v(" "),n("b-textarea",{model:{value:e.ddata,callback:function(t){e.ddata=t},expression:"ddata"}}),e._v(" "),n("p",{staticClass:"mt-3"},[e._v("Submits Today:")]),e._v(" "),n("b-textarea",{model:{value:e.dsubmits,callback:function(t){e.dsubmits=t},expression:"dsubmits"}})],1)]),e._v(" "),n("b-tab",{attrs:{title:"Course"}},[n("button",{on:{click:e.rebuild}},[e._v("Rebuild Course Students/Scores Data")])]),e._v(" "),n("b-tab",{attrs:{title:"Doc Size"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.doc,expression:"doc"}],attrs:{size:"sm",placeholder:"col##doc"},domProps:{value:e.doc},on:{input:function(t){t.target.composing||(e.doc=t.target.value)}}}),e._v(" "),n("button",{on:{click:e.calDocSize}},[e._v("Calculate")]),e._v(" "),n("p",[e._v("Size = "+e._s(e.docSize))])]),e._v(" "),n("b-tab",{attrs:{title:"Change"}},[n("b-select",{attrs:{options:e.roles},on:{input:e.roleChange},model:{value:e.therole,callback:function(t){e.therole=t},expression:"therole"}})],1),e._v(" "),n("b-tab",{attrs:{title:"Project"}},[n("b-row",[n("b-col",{attrs:{cols:"2"}},[e._v("Key:")]),e._v(" "),n("b-col",{attrs:{cols:"10"}},[n("b-form-input",{model:{value:e.key,callback:function(t){e.key=t},expression:"key"}})],1)],1),e._v(" "),n("b-row",[n("b-col",{attrs:{cols:"2"}},[e._v("Config:")]),e._v(" "),n("b-col",{attrs:{cols:"10"}},[n("b-textarea",{attrs:{rows:"10"},model:{value:e.config,callback:function(t){e.config=t},expression:"config"}})],1)],1),e._v(" "),n("b-row",[n("b-col",{attrs:{cols:"2"}},[e._v("Secret:")]),e._v(" "),n("b-col",{attrs:{cols:"10"}},[n("b-textarea",{attrs:{rows:"9"},model:{value:e.secret,callback:function(t){e.secret=t},expression:"secret"}})],1)],1),e._v(" "),n("p",{attrs:{align:"center"}},[n("b-button",{attrs:{variant:"success"},on:{click:e.getFire}},[e._v("FireConfig")]),e._v("   \n                "),n("b-button",{attrs:{variant:"success"},on:{click:e.encode}},[e._v("Encode")]),e._v("   \n                "),n("b-button",{attrs:{variant:"success"},on:{click:e.decode}},[e._v("Decode")]),e._v("   \n                "),n("b-button",{attrs:{variant:"success"},on:{click:e.relogin}},[e._v("Relogin")])],1)],1)],1)],1)}),[],!1,null,"03d7fe6d",null);t.default=component.exports},855:function(e,t,n){"use strict";n(10),n(14),n(86),n(9),n(856),n(29),n(15);var r=n(228),o=n.n(r),c={pad:function(e){return e<10?"0"+e:e},mmss:function(e){var t=Math.floor(e/60);return e%=60,"".concat(this.pad(t),":").concat(this.pad(e))},hhmmss:function(e){var t=Math.floor(e/60);e%=60;var n=Math.floor(t/60);return t%=60,"".concat(this.pad(n),":").concat(this.pad(t),":").concat(this.pad(e))},getToday:function(){var e=new Date,dd=String(e.getDate()).padStart(2,"0"),t=String(e.getMonth()+1).padStart(2,"0");return e.getFullYear()+t+dd},getNow:function(){var e=new Date;return""+e.getFullYear()+this.pad(e.getMonth()+1)+this.pad(e.getDate())+this.pad(e.getHours())+this.pad(e.getMinutes())+this.pad(e.getSeconds())},obj2arr:function(e){var t=[],n=Object.keys(e);return n.sort(),n.forEach((function(n){t.push(Object.assign({id:n},e[n]))})),t},arr2obj:function(e){var t={};return e.forEach((function(e){var n=JSON.parse(JSON.stringify(e)),r=e.id;delete n.id,t[r]=n})),t},getOptions:function(e){var t=[];return e.split("#@@#").forEach((function(e){var s=e.split("#@");t.push({text:s[0],value:s[1]})})),t},findIdPos:function(e,t){if(!e)return-1;for(var n=0;n<e.length;n++)if(t==e[n].id)return n;return-1},encode:function(e,t){return new o.a(e).encrypt(t)},decode:function(e,t){return new o.a(e).decrypt(t)}};t.a=c},856:function(e,t,n){"use strict";var r=n(8),o=n(857).start;r({target:"String",proto:!0,forced:n(858)},{padStart:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},857:function(e,t,n){var r=n(50),o=n(229),c=n(52),l=Math.ceil,d=function(e){return function(t,n,d){var f,v,h=String(c(t)),m=h.length,k=void 0===d?" ":String(d),x=r(n);return x<=m||""==k?h:(f=x-m,(v=o.call(k,l(f/k.length))).length>f&&(v=v.slice(0,f)),e?h+v:v+h)}};e.exports={start:d(!1),end:d(!0)}},858:function(e,t,n){var r=n(127);e.exports=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(r)},893:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={install:function(e,t){var n={},r=!1,o=function(e,t,r){return r&&(e in n||(n[e]=[]),n[e].push({modifiers:t,e:r})),n[e]},c={bind:function(e,t){var n=t.arg,c=t.modifiers,l=t.value,d=void 0===l?function(element,e,t){var n=t.x;t.y&&(e.scrollTop=element.scrollTop*(e.scrollHeight-e.clientHeight)/(element.scrollHeight-element.clientHeight)),n&&(e.scrollLeft=element.scrollLeft*(e.scrollWidth-e.clientWidth)/(element.scrollWidth-element.clientWidth))}:l;"x"in c||"y"in c||(c.x=!0,c.y=!0),o(n,c,e),e.addEventListener("scroll",(function(){r||(r=!0,requestAnimationFrame((function(){o(n).filter((function(t){return t.e!==e})).forEach((function(t){var n=t.modifiers,r=t.e;d(e,r,n)})),requestAnimationFrame((function(){r=!1}))})))}))}};e.directive("scroll-sync",c)}};t.default=r},894:function(e,t,n){var content=n(1061);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(57).default)("6fc677ea",content,!0,{sourceMap:!1})}}]);