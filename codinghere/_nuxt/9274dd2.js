(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{1108:function(t,e,n){var content=n(1302);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(57).default)("66653b10",content,!0,{sourceMap:!1})},1109:function(t,e,n){var content=n(1304);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(57).default)("a163fa06",content,!0,{sourceMap:!1})},1128:function(t,e,n){"use strict";n.r(e);n(10),n(14),n(18),n(12),n(58),n(156),n(30),n(9),n(160),n(15),n(49);var r=n(7),o=n(855),c=n(26),l={props:{cid:String},data:function(){return{infoAlert:!1,info:{title:"",message:""},search:!1,searchEID:null,searchUID:null,courseStudents:null,exams:[],showCopy:!1,toCopy:null,teachCourses:[],copy:{course:null,name:""},short:!0,fields:[{key:"name",label:"Name",sortable:!0,sortDirection:"desc"},{key:"tscore",label:"Score",sortable:!1},{key:"tlimit",label:"Time",sortable:!1},{key:"probs",label:"Detail",sortable:!1},{key:"actions",label:"Action",class:"text-center"}],totalRows:1,currentPage:1,perPage:5,pageOptions:[5,10,15],sortBy:"",sortDesc:!1,sortDirection:"asc",filter:null,filterOn:[],todel:null,selected:[],cachequiz:{},tmap:{singlechoice:0,fillin:1,functest:2,progtest:3},localeText:{ExamMan_WhichStudent:"哪一位學生？",ExamMan_NewTitle:"新的名稱",ExamMan_QuizType:"題目類型",ExamMan_Short:"短",ExamMan_Long:"長",SYS_Delete:"刪除",SYS_Copy:"複製",SYS_Clear:"清除",SYS_New:"新建"}}},created:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.localeText=t.$updateLocaleText(t.localeText),e.next=3,t.$store.dispatch("getCourse",t.cid);case 3:(n=e.sent).exams&&(t.exams=n.exams||[]),t.totalRows=t.exams.length;case 6:case"end":return e.stop()}}),e)})))()},methods:{startexam:function(t){this.$emit("start",t)},checkUserExam:function(){this.search=!1,this.$router.push("/teacher/".concat(this.cid,"/exams/").concat(this.searchEID,"/").concat(this.searchUID))},prepareSearch:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r,o,c,p;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.search=!0,e.searchEID=t.id,n.next=4,e.$store.dispatch("getCourse",e.cid);case 4:if(r=n.sent,!e.courseStudents){for(c in o=[{value:null,text:"Please select the student"}],r.students)p=r.students[c],o.push({value:c+"##"+p.name,text:p.stdID+" "+p.name});e.courseStudents=o}case 6:case"end":return n.stop()}}),n)})))()},prepareCopy:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.showCopy=!0,e.toCopy=e.$copyObject(t),e.teachCourses=[{value:null,text:"Please select an option"}],n.next=5,e.$store.dispatch("getCourse","LIST");case 5:(r=n.sent)&&function(){var t=e.$user("id");for(var n in r){var o=r[n];o.teachers&&o.teachers.some((function(e){return e.id==t}))&&e.teachCourses.push({value:n,text:o.name})}}(),e.copy.course=e.cid;case 8:case"end":return n.stop()}}),n)})))()},monitor:function(t){var e=t.id,n="/teacher/".concat(this.cid,"/exams/").concat(e,"/monitor");this.$router.push(n)},onRowSelected:function(t){this.selected=t,this.$emit("rowSelected",t)},onFiltered:function(t){t&&(this.totalRows=t.length,this.currentPage=1)},editexam:function(t){this.$router.push("/teacher/".concat(this.cid,"/exams/").concat(t.id))},copyexam:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,l,m,d,f,x;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.d.collection("exams").doc(t.toCopy.id).get();case 2:return n=e.sent,(l=n.data()).name=t.copy.name,delete t.toCopy.id,(m=t.toCopy).name=t.copy.name,d=c.d.collection("courses").doc(t.copy.course),f=c.d.collection("exams").doc(),x=null,e.prev=11,e.next=14,c.d.runTransaction(function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(e){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get(d);case 2:return n=t.sent,t.next=5,e.set(f,l);case 5:return(r=m).id=f.id,(x=n.data().exams||[]).push(r),t.next=11,e.set(d,{exams:x,updated:o.a.getNow()},{merge:!0});case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 14:t.$store.commit("updateCourse",{id:t.copy.course,value:{exams:x}}),t.exams=x,t.totalRows=t.exams.length,t.infoAlert=!0,t.info={title:"Exam",message:"Copy Exam OK!"},e.next=24;break;case 21:e.prev=21,e.t0=e.catch(11),alert(e.t0);case 24:case"end":return e.stop()}}),e,null,[[11,21]])})))()},testexam:function(t){this.$store.commit("setObject",{key:"exam",value:t}),this.$router.push("/teacher/".concat(this.cid,"/exams/").concat(t.id,"/test"))},deleteexam:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=o.a.findIdPos(t.exams,t.todel.id))<0)){e.next=3;break}return e.abrupt("return");case 3:return t.exams.splice(n,1),e.next=6,t.$store.dispatch("updateCourse",{id:t.cid,value:{exams:t.exams}});case 6:return e.next=8,t.$store.dispatch("getCourse",t.cid);case 8:r=e.sent,t.exams=r.exams||[],t.infoAlert=!0,t.info={title:"Exam",message:"Delete Exam OK!"};case 12:case"end":return e.stop()}}),e)})))()},deleteconfirm:function(t){this.todel=t,this.$bvModal.show("modal-delete")},typcmp:function(t,e){return this.tmap[t.type]-this.tmap[e.type]},listprobshort:function(t){var e=this,n=0,r=[0,0,0,0];return t.forEach((function(t){n+=t.tlimit;var o=e.tmap[t.type];r[o]++})),"單選".concat(r[0],"，填空").concat(r[1],"，函式").concat(r[2],"，程式").concat(r[3])+"；共".concat(o.a.hhmmss(n))},listprob:function(t){var e=this,n=0,r=t.map((function(p){var t={id:p.id};return t.title=p.title,t.question=p.question,t.timelimit=p.tlimit,n+=p.tlimit,t.score=p.score,t.type=p.type,t}));return r.sort(this.typcmp),"Total Time = "+o.a.hhmmss(n)+"<br>"+r.map((function(t){return e.typename(t.type)+"--"+e.$selectUserLocaleText(t.title)+"--"+t.score+"--"+o.a.hhmmss(t.timelimit)})).join("<br>")},typename:function(t){return"singlechoice"===t?"單選":"fillin"===t?"填充":"functest"===t?"函式":"progtest"===t?"程式":"？？"}},watch:{exams:function(t){this.totalRows=this.exams.length}}},m=(n(1301),n(55)),component=Object(m.a)(l,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"qpanel"},[n("b-modal",{attrs:{title:t.info.title},model:{value:t.infoAlert,callback:function(e){t.infoAlert=e},expression:"infoAlert"}},[t._v(t._s(t.info.message)+"\n    ")]),t._v(" "),n("b-modal",{attrs:{title:t.localeText.ExamMan_WhichStudent},on:{ok:t.checkUserExam},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}},[n("b-form-select",{staticClass:"mt-3",attrs:{options:t.courseStudents,size:"sm"},model:{value:t.searchUID,callback:function(e){t.searchUID=e},expression:"searchUID"}})],1),t._v(" "),n("b-modal",{attrs:{title:t.localeText.SYS_Copy},on:{ok:t.copyexam},model:{value:t.showCopy,callback:function(e){t.showCopy=e},expression:"showCopy"}},[n("b-form-select",{staticClass:"mt-3",attrs:{options:t.teachCourses,size:"sm"},model:{value:t.copy.course,callback:function(e){t.$set(t.copy,"course",e)},expression:"copy.course"}}),t._v(" "),n("b-input",{staticClass:"mt-3",attrs:{size:"sm",placeholder:t.localeText.ExamMan_NewTitle},model:{value:t.copy.name,callback:function(e){t.$set(t.copy,"name",e)},expression:"copy.name"}})],1),t._v(" "),n("b-row",[n("b-col",{staticClass:"my-1",attrs:{md:"4"}},[n("b-form-group",{staticClass:"mb-0",attrs:{label:"Filter","label-cols-sm":"3","label-align-sm":"right","label-size":"sm","label-for":"filterInput"}},[n("b-input-group",{attrs:{size:"sm"}},[n("b-form-input",{attrs:{type:"search",id:"filterInput",placeholder:t.localeText.ExamMan_QuizType},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}}),t._v(" "),n("b-input-group-append",[n("b-button",{attrs:{disabled:!t.filter},on:{click:function(e){t.filter=""}}},[t._v(t._s(t.localeText.SYS_Clear))])],1)],1)],1)],1),t._v(" "),n("b-col",{staticClass:"my-1",attrs:{md:"2"}},[n("b-form-group",{staticClass:"mb-0",attrs:{label:"N","label-cols-sm":"6","label-cols-md":"4","label-cols-lg":"3","label-align-sm":"right","label-size":"sm","label-for":"perPageSelect"}},[n("b-form-select",{attrs:{id:"perPageSelect",size:"sm",options:t.pageOptions},model:{value:t.perPage,callback:function(e){t.perPage=e},expression:"perPage"}})],1)],1),t._v(" "),n("b-col",{staticClass:"my-1",attrs:{md:"2"}},[n("b-button",{attrs:{size:"sm",variant:"outline-success",to:"/teacher/"+t.cid+"/exams/examadd"}},[t._v(t._s(t.localeText.SYS_New))]),t._v(" "),n("b-button",{attrs:{size:"sm",variant:"outline-success"},on:{click:function(e){t.short=!t.short}}},[t._v(t._s(t.short?t.localeText.ExamMan_Long:t.localeText.ExamMan_Short))])],1),t._v(" "),n("b-col",{staticClass:"my-1",attrs:{md:"4"}},[n("b-pagination",{staticClass:"my-0",attrs:{"total-rows":t.totalRows,"per-page":t.perPage,align:"fill",size:"sm"},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)],1),t._v(" "),n("b-modal",{attrs:{id:"modal-delete",title:t.localeText.SYS_Delete},on:{ok:function(e){return t.deleteexam()}}},[n("p",{staticClass:"my-4"},[t._v(t._s(t.todel&&t.todel.name))])]),t._v(" "),n("b-table",{staticClass:"mt-3",attrs:{"show-empty":"",small:"",stacked:"md",selectable:!0,"select-mode":"range",items:t.exams,fields:t.fields,"current-page":t.currentPage,"per-page":t.perPage,filter:t.filter,filterIncludedFields:t.filterOn,"sort-by":t.sortBy,"sort-desc":t.sortDesc,"sort-direction":t.sortDirection},on:{"update:sortBy":function(e){t.sortBy=e},"update:sort-by":function(e){t.sortBy=e},"update:sortDesc":function(e){t.sortDesc=e},"update:sort-desc":function(e){t.sortDesc=e},filtered:t.onFiltered,"row-selected":t.onRowSelected},scopedSlots:t._u([{key:"cell(probs)",fn:function(data){return[t.short?n("span",{domProps:{innerHTML:t._s(t.listprobshort(data.value))}}):n("span",{domProps:{innerHTML:t._s(t.listprob(data.value))}})]}},{key:"cell(actions)",fn:function(e){return[n("b-button-group",[n("b-button",{attrs:{size:"sm",variant:"outline-primary"},on:{click:function(n){return t.startexam(e.item)}}},[n("b-icon",{attrs:{icon:"arrow-right-circle"}})],1),t._v(" "),n("b-button",{attrs:{size:"sm",variant:"outline-primary"},on:{click:function(n){return t.testexam(e.item)}}},[n("b-icon",{attrs:{icon:"check"}})],1),t._v(" "),n("b-button",{attrs:{size:"sm",variant:"outline-primary"},on:{click:function(n){return t.editexam(e.item)}}},[n("b-icon",{attrs:{icon:"pen"}})],1),t._v(" "),n("b-button",{attrs:{size:"sm",variant:"outline-primary"},on:{click:function(n){return t.prepareCopy(e.item)}}},[n("b-icon",{attrs:{icon:"back"}})],1),t._v(" "),n("b-button",{attrs:{size:"sm",variant:"outline-primary"},on:{click:function(n){return t.deleteconfirm(e.item)}}},[n("b-icon",{attrs:{icon:"trash"}})],1),t._v(" "),n("b-button",{attrs:{size:"sm",variant:"outline-primary"},on:{click:function(n){return t.monitor(e.item)}}},[n("b-icon",{attrs:{icon:"eye"}})],1),t._v(" "),n("b-button",{attrs:{size:"sm",variant:"outline-primary"},on:{click:function(n){return t.prepareSearch(e.item)}}},[n("b-icon",{attrs:{icon:"search"}})],1)],1)]}}])})],1)}),[],!1,null,"1f0074a6",null);e.default=component.exports},1301:function(t,e,n){"use strict";n(1108)},1302:function(t,e,n){(e=n(56)(!1)).push([t.i,".modal-content[data-v-1f0074a6]{position:fixed;left:365px;top:365px;width:50%;height:50%;background:#e0ffff}",""]),t.exports=e},1303:function(t,e,n){"use strict";n(1109)},1304:function(t,e,n){(e=n(56)(!1)).push([t.i,"section{color:#00f;font-size:120%}",""]),t.exports=e},1391:function(t,e,n){"use strict";n.r(e);n(30),n(49);var r=n(7),o=n(1128),c=n(26),l={props:{course:Object},components:{ExamMan:o.default},data:function(){return{showExam:!1,examTitle:"Exam",contest:!1,runningexam:null,examselected:[],checkcode:null,userlimit:null,localeText:{Admin_ExamList:"考試列表",Admin_ExamRunning:"考試進行中...",Admin_Contest:"競賽",Admin_Stop:"結束",Admin_NoRunningExam:"目前沒有考試",Admin_ExamCheckCode:"檢查碼",Admin_ExamUserLimit:"限制使用者",Admin_ExamStart:"開始",SYS_Cancel:"取消"}}},computed:{cid:function(){return this.$route.params.cid}},created:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.localeText=t.$updateLocaleText(t.localeText),!1,e.next=4,c.d.collection("comms").doc("user").get();case 4:(n=e.sent).exists&&(r=n.data())[t.cid]&&r[t.cid].cmd&&"startExam"===r[t.cid].cmd&&"exam"===r[t.cid].examtype?(t.runningexam=r[t.cid].name,t.contest="contest"===r[t.cid].examtype):t.runningexam=null;case 6:case"end":return e.stop()}}),e)})))()},methods:{examConfig:function(t){this.examTitle=t.name,this.examselected=[t],this.showExam=!0},startexam:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(1===e.examselected.length){n.next=2;break}return n.abrupt("return");case 2:return(r={})[e.cid]={cmd:"startExam",name:e.examselected[0].name,examid:e.examselected[0].id,checkcode:e.checkcode,userlimit:e.userlimit,examtype:t},e.contest="contest"===t,n.prev=5,n.next=8,c.d.collection("comms").doc("user").set(r,{merge:!0});case 8:e.runningexam=e.examselected[0].name,e.showExam=!1,n.next=15;break;case 12:n.prev=12,n.t0=n.catch(5),alert(n.t0);case 15:case"end":return n.stop()}}),n,null,[[5,12]])})))()},examRowSelected:function(t){this.examselected=t},stopexam:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n={})[t.cid]={cmd:"stopExam"},e.next=4,c.d.collection("comms").doc("user").set(n,{merge:!0});case 4:t.runningexam=null;case 5:case"end":return e.stop()}}),e)})))()}}},m=(n(1303),n(55)),component=Object(m.a)(l,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-container",{attrs:{fluid:""}},[n("section",{staticClass:"my-4"},[t._v(t._s(t.localeText.Admin_ExamList))]),t._v(" "),t.runningexam?n("div",[t._v("\n        "+t._s(t.runningexam)+" "+t._s(t.localeText.Admin_ExamRunning)+" \n        "),t.contest?n("span",{staticClass:"ml-3"},[t._v("("+t._s(t.localeText.Admin_Contest)+")")]):t._e(),t._v(" "),n("b-button",{staticClass:"ml-3",attrs:{size:"sm",variant:"outline-success"},on:{click:t.stopexam}},[t._v(t._s(t.localeText.Admin_Stop))])],1):n("div",[t._v("\n        "+t._s(t.localeText.Admin_NoRunningExam)+"\n    ")]),t._v(" "),n("hr"),t._v(" "),n("b-modal",{attrs:{size:"lg",title:t.examTitle,"hide-footer":""},model:{value:t.showExam,callback:function(e){t.showExam=e},expression:"showExam"}},[n("b-row",[n("b-col",{attrs:{sm:"3"}},[n("label",[t._v(t._s(t.localeText.Admin_ExamCheckCode))])]),t._v(" "),n("b-col",{attrs:{cols:"9"}},[n("b-form-input",{attrs:{type:"text",placeholder:t.localeText.Admin_ExamCheckCode},model:{value:t.checkcode,callback:function(e){t.checkcode=e},expression:"checkcode"}})],1)],1),t._v(" "),n("b-row",{staticClass:"mt-3"},[n("b-col",{attrs:{sm:"3"}},[n("label",[t._v(t._s(t.localeText.Admin_ExamUserLimit))])]),t._v(" "),n("b-col",{attrs:{cols:"9"}},[n("b-form-input",{attrs:{type:"text",placeholder:t.localeText.Admin_ExamUserLimit},model:{value:t.userlimit,callback:function(e){t.userlimit=e},expression:"userlimit"}})],1)],1),t._v(" "),n("p",{staticClass:"mt-4",attrs:{align:"right"}},[n("b-button",{attrs:{variant:"outline-success"},on:{click:function(e){t.showExam=!1}}},[t._v(t._s(t.localeText.SYS_Cancel))]),t._v(" "),n("b-button",{staticClass:"ml-3",attrs:{variant:"outline-success"},on:{click:function(e){return t.startexam("contest")}}},[t._v(t._s(t.localeText.Admin_Contest))]),t._v(" "),n("b-button",{staticClass:"ml-3",attrs:{variant:"outline-success"},on:{click:function(e){return t.startexam("exam")}}},[t._v(t._s(t.localeText.Admin_ExamStart))])],1)],1),t._v(" "),n("ExamMan",{staticClass:"mt-4",attrs:{cid:t.cid},on:{rowSelected:t.examRowSelected,start:t.examConfig}})],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{ExamMan:n(1128).default})},855:function(t,e,n){"use strict";n(10),n(14),n(22),n(86),n(9),n(856),n(29),n(15);var r=n(228),o=n.n(r),c={pad:function(t){return("0"+t).slice(-2)},mmss:function(t){var e=Math.floor(t/60);return t%=60,"".concat(this.pad(e),":").concat(this.pad(t))},hhmmss:function(t){var e=Math.floor(t/60);t%=60;var n=Math.floor(e/60);return e%=60,"".concat(this.pad(n),":").concat(this.pad(e),":").concat(this.pad(t))},getToday:function(){var t=new Date,dd=String(t.getDate()).padStart(2,"0"),e=String(t.getMonth()+1).padStart(2,"0");return t.getFullYear()+e+dd},getNow:function(){var t=new Date;return""+t.getFullYear()+this.pad(t.getMonth()+1)+this.pad(t.getDate())+this.pad(t.getHours())+this.pad(t.getMinutes())+this.pad(t.getSeconds())},obj2arr:function(t){var e=[],n=Object.keys(t);return n.sort(),n.forEach((function(n){e.push(Object.assign({id:n},t[n]))})),e},arr2obj:function(t){var e={};return t.forEach((function(t){var n=JSON.parse(JSON.stringify(t)),r=t.id;delete n.id,e[r]=n})),e},getOptions:function(t){var e=[];return t.split("#@@#").forEach((function(t){var s=t.split("#@");e.push({text:s[0],value:s[1]})})),e},findIdPos:function(t,e){if(!t)return-1;for(var n=0;n<t.length;n++)if(e==t[n].id)return n;return-1},encode:function(t,e){return new o.a(t).encrypt(e)},decode:function(t,e){return new o.a(t).decrypt(e)}};e.a=c},856:function(t,e,n){"use strict";var r=n(8),o=n(857).start;r({target:"String",proto:!0,forced:n(858)},{padStart:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})},857:function(t,e,n){var r=n(50),o=n(229),c=n(52),l=Math.ceil,m=function(t){return function(e,n,m){var d,f,x=String(c(e)),h=x.length,v=void 0===m?" ":String(m),_=r(n);return _<=h||""==v?x:(d=_-h,(f=o.call(v,l(d/v.length))).length>d&&(f=f.slice(0,d)),t?x+f:f+x)}};t.exports={start:m(!1),end:m(!0)}},858:function(t,e,n){var r=n(127);t.exports=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(r)}}]);