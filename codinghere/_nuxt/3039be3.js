(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{1159:function(e,t,r){"use strict";r.r(t);r(30),r(49);var n=r(8),o=(r(902),r(867)),c=r(32),d=r(843),m={components:{ProgTest:o.default},data:function(){return{reExam:!1,time:10,index:0,totalScore:0,skip:!1,finished:!1,problems:[],exam:null,record:{userid:null,examid:null,courseid:null,date:null,submits:{},score:0},recordId:null}},computed:{ready:function(){return this.problems&&this.problems.length>0},tick:function(){return this.$store.state.params.tick},eid:function(){return this.$store.state.vparams.exam.examid},cid:function(){return this.$store.state.vparams.exam.courseid}},created:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$store.state.vparams.exam){t.next=3;break}return e.$router.push("/user"),t.abrupt("return");case 3:return t.next=5,c.d.collection("exams").doc(e.eid).get();case 5:r=t.sent,n=r.data(),e.exam=n,e.setExam();case 9:case"end":return t.stop()}}),t)})))()},methods:{skipproblem:function(){this.skip=!0},submit:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n,o,m,l,f,x,h,v,k,w;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e.correct&&(t.totalScore+=t.problems[t.index].score),t.record.submits[t.problems[t.index].id]=e,t.record.score=t.totalScore,0!=t.index||t.reExam){r.next=17;break}return n=c.d.batch(),o=c.d.collection("answers").doc(),m=c.d.collection("users").doc(t.$user("id")),n.set(o,t.record),t.recordId=o.id,l={answerid:t.recordId,name:t.record.examname,date:d.a.getToday(),score:t.totalScore,finish:!1},(f={})[t.eid]=l,n.set(m,{exams:f},{merge:!0}),r.next=15,n.commit();case 15:r.next=36;break;case 17:if(!e.correct){r.next=34;break}return r.next=20,t.getUserExamData();case 20:return r.sent[t.eid].reExam&&!t.reExam&&t.$router.push("/afterexam?taken=1"),x=c.d.batch(),h=c.d.collection("answers").doc(t.recordId),v=c.d.collection("users").doc(t.$user("id")),x.set(h,t.record),k={},w={score:t.totalScore},k[t.eid]=w,x.set(v,{exams:k},{merge:!0}),r.next=32,x.commit();case 32:r.next=36;break;case 34:return r.next=36,c.d.collection("answers").doc(t.recordId).set(t.record);case 36:t.skip=!1,!t.finished&&t.index<t.problems.length-1?t.index++:t.leave();case 38:case"end":return r.stop()}}),r)})))()},setExamContinue:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n,o,d,i,m;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.reExam=!0,t.recordId=e,r.next=4,c.d.collection("answers").doc(e).get();case 4:for(n=r.sent,t.record=n.data(),console.log("Record",t.record),o=[],d=0,i=0;i<t.exam.probs.length;i++)m=t.exam.probs[i],t.record.submits[m.id]?d+=t.record.submits[m.id].usetime:o.push(t.$copyObject(m));t.record.totaltime&&t.record.totaltime>d&&(d=t.record.totaltime),console.log("QUIZS",o),o.sort((function(e,t){return e.order-t.order!=0?e.order-t.order:Math.random()-.5})),t.time=60*t.exam.tlimit-d,t.problems=o,t.totalScore=t.record.score;case 16:case"end":return r.stop()}}),r)})))()},getUserExamData:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.$user("id"),t.next=3,c.d.collection("users").doc(r).get();case 3:return n=t.sent,t.abrupt("return",n.data().exams);case 5:case"end":return t.stop()}}),t)})))()},setExam:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getUserExamData();case 2:if(!(r=t.sent)||!r[e.eid]){t.next=7;break}return r[e.eid].reExam=!0,c.d.collection("users").doc(e.$user("id")).update({exams:r}),t.abrupt("return",e.setExamContinue(r[e.eid].answerid));case 7:(n=e.$copyObject(e.exam.probs)).sort((function(e,t){return e.order-t.order!=0?e.order-t.order:Math.random()-.5})),e.time=60*e.exam.tlimit,e.problems=n,e.record.userid=e.$user("id"),e.record.examid=e.eid,e.record.examname=e.exam.name,e.record.courseid=e.cid,e.record.date=d.a.getToday(),e.record.finish=!1;case 17:case"end":return t.stop()}}),t)})))()},leave:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,o,m,l,f,x,h,v,k;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=60*e.exam.tlimit-e.time,e.recordId){t.next=19;break}return e.record.submits={},e.record.score=0,e.record.finish=!0,e.record.totaltime=r,n=c.d.collection("answers").doc(),o=c.d.collection("users").doc(e.$user("id")),(m=c.d.batch()).set(n,e.record),e.recordId=n.id,l={answerid:e.recordId,name:e.record.examname,date:d.a.getToday(),score:0,finish:!0},(f={})[e.eid]=l,m.set(o,{exams:f},{merge:!0}),t.next=17,m.commit();case 17:t.next=28;break;case 19:return x=c.d.batch(),h=c.d.collection("answers").doc(e.recordId),v=c.d.collection("users").doc(e.$user("id")),x.set(h,{totaltime:r,finish:!0},{merge:!0}),(k={})[e.eid]={finish:!0},x.set(v,{exams:k},{merge:!0}),t.next=28,x.commit();case 28:e.finished=!0,e.$router.push("/afterexam");case 30:case"end":return t.stop()}}),t)})))()},mmss:function(e){return d.a.mmss(e)},hhmmss:function(e){return d.a.hhmmss(e)}},watch:{tick:function(e){this.time--,0===this.time&&this.leave()}}},l=r(55),component=Object(l.a)(m,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",[r("b-navbar",{attrs:{variant:"light"}},[r("b-navbar-nav",{staticClass:"mr-auto"},[r("b-nav-text",{staticClass:"text-dark"},[e._v(e._s(e.$user("name")))])],1),e._v(" "),r("b-navbar-nav",{staticClass:"mr-auto"},[r("b-nav-text",{staticClass:"text-primary"},[e._v("\n                總分 "+e._s(e.exam&&e.exam.tscore)+"，限時\n                "+e._s(e.exam&&e.exam.tlimit)+" 分鐘；   本題佔分\n                "+e._s(e.problems[e.index]&&e.problems[e.index].score)+"， 限時\n                "+e._s(e.problems[e.index]&&e.mmss(e.problems[e.index].tlimit))+"\n                   剩餘考試時間 "+e._s(e.hhmmss(e.time))+"\n            ")])],1),e._v(" "),r("b-navbar-nav",{staticClass:"mr-auto"},[e.skip?e._e():r("b-button",{staticClass:"ml-3 btn-sm btn-outline-success",attrs:{variant:"outline-success"},on:{click:function(t){return e.skipproblem()}}},[e._v("跳過本題")]),e._v(" "),r("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.modal-leave",modifiers:{"modal-leave":!0}}],staticClass:"ml-3 btn btn-sm btn-outline-danger",attrs:{variant:"outline-danger"}},[e._v("離開考場")]),e._v(" "),r("b-modal",{attrs:{id:"modal-leave",title:"溫馨提醒","ok-title":"確定","cancel-title":"取消","no-close-on-esc":!0,"no-close-on-backdrop":!0},on:{ok:function(t){return e.leave()}}},[r("p",{staticClass:"mt-4 text-danger"},[e._v("此視窗顯示時，計時不會暫停。")]),e._v(" "),r("p",{staticClass:"my-4 text-danger"},[e._v("\n                    離開考場等於交卷，不得再次進入！\n                    "),r("br"),e._v("確定要離開嗎？\n                ")])])],1),e._v(" "),r("b-navbar-nav",[r("b-nav-text",{staticClass:"text-dark"},[e._v(e._s(e.index+1)+" /\n                "+e._s(e.problems&&e.problems.length))])],1)],1),e._v(" "),e.ready&&"progtest"==e.problems[e.index].type?r("ProgTest",{key:e.index,attrs:{times:e.problems[e.index].tlimit,quiz:e.problems[e.index],submit:e.submit,skip:e.skip}}):e._e()],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{ProgTest:r(867).default})},865:function(e,t,r){var content=r(875);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(61).default)("2e95a49a",content,!0,{sourceMap:!1})},867:function(e,t,r){"use strict";r.r(t);r(365),r(49);var n=r(8),o=r(843),c=r(860),d=r(32),m={components:{ProblemSolver:c.default},props:{quiz:Object,submit:Function,times:{type:Number,default:300},skip:{type:Boolean,default:!1},lang:{type:String,default:"c"},langs:{type:String,default:"c, cpp, py"},initcode:{type:String,default:""},correctHint:{type:String,default:"正確，提交並進下一題"}},data:function(){return{lastcode:{sourceLang:"c",sourceCode:""},showPass:!1,mycode:"",codelang:"c",channel:null,chnlabel:"None",time:0,timer:null,timing:!0,spendTime:0,result:null,judging:!1,submitResult:null,pass:!1,done:!1}},computed:{tick:function(){return this.$store.state.params.tick}},created:function(){this.mycode=this.initcode,this.codelang=this.lang},mounted:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:0==e.times?e.timing=!1:e.time=e.times;case 1:case"end":return t.stop()}}),t)})))()},methods:{isubmit:function(data){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,c,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=data.cdata,n=data.result,r.sourceLang==e.lastcode.sourceLang&&r.sourceCode==e.lastcode.sourceCode){t.next=9;break}return e.lastcode={sourceLang:r.sourceLang,sourceCode:r.sourceCode},c={uid:e.$user("id"),pid:e.quiz.id,created:o.a.getNow(),lang:r.sourceLang,code:r.sourceCode,status:n.RunStatus,score:n.Score},t.next=7,d.d.collection("submits").add(c);case 7:m=t.sent,c.id=m.id;case 9:"AC"===n.RunStatus&&(e.spendTime=e.timing?e.times-e.time:0,e.showPass=!0);case 10:case"end":return t.stop()}}),t)})))()},setLang:function(e){this.codelang=e},mmss:function(e){return o.a.mmss(e)},send:function(e){this.showPass||(this.spendTime=this.timing?this.times-this.time:0),this.showPass=!1,this.done=!0,this.judging=!1,this.submit({correct:e,uans:this.lastcode.sourceCode,usetime:this.spendTime,lang:this.lastcode.sourceLang})}},watch:{tick:function(e){this.time>0&&this.time--,0===this.time&&this.send(!1)},skip:function(e){console.log("V",e),e&&!this.done&&this.send(!1)}}},l=(r(874),r(55)),component=Object(l.a)(m,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"qpanel"},[r("b-modal",{attrs:{centered:"",title:"通過測試","hide-footer":""},model:{value:e.showPass,callback:function(t){e.showPass=t},expression:"showPass"}},[r("p",{attrs:{align:"center"}},[r("b-button",{attrs:{variant:"success"},on:{click:function(t){return e.send(!0)}}},[e._v("下一題")])],1)]),e._v(" "),r("p",{staticClass:"timestatus"},[r("span",{staticClass:"type"},[e._v("《程式題》")]),e._v(" "),e.timing?r("span",[e._v("倒數計時 "+e._s(e.mmss(e.time)))]):r("span",[e._v("靜態測試")])]),e._v(" "),r("problem-solver",{attrs:{problem:e.quiz,lang:e.lang,langs:e.langs},on:{submit:e.isubmit}})],1)}),[],!1,null,"16ce9334",null);t.default=component.exports;installComponents(component,{ProblemSolver:r(860).default})},874:function(e,t,r){"use strict";r(865)},875:function(e,t,r){(t=r(60)(!1)).push([e.i,".tcenter[data-v-16ce9334]{text-align:center}.type[data-v-16ce9334]{color:#ff0}.qpanel[data-v-16ce9334]{background:#eee;padding:24px}.timestatus[data-v-16ce9334]{background:#00f;color:#fff;text-align:center}.result[data-v-16ce9334]{position:fixed;left:25%;top:25%;width:50%;height:50%;background:#ddd;z-index:100;padding:24px;border:2px solid green;overflow-y:scroll}",""]),e.exports=t}}]);