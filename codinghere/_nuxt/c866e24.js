(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{1101:function(e,r,t){var content=t(1296);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,t(57).default)("7dced2de",content,!0,{sourceMap:!1})},1295:function(e,r,t){"use strict";t(1101)},1296:function(e,r,t){(r=t(56)(!1)).push([e.i,".probLabel[data-v-7c53204c]{padding:12px 24px;margin:48px auto -30px}.probBut[data-v-7c53204c]{width:100%;font-size:120%}",""]),e.exports=r},1391:function(e,r,t){"use strict";t.r(r);t(30),t(47),t(49);var n=t(7),o=t(26),c=t(855),d={components:{ProblemSolver:t(865).default},data:function(){return{showCorrect:!1,correctNum:0,first:!0,curProblem:null,curCode:"",curLang:"c",codes:{},dummy:0,reExam:!1,answers:{},time:10,totalScore:0,finished:!1,problems:[],exam:null,record:{userid:null,examid:null,courseid:null,date:null,submits:{},score:0},recordId:null}},computed:{tick:function(){return this.$store.state.params.tick},eid:function(){return this.$store.state.vparams.exam.examid},cid:function(){return this.$store.state.vparams.exam.courseid}},created:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var t,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e.$store.state.vparams.exam){r.next=3;break}return e.$router.push("/user"),r.abrupt("return");case 3:return r.next=5,o.d.collection("exams").doc(e.eid).get();case 5:t=r.sent,n=t.data(),e.exam=n,e.setExam();case 9:case"end":return r.stop()}}),r)})))()},methods:{probColor:function(e){return e&&e.id&&this.curProblem?this.answers[e.id]&&this.answers[e.id].correct?e.id===this.curProblem.id?"success":"outline-success":this.answers[e.id]&&!this.answers[e.id].correct?e.id===this.curProblem.id?"danger":"outline-danger":e.id===this.curProblem.id?"info":"outline-info":"outline-info"},getCode:function(data){this.codes[this.curProblem.id]=data},selectProblem:function(e){this.dummy+=1;var r=this;window.setTimeout((function(){r.curProblem=e,r.curCode="   ",r.curLang="None",r.$nextTick((function(){r.codes[e.id]||(r.codes[e.id]={code:"",lang:"c"}),r.curCode=r.codes[e.id].code,r.curLang=r.codes[e.id].lang}))}),100)},submit:function(data){var e=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var t,n,d,l,m,h,f,x,v,w,k,C,P,_,S;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t=data.cdata,n=data.result,!(d=e.answers[e.curProblem.id])||t.sourceLang!==d.lang||t.sourceCode!==d.uans){r.next=5;break}return r.abrupt("return");case 5:return l={uid:e.$user("id"),pid:e.curProblem.id,created:c.a.getNow(),lang:t.sourceLang,code:t.sourceCode,status:n.RunStatus,score:n.Score},r.next=8,o.d.collection("submits").add(l);case 8:if(!d||!d.correct){r.next=10;break}return r.abrupt("return");case 10:if(m={correct:"AC"===n.RunStatus,uans:t.sourceCode,lang:t.sourceLang,usetime:60*e.exam.tlimit-e.time},e.answers[e.curProblem.id]=m,m.correct&&(e.correctNum+=1,e.totalScore+=e.curProblem.score),e.record.score=e.totalScore,!e.first||e.reExam){r.next=30;break}return e.record.submits=e.answers,h=o.d.batch(),f=o.d.collection("answers").doc(),x=o.d.collection("users").doc(e.$user("id")),h.set(f,e.record),e.recordId=f.id,v={answerid:e.recordId,name:e.record.examname,date:c.a.getToday(),score:e.totalScore,finish:!1},(w={})[e.eid]=v,h.set(x,{exams:w},{merge:!0}),r.next=27,h.commit();case 27:e.first=!1,r.next=49;break;case 30:if(!m.correct){r.next=47;break}return r.next=33,e.getUserExamData();case 33:return r.sent[e.eid].reExam&&!e.reExam&&e.$router.push("/afterexam?taken=1"),k=o.d.batch(),C=o.d.collection("answers").doc(e.recordId),P=o.d.collection("users").doc(e.$user("id")),k.set(C,e.record),_={},S={score:e.totalScore},_[e.eid]=S,k.set(P,{exams:_},{merge:!0}),r.next=45,k.commit();case 45:r.next=49;break;case 47:return r.next=49,o.d.collection("answers").doc(e.recordId).set(e.record);case 49:m.correct&&(e.showCorrect=!0);case 50:case"end":return r.stop()}}),r)})))()},checkFinish:function(){this.correctNum===this.problems.length&&this.leave()},setExamContinue:function(e){var r=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var n,c,i,d,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.reExam=!0,r.recordId=e,t.next=4,o.d.collection("answers").doc(e).get();case 4:for(n=t.sent,r.record=n.data(),r.answers=r.record.submits,c=0,i=0;i<r.exam.probs.length;i++)d=r.exam.probs[i],r.record.submits[d.id]?(l=r.record.submits[d.id],c+=l.usetime,r.codes[d.id]={lang:l.lang,code:l.uans},l.correct?r.correctNum+=1:r.curProblem=d):r.curProblem||(r.curProblem=d,r.codes[d.id]={lang:"c",code:""});r.record.totaltime&&r.record.totaltime>c&&(c=r.record.totaltime),r.time=60*r.exam.tlimit-c,r.problems=r.$copyObject(r.exam.probs),r.totalScore=r.record.score,r.selectProblem(r.curProblem);case 14:case"end":return t.stop()}}),t)})))()},getUserExamData:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var t,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.$user("id"),r.next=3,o.d.collection("users").doc(t).get();case 3:return n=r.sent,r.abrupt("return",n.data().exams);case 5:case"end":return r.stop()}}),r)})))()},setExam:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var t;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.getUserExamData();case 2:if(!(t=r.sent)||!t[e.eid]){r.next=7;break}return t[e.eid].reExam=!0,o.d.collection("users").doc(e.$user("id")).update({exams:t}),r.abrupt("return",e.setExamContinue(t[e.eid].answerid));case 7:e.time=60*e.exam.tlimit,e.problems=e.$copyObject(e.exam.probs),e.record.userid=e.$user("id"),e.record.examid=e.eid,e.record.examname=e.exam.name,e.record.courseid=e.cid,e.record.date=c.a.getToday(),e.record.finish=!1,e.curProblem=e.problems[0],e.codes[e.curProblem.id]={lang:"c",code:""};case 17:case"end":return r.stop()}}),r)})))()},leave:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var t,n,d,l,m,h,f,x,v,w;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t=60*e.exam.tlimit-e.time,e.recordId){r.next=19;break}return e.record.submits={},e.record.score=0,e.record.finish=!0,e.record.totaltime=t,n=o.d.collection("answers").doc(),d=o.d.collection("users").doc(e.$user("id")),(l=o.d.batch()).set(n,e.record),e.recordId=n.id,m={answerid:e.recordId,name:e.record.examname,date:c.a.getToday(),score:0,finish:!0},(h={})[e.eid]=m,l.set(d,{exams:h},{merge:!0}),r.next=17,l.commit();case 17:r.next=28;break;case 19:return f=o.d.batch(),x=o.d.collection("answers").doc(e.recordId),v=o.d.collection("users").doc(e.$user("id")),f.set(x,{totaltime:t,finish:!0},{merge:!0}),(w={})[e.eid]={finish:!0},f.set(v,{exams:w},{merge:!0}),r.next=28,f.commit();case 28:e.finished=!0,e.$router.push("/afterexam");case 30:case"end":return r.stop()}}),r)})))()},mmss:function(e){return c.a.mmss(e)},hhmmss:function(e){return c.a.hhmmss(e)}},watch:{tick:function(e){this.time--,0===this.time&&this.leave()}}},l=(t(1295),t(55)),component=Object(l.a)(d,(function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("b-container",{attrs:{fluid:""}},[t("b-modal",{attrs:{title:"通過"},on:{ok:e.checkFinish,cancel:e.checkFinish,hidden:e.checkFinish},model:{value:e.showCorrect,callback:function(r){e.showCorrect=r},expression:"showCorrect"}},[t("p",[e._v("本題已完成！")]),e._v(" "),e.correctNum===e.problems.length?t("p",[e._v("\n            恭喜已完成所有題目！\n        ")]):e._e()]),e._v(" "),t("b-modal",{attrs:{id:"modal-leave",title:"溫馨提醒","ok-title":"確定","cancel-title":"取消","no-close-on-esc":!0,"no-close-on-backdrop":!0},on:{ok:function(r){return e.leave()}}},[t("p",{staticClass:"mt-4 text-danger"},[e._v("此視窗顯示時，計時不會暫停。")]),e._v(" "),t("p",{staticClass:"my-4 text-danger"},[e._v("\n            離開考場等於交卷，不得再次進入！\n            "),t("br"),e._v("確定要離開嗎？\n        ")])]),e._v(" "),t("b-row",{staticClass:"mt-3"},[t("b-col",{attrs:{cols:"3"}},e._l(e.problems,(function(r,n){return t("div",{key:r.key,staticClass:"probLabel"},[t("b-button",{staticClass:"probBut",attrs:{variant:e.probColor(r)},on:{click:function(t){return e.selectProblem(r)}}},[e._v("\n                    "+e._s(n+1)+" - "+e._s(r.title.en)+"\n                ")])],1)})),0),e._v(" "),t("b-col",{attrs:{cols:"9"}},[t("p",[t("span",{staticClass:"ml-4"},[e._v("限時\n                    "+e._s(e.exam&&e.exam.tlimit)+" 分鐘，剩餘考試時間 "+e._s(e.hhmmss(e.time)))]),e._v(" "),t("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.modal-leave",modifiers:{"modal-leave":!0}}],staticClass:"ml-4 btn btn-sm btn-outline-danger",attrs:{variant:"outline-danger"}},[e._v("離開考場")])],1),e._v(" "),e.curProblem&&e.curProblem?t("div",[t("problem-solver",{attrs:{problem:e.curProblem,initCode:e.curCode,lang:e.curLang,dummy:e.dummy},on:{submit:e.submit,getCode:e.getCode}})],1):t("div",[e._v("\n                Loading...\n            ")])])],1)],1)}),[],!1,null,"7c53204c",null);r.default=component.exports;installComponents(component,{ProblemSolver:t(865).default})},855:function(e,r,t){"use strict";t(10),t(14),t(22),t(86),t(9),t(856),t(29),t(15);var n=t(228),o=t.n(n),c={pad:function(e){return("0"+e).slice(-2)},mmss:function(e){var r=Math.floor(e/60);return e%=60,"".concat(this.pad(r),":").concat(this.pad(e))},hhmmss:function(e){var r=Math.floor(e/60);e%=60;var t=Math.floor(r/60);return r%=60,"".concat(this.pad(t),":").concat(this.pad(r),":").concat(this.pad(e))},getToday:function(){var e=new Date,dd=String(e.getDate()).padStart(2,"0"),r=String(e.getMonth()+1).padStart(2,"0");return e.getFullYear()+r+dd},getNow:function(){var e=new Date;return""+e.getFullYear()+this.pad(e.getMonth()+1)+this.pad(e.getDate())+this.pad(e.getHours())+this.pad(e.getMinutes())+this.pad(e.getSeconds())},obj2arr:function(e){var r=[],t=Object.keys(e);return t.sort(),t.forEach((function(t){r.push(Object.assign({id:t},e[t]))})),r},arr2obj:function(e){var r={};return e.forEach((function(e){var t=JSON.parse(JSON.stringify(e)),n=e.id;delete t.id,r[n]=t})),r},getOptions:function(e){var r=[];return e.split("#@@#").forEach((function(e){var s=e.split("#@");r.push({text:s[0],value:s[1]})})),r},findIdPos:function(e,r){if(!e)return-1;for(var t=0;t<e.length;t++)if(r==e[t].id)return t;return-1},encode:function(e,r){return new o.a(e).encrypt(r)},decode:function(e,r){return new o.a(e).decrypt(r)}};r.a=c},856:function(e,r,t){"use strict";var n=t(8),o=t(857).start;n({target:"String",proto:!0,forced:t(858)},{padStart:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},857:function(e,r,t){var n=t(50),o=t(229),c=t(52),d=Math.ceil,l=function(e){return function(r,t,l){var m,h,f=String(c(r)),x=f.length,v=void 0===l?" ":String(l),w=n(t);return w<=x||""==v?f:(m=w-x,(h=o.call(v,d(m/v.length))).length>m&&(h=h.slice(0,m)),e?f+h:h+f)}};e.exports={start:l(!1),end:l(!0)}},858:function(e,r,t){var n=t(127);e.exports=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(n)},866:function(e,r,t){(r=t(56)(!1)).push([e.i,'.vdr{touch-action:none;border:1px dashed #000}.handle,.vdr{position:absolute;box-sizing:border-box}.handle{width:10px;height:10px;background:#eee;border:1px solid #333}.handle-tl{top:-10px;left:-10px;cursor:nw-resize}.handle-tm{top:-10px;left:50%;margin-left:-5px;cursor:n-resize}.handle-tr{top:-10px;right:-10px;cursor:ne-resize}.handle-ml{left:-10px;cursor:w-resize}.handle-ml,.handle-mr{top:50%;margin-top:-5px}.handle-mr{right:-10px;cursor:e-resize}.handle-bl{bottom:-10px;left:-10px;cursor:sw-resize}.handle-bm{bottom:-10px;left:50%;margin-left:-5px;cursor:s-resize}.handle-br{bottom:-10px;right:-10px;cursor:se-resize}@media only screen and (max-width:768px){[class*=handle-]:before{content:"";left:-10px;right:-10px;bottom:-10px;top:-10px;position:absolute}}',""]),e.exports=r},875:function(e,r,t){var content=t(866);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,t(57).default)("649448c2",content,!0,{sourceMap:!1})}}]);