(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1060:function(e,t,r){"use strict";r.r(t);r(9),r(157),r(156),r(30),r(103),r(28),r(42),r(841),r(54);var n=r(10),o=r(34),c=r(846),l=r(840),d=r(865),m=r(856),f=r(899),h={components:{ItemList:c.default,UserSelector:d.default,ProblemSelector:m.default,CourseBasic:f.default},data:function(){return{cnLang:"en",courseNews:null,selectUser:!1,kind:"",playgroundStat:{},courseScores:[],scoreFields:[],courses:[],coursesAll:{},curCourse:null,curCourseAll:null,cunits:[],curUnit:null,selUnitProb:!1,unitIdx:null,showItem:"List",showUnitUpdate:!1,infoAlert:!1,courseEditMode:!1,unitEditMode:!1,problems:[],pgproblems:[],info:{title:"",message:""},locales:[{zh:"中文"}],unitForm:{name:"",startDate:"",endDate:"",probs:[]},localeText:{AdminCourse_Title:"課程",Common_Edit:"編輯",Common_Copy:"複製",Common_New:"新增"}}},created:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,i,o,c,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.localeText=e.$updateLocaleText(e.localeText),t.next=3,e.$store.dispatch("getCourse","LIST");case 3:if(r=t.sent)for((n=Object.keys(r)).sort(),i=0;i<n.length;i++)(o=r[n[i]]).id=n[i],"admin"==e.$user("role")||"maintainer"==e.$user("role")?e.courses.push(o):(c=e.$user("id"),d=!1,o.teachers&&l.a.findIdPos(o.teachers,c)>=0&&(d=!0),!d&&o.assistants&&l.a.findIdPos(o.assistants,c)>=0&&(d=!0),d&&e.courses.push(o));case 5:case"end":return t.stop()}}),t)})))()},methods:{sname:function(e){return this.curCourseAll&&this.curCourseAll.students&&this.curCourseAll.students[e]?this.curCourseAll.students[e].name:"Wait..."},updateUnit:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var i,r,n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(i=0;i<e.unitForm.probs.length;i++)delete e.unitForm.probs[i]._showDetails,delete e.unitForm.probs[i].tags;r=e.$copyObject(e.unitForm),n=e.curCourseAll.units?e.$copyObject(e.curCourseAll.units):[],e.unitEditMode?n.splice(e.unitIdx,1,r):n.push(r),o={units:n,updated:l.a.getNow()},e.$store.dispatch("updateCourse",{id:e.curCourseAll.id,value:o}),e.$set(e.curCourseAll,"units",n),e.cunits=n,e.showUnitUpdate=!1;case 9:case"end":return t.stop()}}),t)})))()},editUnit:function(e){this.unitEditMode=!0,this.unitForm=this.$copyObject(this.cunits[e]),this.unitIdx=e,this.showUnitUpdate=!0},createUnit:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.unitEditMode=!1,0!=e.problems.length){t.next=7;break}return t.next=4,o.d.collection("problems").doc("BASE").get();case 4:r=t.sent,n=r.data(),r.exists&&(e.problems=l.a.obj2arr(n));case 7:e.showUnitUpdate=!0;case 8:case"end":return t.stop()}}),t)})))()},setCourseNews:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.$copyObject(e.courseNews),n={news:r},t.next=4,e.$store.dispatch("updateCourse",{id:e.curCourse.id,value:n});case 4:e.$set(e.curCourseAll,"news",r),e.infoAlert=!0,e.info={title:"News",message:"OK"};case 7:case"end":return t.stop()}}),t)})))()},prepareNews:function(){this.courseNews=Object.assign({},this.curCourseAll.news)},prepareScores:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,c,d,m,f,h,i,v,_,x,w,C,k,y,A;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.d.collection("courses").doc(e.curCourseAll.id).collection("tasks").where("type","==","submit").get();case 2:if(!(r=t.sent).empty){t.next=5;break}return t.abrupt("return");case 5:return n=e.curCourseAll.id,t.next=8,e.$store.dispatch("getCourseT",n);case 8:if(e.curCourseAll=t.sent,e.curCourseAll.id=n,e.curCourseAll.units){t.next=12;break}return t.abrupt("return");case 12:return t.next=14,o.d.collection("problems").doc("STAT").get();case 14:if((c=t.sent).exists){t.next=22;break}return d={updated:l.a.getNow()},t.next=19,o.d.collection("problems").doc("STAT").set(d);case 19:m=d,t.next=24;break;case 22:(m=c.data()).updated=l.a.getNow();case 24:f=e.curCourseAll.scores?e.$copyObject(e.curCourseAll.scores):{},h=e.curCourseAll.units,i=0;case 27:if(!(i<r.docs.length)){t.next=49;break}if(v=r.docs[i],_=v.data(),m[_.pid]||(m[_.pid]={TS:0,TP:0}),m[_.pid].TS+=1,"AC"==_.status&&(m[_.pid].TP+=1),!(_.score>0)){t.next=44;break}x=-1,w=0;case 36:if(!(w<h.length)){t.next=43;break}if(h[w].name!=_.unit){t.next=40;break}return x=w,t.abrupt("break",43);case 40:w++,t.next=36;break;case 43:if(x>=0)if(f[_.uid])if((C=f[_.uid]).length>x)_.score>C[x]&&(C[x]=_.score);else{for(k=0;k<x-C.length;k++)C.push(0);C.push(_.score)}else(y=new Array(x).fill(0)).push(_.score),f[_.uid]=y;case 44:return t.next=46,o.d.collection("courses").doc(e.curCourseAll.id).collection("tasks").doc(v.id).delete();case 46:i++,t.next=27;break;case 49:return t.next=51,o.d.collection("problems").doc("STAT").set(m);case 51:return A={scores:f,updated:l.a.getNow()},t.next=54,e.$store.dispatch("updateCourse",{id:e.curCourseAll.id,value:A});case 54:e.$set(e.curCourseAll,"scores",f),e.playgroundStat=m;case 56:case"end":return t.stop()}}),t)})))()},prepareStudents:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,c,i,d,data,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.d.collection("courses").doc(e.curCourseAll.id).collection("tasks").where("type","==","enroll").get();case 2:if(!(r=t.sent).empty){t.next=5;break}return t.abrupt("return");case 5:return n=e.curCourseAll.id,t.next=8,e.$store.dispatch("getCourseT",n);case 8:e.curCourseAll=t.sent,e.curCourseAll.id=n,c=e.curCourseAll.students?e.$copyObject(e.curCourseAll.students):{},i=0;case 12:if(!(i<r.docs.length)){t.next=21;break}return d=r.docs[i],data=d.data(),c[data.uid]={name:data.name,stdID:data.stdID},t.next=18,o.d.collection("courses").doc(e.curCourseAll.id).collection("tasks").doc(d.id).delete();case 18:i++,t.next=12;break;case 21:return m={students:c,updated:l.a.getNow()},t.next=24,e.$store.dispatch("updateCourse",{id:e.curCourseAll.id,value:m});case 24:e.$set(e.curCourseAll,"students",c);case 25:case"end":return t.stop()}}),t)})))()},showPGProblem:function(e){var t=this.$selectUserLocaleText(e.title);if(this.playgroundStat[e.id]){var r=this.playgroundStat[e.id];t+=" (".concat(r.TP,"/").concat(r.TS,")")}else t+=" (0/0)";return t},preparePlayground:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,c,d,i,m,f,h,v,_;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.d.collection("problems").doc("STAT").get();case 2:if((r=t.sent).exists){t.next=10;break}return n={updated:l.a.getNow()},t.next=7,o.d.collection("problems").doc("STAT").set(n);case 7:c=n,t.next=12;break;case 10:(c=r.data()).updated=l.a.getNow();case 12:return t.next=14,o.d.collection("courses").doc("playground").collection("tasks").get();case 14:if((d=t.sent).empty){t.next=31;break}i=0;case 17:if(!(i<d.docs.length)){t.next=29;break}if(m=d.docs[i],"submit"!=(f=m.data()).type){t.next=26;break}return c[f.pid]||(c[f.pid]={TS:0,TP:0}),c[f.pid].TS+=1,"AC"==f.status&&(c[f.pid].TP+=1),t.next=26,o.d.collection("courses").doc("playground").collection("tasks").doc(m.id).delete();case 26:i++,t.next=17;break;case 29:return t.next=31,o.d.collection("problems").doc("STAT").set(c);case 31:return e.playgroundStat=c,t.next=34,e.$content("playground").fetch();case 34:(h=t.sent)&&(v=h.KEY,_=h.DATA,e.pgproblems=l.a.decode(v,_));case 36:case"end":return t.stop()}}),t)})))()},showCourse:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.curCourse=e,r.next=3,t.$store.dispatch("getCourse",e.id);case 3:if((n=r.sent)||"playground"!=e.id){r.next=11;break}return o={name:"Playground"},r.next=8,t.$store.dispatch("setCourse",{id:"playground",value:o});case 8:t.curCourseAll={name:"Playground",id:"playground"},r.next=15;break;case 11:t.curCourseAll=n,t.curCourseAll.id=e.id,t.cunits=[],t.curCourseAll.units&&(t.cunits=t.$copyObject(t.curCourseAll.units));case 15:if("playground"!=e.id){r.next=18;break}return r.next=18,t.preparePlayground();case 18:t.showItem="showCourse";case 19:case"end":return r.stop()}}),r)})))()},showUnit:function(){},home:function(){this.showItem="List",this.curCourse=null},courseLabel:function(e){var t=e.name;return e.teacher&&e.note?t+=" (".concat(e.teacher," / ").concat(e.note,")"):e.teacher?t+=" (".concat(e.teacher,")"):e.note&&(t+=" (".concat(e.note,")")),t},NUsersTeachCourse:function(e,t,r){var o=this;return Object(n.a)(regeneratorRuntime.mark((function n(){var i,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e)for(i=0;i<e.length;i++)c=e[i].id,o.UserTeachCourse(c,t,r);case 1:case"end":return n.stop()}}),n)})))()},UserTeachCourse:function(e,t,r){return Object(n.a)(regeneratorRuntime.mark((function n(){var c,d,m,f,h;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o.d.collection("users").doc(e).get();case 2:if(c=n.sent,d=c.data(),m=d[r],f={},m&&(f=m),f[t.id]){n.next=14;break}return f[t.id]=t.name,(h={updated:l.a.getNow()})[r]=f,"user"==d.role&&(h.role="teach"==r?"teacher":"assistant"),n.next=14,o.d.collection("users").doc(e).update(h);case 14:case"end":return n.stop()}}),n)})))()},UserNotTeachCourse:function(e,t,r){return Object(n.a)(regeneratorRuntime.mark((function n(){var c,d,m;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o.d.collection("users").doc(e).get();case 2:if(c=n.sent,!(d=c.data()[r])){n.next=11;break}if(!d[t.id]){n.next=11;break}return delete d[t.id],(m={updated:l.a.getNow()})[r]=d,n.next=11,o.d.collection("users").doc(e).update(m);case 11:case"end":return n.stop()}}),n)})))()},updateCourse:function(data){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,i,n,o,c,d,m,f,h,v;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(delete(r=e.$copyObject(data.value)).codeExpiredDate,delete r.codeExpiredTime,"edit"!=data.mode){t.next=21;break}return r.id&&delete r.id,t.next=7,e.$store.dispatch("updateCourse",{id:e.curCourse.id,value:r});case 7:if(r.id=e.curCourse.id,e.NUsersTeachCourse(r.teachers,r,"teach"),e.curCourse.teachers)for(i=0;i<e.curCourse.teachers.length;i++)n=e.curCourse.teachers[i].id,l.a.findIdPos(r.teachers,n)<0&&e.UserNotTeachCourse(n,r,"teach");if(e.NUsersTeachCourse(r.assistants,r,"assist"),e.curCourse.assistants)for(o=0;o<e.curCourse.assistants.length;o++)c=e.curCourse.assistants[o].id,l.a.findIdPos(r.assistants,c)<0&&e.UserNotTeachCourse(c,r,"assist");return(d=l.a.findIdPos(e.courses,r.id))>=0&&(e.courses[d]=r),m=l.a.arr2obj(e.courses),t.next=17,e.$store.dispatch("setCourse",{id:"LIST",value:m});case 17:e.infoAlert=!0,e.info={title:"Update",message:"OK"},t.next=35;break;case 21:return r.id&&delete r.id,f=e.courses.length,h="C"+f.toString().padStart(6,"0"),t.next=26,e.$store.dispatch("setCourse",{id:h,value:r});case 26:return r.id=h,e.NUsersTeachCourse(r.teachers,r,"teach"),e.NUsersTeachCourse(r.assistants,r,"assist"),e.courses.push(r),v=l.a.arr2obj(e.courses),t.next=33,e.$store.dispatch("setCourse",{id:"LIST",value:v});case 33:e.infoAlert=!0,e.info={title:"Create",message:"OK"};case 35:case"end":return t.stop()}}),t)})))()}}},v=(r(971),r(70)),component=Object(v.a)(h,(function(){var e=this,t=this,r=t.$createElement,n=t._self._c||r;return n("b-container",{attrs:{fluid:""}},[n("b-modal",{attrs:{title:t.info.title},model:{value:t.infoAlert,callback:function(e){t.infoAlert=e},expression:"infoAlert"}},[t._v(t._s(t.info.message))]),t._v(" "),n("div",{staticClass:"panel"},[n("b-breadcrumb",[n("b-breadcrumb-item",{on:{click:t.home}},[n("b-icon",{attrs:{icon:"house-fill",scale:"1.25","shift-v":"1.25","aria-hidden":"true"}}),t._v("\n                "+t._s(t.localeText.AdminCourse_Title)+"\n            ")],1),t._v(" "),t.curCourse?n("b-breadcrumb-item",{on:{click:function(e){return t.showCourse(t.curCourse)}}},[t._v(t._s(t.curCourse.name))]):t._e(),t._v(" "),t.curUnit?n("b-breadcrumb-item",{attrs:{active:""},on:{click:t.showUnit}},[t._v(t._s(t.curUnit.name))]):t._e(),t._v(" "),t.curCourse?t._e():n("b-button",{staticClass:"newButton",attrs:{size:"sm",variant:"primary"},on:{click:function(e){t.showItem="addCourse"}}},[t._v(t._s(t.localeText.Common_New))])],1),t._v(" "),"addCourse"==t.showItem?n("course-basic",{attrs:{course:t.curCourse,mode:"create"},on:{update:t.updateCourse}}):t._e(),t._v(" "),"List"==t.showItem?n("item-list",{attrs:{items:t.courses,click:t.showCourse,show:t.courseLabel}}):t._e(),t._v(" "),"showCourse"==t.showItem?n("div",{staticClass:"mt-3"},["Playground"==t.curCourse.name?n("div",[n("item-list",{attrs:{items:t.pgproblems,show:t.showPGProblem}})],1):n("div",[n("b-tabs",[n("b-tab",{staticClass:"mt-3",attrs:{title:"Basic"}},[n("course-basic",{attrs:{course:t.curCourse},on:{update:t.updateCourse}})],1),t._v(" "),n("b-tab",{staticClass:"mt-3",attrs:{title:"News"},on:{click:t.prepareNews}},[n("b-row",[n("b-col",{attrs:{cols:"6"}},[n("locale-input",{attrs:{rows:12},on:{curLang:function(t){e.cnLang=t}},model:{value:t.courseNews,callback:function(e){t.courseNews=e},expression:"courseNews"}})],1),t._v(" "),n("b-col",{attrs:{cols:"6"}},[n("div",{domProps:{innerHTML:t._s(t.$md.render(t.$selectLocaleText(t.courseNews,t.cnLang)))}})])],1),t._v(" "),n("div",{staticClass:"mt-3",staticStyle:{"text-align":"center"}},[n("b-button",{attrs:{size:"sm",pill:"",center:"",variant:"primary"},on:{click:t.setCourseNews}},[t._v("\n                                Update\n                            ")])],1)],1),t._v(" "),n("b-tab",{staticClass:"mt-3",attrs:{title:"Units"}},[t.cunits.length>0?n("div",t._l(t.cunits,(function(e,r){return n("p",{key:e+r},[t._v("\n                                "+t._s(r+1)+". "+t._s(e.name)+" : "+t._s(e.startDate)+"-"+t._s(e.endDate)+"\n                                "),n("b-link",{staticClass:"ml-3 text-info",on:{click:function(e){return t.editUnit(r)}}},[t._v("Edit")]),n("br"),t._v(" "),t._l(e.probs,(function(e,r){return n("span",{key:e.id,staticClass:"ml-3 text-primary"},[t._v("\n                                    ("+t._s(r+1)+") "+t._s(t.$selectUserLocaleText(e.title))+"\n                                ")])}))],2)})),0):n("div",[t._v("\n                            No any units.\n                        ")]),t._v(" "),n("div",{staticClass:"mt-3",staticStyle:{"text-align":"center"}},[n("b-button",{attrs:{size:"sm",pill:"",center:"",variant:"success"},on:{click:t.createUnit}},[t._v("\n                                New\n                            ")])],1),t._v(" "),t.showUnitUpdate?n("div",{staticClass:"mt-4"},[n("b-input",{staticClass:"mb-3",attrs:{placeholder:"Name"},model:{value:t.unitForm.name,callback:function(e){t.$set(t.unitForm,"name",e)},expression:"unitForm.name"}}),t._v(" "),n("b-input",{staticClass:"mb-3",attrs:{placeholder:"Start Date"},model:{value:t.unitForm.startDate,callback:function(e){t.$set(t.unitForm,"startDate",e)},expression:"unitForm.startDate"}}),t._v(" "),n("b-input",{staticClass:"mb-3",attrs:{placeholder:"End Date"},model:{value:t.unitForm.endDate,callback:function(e){t.$set(t.unitForm,"endDate",e)},expression:"unitForm.endDate"}}),t._v(" "),n("item-list",{attrs:{items:t.unitForm.probs,name:"title"}}),t._v(" "),n("p",{attrs:{align:"center"}},[n("b-button",{attrs:{size:"sm",variant:"success"},on:{click:function(e){t.showUnitUpdate=!1}}},[t._v("Cancel")]),t._v(" "),n("b-button",{staticClass:"ml-3",attrs:{size:"sm",variant:"success"},on:{click:function(e){t.selUnitProb=!0}}},[t._v("Set Problems")]),t._v(" "),n("b-button",{staticClass:"ml-3",attrs:{size:"sm",variant:"success"},on:{click:t.updateUnit}},[t._v("Update")])],1),t._v(" "),n("b-modal",{attrs:{size:"xl",title:"Select Problems","hide-footer":""},model:{value:t.selUnitProb,callback:function(e){t.selUnitProb=e},expression:"selUnitProb"}},[n("problem-selector",{staticClass:"mt-4",attrs:{oriProblems:t.problems,selProblems:t.unitForm.probs,selText:t.unitForm.name,OKText:"Set Unit Problems",OK:function(){t.selUnitProb=!1}}})],1)],1):t._e()]),t._v(" "),n("b-tab",{staticClass:"mt-3",attrs:{title:"Students"},on:{click:t.prepareStudents}},[t.curCourseAll.students?n("div",t._l(t.curCourseAll.students,(function(e,r,o){return n("p",{key:e.name},[t._v("\n                                "+t._s(o+1)+". "),n("span",{staticClass:"ml-3",staticStyle:{display:"inline-block",width:"150px"}},[t._v(t._s(e.stdID))]),t._v(" "),n("span",{staticClass:"ml-3"},[t._v(t._s(t.sname(r)))])])})),0):t._e()]),t._v(" "),n("b-tab",{staticClass:"mt-3",attrs:{title:"Scores"},on:{click:t.prepareScores}},[t.curCourseAll.scores?n("div",t._l(t.curCourseAll.scores,(function(e,r,o){return n("p",{key:r},[t._v("\n                                "+t._s(o+1)+". "+t._s(t.sname(r))+" => "+t._s(e)+"\n                            ")])})),0):t._e()])],1)],1)]):t._e()],1)],1)}),[],!1,null,"d54818c2",null);t.default=component.exports;installComponents(component,{CourseBasic:r(899).default,ItemList:r(846).default,LocaleInput:r(849).default,ProblemSelector:r(856).default})},840:function(e,t,r){"use strict";r(9),r(14),r(22),r(103),r(8),r(841),r(27),r(15);var n=r(227),o=r.n(n),c={pad:function(e){return("0"+e).slice(-2)},mmss:function(e){var t=Math.floor(e/60);return e%=60,"".concat(this.pad(t),":").concat(this.pad(e))},hhmmss:function(e){var t=Math.floor(e/60);e%=60;var r=Math.floor(t/60);return t%=60,"".concat(this.pad(r),":").concat(this.pad(t),":").concat(this.pad(e))},getToday:function(){var e=new Date,dd=String(e.getDate()).padStart(2,"0"),t=String(e.getMonth()+1).padStart(2,"0");return e.getFullYear()+t+dd},getNow:function(){var e=new Date;return""+e.getFullYear()+this.pad(e.getMonth()+1)+this.pad(e.getDate())+this.pad(e.getHours())+this.pad(e.getMinutes())+this.pad(e.getSeconds())},obj2arr:function(e){var t=[],r=Object.keys(e);return r.sort(),r.forEach((function(r){t.push(Object.assign({id:r},e[r]))})),t},arr2obj:function(e){var t={};return e.forEach((function(e){var r=JSON.parse(JSON.stringify(e)),n=e.id;delete r.id,t[n]=r})),t},getOptions:function(e){var t=[];return e.split("#@@#").forEach((function(e){var s=e.split("#@");t.push({text:s[0],value:s[1]})})),t},findIdPos:function(e,t){if(!e)return-1;for(var r=0;r<e.length;r++)if(t==e[r].id)return r;return-1},encode:function(e,t){return new o.a(e).encrypt(t)},decode:function(e,t){return new o.a(e).decrypt(t)}};t.a=c},841:function(e,t,r){"use strict";var n=r(7),o=r(842).start;n({target:"String",proto:!0,forced:r(843)},{padStart:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},842:function(e,t,r){var n=r(48),o=r(228),c=r(51),l=Math.ceil,d=function(e){return function(t,r,d){var m,f,h=String(c(t)),v=h.length,_=void 0===d?" ":String(d),x=n(r);return x<=v||""==_?h:(m=x-v,(f=o.call(_,l(m/_.length))).length>m&&(f=f.slice(0,m)),e?h+f:f+h)}};e.exports={start:d(!1),end:d(!0)}},843:function(e,t,r){var n=r(127);e.exports=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(n)},845:function(e,t,r){var content=r(854);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(60).default)("7bc25547",content,!0,{sourceMap:!1})},846:function(e,t,r){"use strict";r.r(t);var n={props:{items:Array,name:{type:String,default:"name"},keyPrefix:{type:String,default:"item"},show:{type:Function,default:null},headVariant:{type:String,default:"dark"},textVariant:{type:String,default:"primary"},editVariant:{type:String,default:"primary"},copyVariant:{type:String,default:"primary"},removeVariant:{type:String,default:"primary"},addVariant:{type:String,default:"primary"},order:{type:Boolean,default:!0},click:{type:Function,default:null},remove:{type:Function,default:null},edit:{type:Function,default:null},copy:{type:Function,default:null},add:{type:Function,default:null},addLabel:{type:String,default:"New"},noEntryLabel:{type:String,default:"No items."}},methods:{itemName:function(e,t){return this.show?this.show(e):e[t]?this.$selectUserLocaleText(e[t]):"Unknown"},itemClass:function(e){return e.variant?"text-"+e.variant:this.textVariant?"text-"+this.textVariant:null}}},o=r(70),component=Object(o.a)(n,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e.add?r("p",{attrs:{align:"right"}},[e.add?r("b-button",{attrs:{size:"sm",variant:e.addVariant},on:{click:function(t){return e.add()}}},[e._v("\n            "+e._s(e.addLabel)+"\n        ")]):e._e()],1):e._e(),e._v(" "),e.items&&e.items.length>0?r("div",e._l(e.items,(function(t,n){return r("div",{key:e.keyPrefix+n,staticClass:"itemList d-flex justify-content-between"},[r("span",[e.order?r("span",{staticClass:"mr-2",class:"text-"+e.headVariant},[e._v(e._s(n+1)+".")]):r("span",{staticClass:"mr-2",class:"text-"+e.headVariant},[e._v("•")]),e._v(" "),r("b-link",{staticClass:"itemBody",class:e.itemClass(t),on:{click:function(r){e.click&&e.click(t)}}},[e._v("\n                    "+e._s(e.itemName(t,e.name))+"\n                ")])],1),e._v(" "),e.remove||e.edit||e.copy?r("span",[e.edit?r("b-link",{class:"text-"+e.editVariant,on:{click:function(r){return e.edit(t)}}},[r("b-icon",{attrs:{icon:"pencil"}})],1):e._e(),e._v(" "),e.copy&&e.edit?r("span",{staticClass:"mr-2"}):e._e(),e._v(" "),e.copy?r("b-link",{class:"text-"+e.editVariant,on:{click:function(r){return e.copy(t)}}},[r("b-icon",{attrs:{icon:"back"}})],1):e._e(),e._v(" "),e.remove&&e.copy?r("span",{staticClass:"mr-2"}):e._e(),e._v(" "),e.remove?r("b-link",{class:"text-"+e.removeVariant,on:{click:function(r){return e.remove(t)}}},[r("b-icon",{attrs:{icon:"trash-fill"}})],1):e._e()],1):e._e()])})),0):r("div",[e._v("\n        "+e._s(e.noEntryLabel)+"\n    ")])])}),[],!1,null,"c3feb25c",null);t.default=component.exports},848:function(e,t,r){"use strict";r.r(t);r(156),r(54);var n=r(10),o=(r(850),{props:{problems:Array,showID:{type:Boolean,default:!1},showTag:{type:Boolean,default:!1},showFilter:{type:Boolean,default:!1},showDetail:{type:Boolean,default:!1},showArrow:{type:Boolean,default:!1},showDown:{type:Boolean,default:!1},editProblem:{type:Function,default:null},copyProblem:{type:Function,default:null}},data:function(){return{pfields:[],pfilter:null,localeText:{AdminProblem_Playground:"練習廣場",AdminProblem_ProbEdit:"題目編修",AdminProblem_ProbList:"題目清單",Common_Edit:"編輯",Common_Copy:"複製"}}},created:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.localeText=e.$updateLocaleText(e.localeText),e.showID&&e.pfields.push({key:"id",sortable:!0}),e.pfields.push({key:"title",sortable:!0,formatter:e.$selectUserLocaleText}),e.showTag&&e.pfields.push({key:"tags",sortable:!0}),(e.showArrow||e.showDetail||e.editProblem||e.copyProblem)&&e.pfields.push({key:"actions",label:"Actions"});case 5:case"end":return t.stop()}}),t)})))()},mounted:function(){},methods:{moveUp:function(e){if(e>0){var t=this.$copyObject(this.problems[e]);this.problems.splice(e,1),this.problems.splice(e-1,0,t)}},moveDown:function(e){if(e<this.problems.length-1){var t=this.$copyObject(this.problems[e+1]);this.problems.splice(e+1,1),this.problems.splice(e,0,t)}},onRowSelected:function(e){this.$emit("rowSelected",e)},showProblem:function(e){return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.toggleDetails();case 1:case"end":return t.stop()}}),t)})))()}}}),c=(r(858),r(70)),component=Object(c.a)(o,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e.showFilter?r("p",{staticClass:"p-0 mb-2"},[r("span",[e._v("Filter: "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.pfilter,expression:"pfilter"}],domProps:{value:e.pfilter},on:{input:function(t){t.target.composing||(e.pfilter=t.target.value)}}})])]):e._e(),e._v(" "),r("b-table",{attrs:{bordered:"",items:e.problems,selectable:"","select-mode":"multi",fields:e.pfields,filter:e.pfilter},on:{"row-selected":e.onRowSelected},scopedSlots:e._u([e.showDetail||e.editProblem||e.copyProblem||e.showArrow?{key:"cell(actions)",fn:function(t){return[e.showDetail?r("b-link",{staticClass:"mr-1",attrs:{size:"sm"},on:{click:function(r){return e.showProblem(t)}}},[t.detailsShowing?r("b-icon",{attrs:{icon:"eye-slash"}}):r("b-icon",{attrs:{icon:"eye"}})],1):e._e(),e._v(" "),e.editProblem?r("b-link",{staticClass:"mr-1",on:{click:function(r){return e.editProblem(t.item)}}},[r("b-icon",{attrs:{icon:"pen"}})],1):e._e(),e._v(" "),e.copyProblem?r("b-link",{staticClass:"mr-1",on:{click:function(r){return e.copyProblem(t.item)}}},[r("b-icon",{attrs:{icon:"back"}})],1):e._e(),e._v(" "),e.showArrow?r("b-link",{staticClass:"mr-1",on:{click:function(r){return e.moveUp(t.index)}}},[r("b-icon",{attrs:{icon:"arrow-up"}})],1):e._e(),e._v(" "),e.showArrow?r("b-link",{staticClass:"mr-1",on:{click:function(r){return e.moveDown(t.index)}}},[r("b-icon",{attrs:{icon:"arrow-down"}})],1):e._e()]}}:null,e.showDetail?{key:"row-details",fn:function(t){return[r("b-card",[r("p",[e._v(e._s(t.item.id)+": "+e._s(e.$selectUserLocaleText(t.item.title)))]),e._v(" "),r("p",{domProps:{innerHTML:e._s(e.$md.render(e.$selectUserLocaleText(t.item.description)))}}),e._v(" "),r("p",[e._v("TAGS: "+e._s(t.item.tags))])])]}}:null],null,!0)})],1)}),[],!1,null,"2398be4f",null);t.default=component.exports},849:function(e,t,r){"use strict";r.r(t);r(362);var n={props:{value:Object,rows:{type:Number,default:10}},data:function(){return{locales:{zh:"中文",en:"English"},content:{zh:"中文",en:"English"}}},created:function(){this.locales=this.$copyObject(this.$system("locales").support),this.value&&(this.content=this.value)},methods:{setLang:function(e){this.$emit("curLang",e)},cinput:function(){this.$emit("input",this.content)}},watch:{value:function(e){this.content=e}}},o=(r(853),r(70)),component=Object(o.a)(n,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("b-tabs",e._l(e.locales,(function(t,n,o){return r("b-tab",{key:"locale"+o,attrs:{title:t},on:{click:function(t){return e.setLang(n)}}},[r("b-textarea",{attrs:{rows:e.rows},on:{input:e.cinput},model:{value:e.content[n],callback:function(t){e.$set(e.content,n,t)},expression:"content[key]"}})],1)})),1)],1)}),[],!1,null,"06f58b61",null);t.default=component.exports},851:function(e,t,r){var content=r(859);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(60).default)("0d16a966",content,!0,{sourceMap:!1})},852:function(e,t,r){var content=r(861);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(60).default)("5d1eba62",content,!0,{sourceMap:!1})},853:function(e,t,r){"use strict";r(845)},854:function(e,t,r){(t=r(59)(!1)).push([e.i,"textarea[data-v-06f58b61]{width:100%}",""]),e.exports=t},856:function(e,t,r){"use strict";r.r(t);r(156),r(54);var n=r(10),o=r(848),c=r(840),l={props:{oriProblems:Array,selProblems:Array,selText:{type:String,Default:""},OKText:{type:String,Default:"OK"},OK:Function},components:{ProblemTable:o.default},data:function(){return{selSelected:null,oriSelected:null,leftProblems:[],localeText:{AdminProblem_Playground:"練習廣場",AdminProblem_ProbEdit:"題目編修",AdminProblem_ProbList:"題目清單",Common_Edit:"編輯",Common_Copy:"複製"}}},created:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var i,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e.localeText=e.$updateLocaleText(e.localeText),i=0;i<e.oriProblems.length;i++)r=e.oriProblems[i],c.a.findIdPos(e.selProblems,r.id)<0&&e.leftProblems.push(r);case 2:case"end":return t.stop()}}),t)})))()},mounted:function(){},methods:{selectItems:function(){if(this.oriSelected)for(var i=0;i<this.oriSelected.length;i++){var e=this.oriSelected[i];this.selProblems.push(e);var t=c.a.findIdPos(this.leftProblems,e.id);t>=0&&this.leftProblems.splice(t,1)}},deSelectItems:function(){if(this.selSelected)for(var i=0;i<this.selSelected.length;i++){var e=this.selSelected[i];this.leftProblems.push(e);var t=c.a.findIdPos(this.selProblems,e.id);t>=0&&this.selProblems.splice(t,1)}}}},d=(r(860),r(70)),component=Object(d.a)(l,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"d-flex justify-content-start align-items-top"},[r("problem-table",{attrs:{problems:e.leftProblems,showID:"",showDetail:"",showFilter:""},on:{rowSelected:function(t){return e.oriSelected=t}}}),e._v(" "),r("div",{staticClass:"mx-5"},[r("b-button",{attrs:{block:"",variant:"success",size:"sm"},on:{click:e.selectItems}},[r("b-icon",{attrs:{icon:"arrow-right"}})],1),e._v(" "),r("b-button",{attrs:{block:"",variant:"success",size:"sm"},on:{click:e.deSelectItems}},[r("b-icon",{attrs:{icon:"arrow-left"}})],1)],1),e._v(" "),r("div",[r("p",{staticClass:"mb-2 p-0",attrs:{align:"right"}},[r("span",{staticClass:"mr-3"},[e._v(e._s(e.selText))]),e._v(" "),r("b-button",{attrs:{size:"sm",variant:"success"},on:{click:e.OK}},[e._v(e._s(e.OKText))])],1),e._v(" "),r("problem-table",{attrs:{problems:e.selProblems,showID:"",showArrow:""},on:{rowSelected:function(t){return e.selSelected=t}}})],1)],1)])}),[],!1,null,"7f700f4d",null);t.default=component.exports;installComponents(component,{ProblemTable:r(848).default})},858:function(e,t,r){"use strict";r(851)},859:function(e,t,r){(t=r(59)(!1)).push([e.i,"[data-v-2398be4f] h1{color:#ff4500;font-size:110%;margin:12px 0 6px}",""]),e.exports=t},860:function(e,t,r){"use strict";r(852)},861:function(e,t,r){(t=r(59)(!1)).push([e.i,"[data-v-7f700f4d] .itemList{margin:12px 0}.container-fluid[data-v-7f700f4d]{margin-top:30px}.pdescription[data-v-7f700f4d]{width:100%;height:300px}.titleLabel[data-v-7f700f4d]{display:inline-block;width:100px;margin:0 16px 24px 0;text-align:right}[data-v-7f700f4d] h1{color:#ff4500;font-size:110%;margin:12px 0 6px}",""]),e.exports=t},865:function(e,t,r){"use strict";r.r(t);r(30),r(54);var n=r(10),o=r(34),c={data:function(){return{name:"",candidates:{}}},methods:{selectUser:function(e,t){var r={id:e,name:t.name};this.$emit("getUser",r)},searchUser:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,i,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.name.length<2)){t.next=2;break}return t.abrupt("return");case 2:return r={},t.next=5,o.d.collection("users").where("name","==",e.name).get();case 5:if(!(n=t.sent).empty)for(i=0;i<n.docs.length;i++)c=n.docs[i],r[c.id]=c.data();e.candidates=r;case 8:case"end":return t.stop()}}),t)})))()}}},l=r(70),component=Object(l.a)(c,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("p",{attrs:{align:"center"}},[e._v("User name: \n        "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],staticClass:"ml-2",domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}}),e._v(" "),r("button",{attrs:{size:"sm",variant:"success"},on:{click:e.searchUser}},[e._v("Search")])]),e._v(" "),e._l(e.candidates,(function(t,n,o){return r("p",{key:t.id,attrs:{align:"center"}},[e._v("\n        "+e._s(o+1)+". "),r("b-link",{on:{click:function(r){return e.selectUser(n,t)}}},[e._v(e._s(t.name)+" - "+e._s(t.email))])],1)}))],2)}),[],!1,null,null,null);t.default=component.exports},867:function(e,t,r){var content=r(972);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(60).default)("7ba51715",content,!0,{sourceMap:!1})},899:function(e,t,r){"use strict";r.r(t);r(18),r(12),r(156),r(30);var n={components:{UserSelector:r(865).default},props:{course:Object,mode:{type:String,default:"show"}},data:function(){return{kind:null,workMode:"show",selectUser:!1,courseForm:{name:"",teachers:[],assistants:[],school:"",dept:"",enrollCode:"",codeExpiredDate:"",codeExpiredTime:"",needApproval:!0,whitelist:"",note:""}}},created:function(){"edit"==this.mode&&this.editCourse(),"create"==this.mode&&this.createCourse()},computed:{manager:function(){return"admin"==this.$user("role")||"maintainer"==this.$user("role")}},methods:{cancel:function(){this.workMode="show"},addUser:function(e){this.courseForm[this.kind]?this.courseForm[this.kind].push(e):this.$set(this.courseForm,this.kind,[e]),this.selectUser=!1},removeUser:function(e,t){this.courseForm[e].splice(t,1)},getUser:function(e){this.kind=e,this.selectUser=!0},createCourse:function(){this.workMode="create"},editCourse:function(){var e=this.$copyObject(this.course);for(var t in this.courseForm)this.courseForm[t]=e[t];this.workMode="edit"},showNames:function(e){return e&&0!=e.length?e.map((function(e){return e.name})).join(", "):""},updateCourse:function(){if(this.courseForm.codeExpiredDate&&this.courseForm.codeExpiredDate.length>0){var e=this.courseForm.codeExpiredDate.replaceAll("-","");this.courseForm.codeExpiredTime&&this.courseForm.codeExpiredTime.length>0?e+=this.courseForm.codeExpiredTime.replaceAll(":",""):e+="235959",this.courseForm.codeExpired=e}else if(this.courseForm.codeExpiredTime&&this.courseForm.codeExpiredTime.length>0){var t=utils.getNow();this.courseForm.codeExpired=t.substring(0,8)+this.courseForm.codeExpiredTime.replaceAll(":","")}else delete this.courseForm.codeExpired;this.$emit("update",{mode:this.workMode,value:this.courseForm})}}},o=r(70),component=Object(o.a)(n,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("b-modal",{attrs:{size:"lg"},model:{value:e.selectUser,callback:function(t){e.selectUser=t},expression:"selectUser"}},[r("user-selector",{on:{getUser:e.addUser}})],1),e._v(" "),"show"==e.workMode?r("div",[r("p",[e._v("Name: "+e._s(e.course.name))]),e._v(" "),r("p",[e._v("Teacher: "+e._s(e.showNames(e.course.teachers)))]),e._v(" "),r("p",[e._v("Assistant: "+e._s(e.showNames(e.course.assistants)))]),e._v(" "),r("p",[e._v("School: "+e._s(e.course.school))]),e._v(" "),r("p",[e._v("Dept: "+e._s(e.course.dept))]),e._v(" "),e.course.enrollCode?r("p",[e._v("EnrollCode: "+e._s(e.course.enrollCode))]):e._e(),e._v(" "),e.course.codeExpired?r("p",[e._v("CodeExpired: "+e._s(e.course.codeExpired))]):e._e(),e._v(" "),e.course.needApproval?r("p",[e._v("NeedApproval: "+e._s(e.course.needApproval))]):e._e(),e._v(" "),e.course.whitelist?r("p",[e._v("WhiteList: "+e._s(e.course.whitelist))]):e._e(),e._v(" "),r("p",[e._v("Note: "+e._s(e.course.note))]),e._v(" "),r("b-button",{attrs:{size:"sm",variant:"primary"},on:{click:e.editCourse}},[e._v("Edit")])],1):e._e(),e._v(" "),"edit"==e.workMode||"create"==e.workMode?r("div",["edit"==e.workMode?r("p",{attrs:{align:"center"}},[e._v("Modify Course")]):r("p",{attrs:{align:"center"}},[e._v("New Course")]),e._v(" "),r("p",{staticClass:"ml-2"},[e._v("Teachers: \n            "),e.courseForm.teachers&&e.courseForm.teachers.length>0?r("span",e._l(e.courseForm.teachers,(function(t,n){return r("span",{key:t.id},[e._v("\n                    "+e._s(t.name)+"\n                    "),e.manager?r("b-link",{staticClass:"mr-3",on:{click:function(t){return e.removeUser("teachers",n)}}},[r("b-icon",{attrs:{icon:"x"}})],1):e._e()],1)})),0):e._e(),e._v(" "),e.manager?r("button",{staticClass:"ml-3",on:{click:function(t){return e.getUser("teachers")}}},[e._v("Add")]):e._e()]),e._v(" "),r("p",{staticClass:"ml-2"},[e._v("Assistants: \n            "),e.courseForm.assistants&&e.courseForm.assistants.length>0?r("span",e._l(e.courseForm.assistants,(function(t,n){return r("span",{key:t.id},[e._v("\n                    "+e._s(t.name)+"\n                    "),r("b-link",{staticClass:"mr-3",on:{click:function(t){return e.removeUser("assistants",n)}}},[r("b-icon",{attrs:{icon:"x"}})],1)],1)})),0):e._e(),e._v(" "),r("button",{staticClass:"ml-3",on:{click:function(t){return e.getUser("assistants")}}},[e._v("Add")])]),e._v(" "),r("b-input",{staticClass:"mb-3",attrs:{placeholder:"Name"},model:{value:e.courseForm.name,callback:function(t){e.$set(e.courseForm,"name",t)},expression:"courseForm.name"}}),e._v(" "),r("b-input",{staticClass:"mb-3",attrs:{placeholder:"School"},model:{value:e.courseForm.school,callback:function(t){e.$set(e.courseForm,"school",t)},expression:"courseForm.school"}}),e._v(" "),r("b-input",{staticClass:"mb-3",attrs:{placeholder:"Department"},model:{value:e.courseForm.dept,callback:function(t){e.$set(e.courseForm,"dept",t)},expression:"courseForm.dept"}}),e._v(" "),r("b-input",{staticClass:"mb-3",attrs:{placeholder:"enrollCode"},model:{value:e.courseForm.enrollCode,callback:function(t){e.$set(e.courseForm,"enrollCode",t)},expression:"courseForm.enrollCode"}}),e._v(" "),r("b-form-datepicker",{attrs:{placeholder:"Code Expired Date",locale:e.$user("locale"),"today-button":"","reset-button":"","close-button":""},model:{value:e.courseForm.codeExpiredDate,callback:function(t){e.$set(e.courseForm,"codeExpiredDate",t)},expression:"courseForm.codeExpiredDate"}}),e._v(" "),r("b-form-timepicker",{attrs:{placeholder:"Code Expired Time",locale:e.$user("locale"),"show-seconds":"","reset-button":"","close-button":""},model:{value:e.courseForm.codeExpiredTime,callback:function(t){e.$set(e.courseForm,"codeExpiredTime",t)},expression:"courseForm.codeExpiredTime"}}),e._v(" "),r("p",{staticClass:"my-3 ml-2"},[r("b-form-radio-group",{attrs:{options:[{value:!0,text:"Approval needed"},{value:!1,text:"No approval needed"}]},model:{value:e.courseForm.needApproval,callback:function(t){e.$set(e.courseForm,"needApproval",t)},expression:"courseForm.needApproval"}})],1),e._v(" "),r("b-textarea",{staticClass:"mb-3",attrs:{placeholder:"White List",rows:"5"},model:{value:e.courseForm.whitelist,callback:function(t){e.$set(e.courseForm,"whitelist",t)},expression:"courseForm.whitelist"}}),e._v(" "),r("b-input",{staticClass:"mb-3",attrs:{placeholder:"Note"},model:{value:e.courseForm.note,callback:function(t){e.$set(e.courseForm,"note",t)},expression:"courseForm.note"}}),e._v(" "),r("b-button",{staticClass:"mr-3",attrs:{size:"sm",variant:"primary"},on:{click:e.cancel}},[e._v("Cancel")]),e._v(" "),r("b-button",{attrs:{size:"sm",variant:"primary"},on:{click:e.updateCourse}},[e._v("Update")])],1):e._e()],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{UserSelector:r(865).default})},971:function(e,t,r){"use strict";r(867)},972:function(e,t,r){(t=r(59)(!1)).push([e.i,'[data-v-d54818c2] h1{color:#00f;font-family:"Arial";font-size:120%;text-decoration:underline;margin:24px 0}[data-v-d54818c2] h2{color:#ff4500;font-size:100%;margin:16px 0 8px}[data-v-d54818c2] .itemList{margin-top:8px}.container-fluid[data-v-d54818c2]{margin:30px}.panel[data-v-d54818c2]{margin-right:30px;position:relative}.newButton[data-v-d54818c2]{position:absolute;top:12px;right:12px}',""]),e.exports=t}}]);