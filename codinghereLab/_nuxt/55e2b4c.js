(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{1318:function(e,t,r){"use strict";r.r(t);r(18),r(12),r(156),r(29),r(49);var o=r(7),n=r(32),c=r(851),l={props:{course:Object},data:function(){return{courses:null,mode:"show",kind:null,workMode:"show",selectUser:!1,infoAlert:!1,info:{title:"",message:""},courseForm:{name:"",teachers:[],assistants:[],school:"",dept:"",enrollCode:"",codeExpiredDate:"",codeExpiredTime:"",needApproval:!0,endDate:"",whitelist:"",note:""}}},created:function(){this.init(this.course)},computed:{manager:function(){return"admin"==this.$user("role")||"maintainer"==this.$user("role")},cid:function(){return this.$route.params.course}},methods:{init:function(e){this.course=this.course,"edit"==this.mode&&this.editCourse()},cancel:function(){this.workMode="show"},addUser:function(e){this.courseForm[this.kind]?this.courseForm[this.kind].push(e):this.$set(this.courseForm,this.kind,[e]),this.selectUser=!1},removeUser:function(e,t){this.courseForm[e].splice(t,1)},getUser:function(e){this.kind=e,this.selectUser=!0},createCourse:function(){this.workMode="create"},editCourse:function(){var e=this.$copyObject(this.course);for(var t in this.courseForm)this.courseForm[t]=e[t];this.workMode="edit"},showNames:function(e){return e&&0!=e.length?e.map((function(e){return e.name})).join(", "):""},NUsersTeachCourse:function(e,t,r){var n=this;return Object(o.a)(regeneratorRuntime.mark((function o(){var i,c;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(e)for(i=0;i<e.length;i++)c=e[i].id,n.UserTeachCourse(c,t,r);case 1:case"end":return o.stop()}}),o)})))()},UserTeachCourse:function(e,t,r){var l=this;return Object(o.a)(regeneratorRuntime.mark((function o(){var d,m,h,v,f;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,n.d.collection("users").doc(e).get();case 2:if(d=o.sent,m=d.data(),h=m[r],v={},h&&(v=h),v[l.cid]){o.next=14;break}return v[l.cid]=t.name,(f={updated:c.a.getNow()})[r]=v,"user"==m.role&&(f.role="teach"==r?"teacher":"assistant"),o.next=14,n.d.collection("users").doc(e).update(f);case 14:case"end":return o.stop()}}),o)})))()},UserNotTeachCourse:function(e,t,r){var l=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var o,d,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.d.collection("users").doc(e).get();case 2:if(o=t.sent,!(d=o.data()[r])){t.next=11;break}if(!d[l.cid]){t.next=11;break}return delete d[l.cid],(m={updated:c.a.getNow()})[r]=d,t.next=11,n.d.collection("users").doc(e).update(m);case 11:case"end":return t.stop()}}),t)})))()},updateCourse:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r,o,n,l,d,m,i,h,v,f,_,x,k;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=e.$copyObject(e.courseForm)).codeExpiredDate&&r.codeExpiredDate.length>0?(o=r.codeExpiredDate.replaceAll("-",""),r.codeExpiredTime&&r.codeExpiredTime.length>0?o+=r.codeExpiredTime.replaceAll(":",""):o+="235959",r.codeExpired=o):r.codeExpiredTime&&r.codeExpiredTime.length>0?(n=c.a.getNow(),r.codeExpired=n.substring(0,8)+r.codeExpiredTime.replaceAll(":","")):delete r.codeExpired,r.endDate&&r.endDate.length>0?(l=r.endDate.replaceAll("-",""),l+="235959",r.endDate=l):delete r.endDate,r.id&&delete r.id,d=e.$copyObject(e.course.teachers),m=e.$copyObject(e.course.assistants),t.next=8,e.$store.dispatch("updateCourse",{id:e.cid,value:r});case 8:if(r.id=e.cid,e.NUsersTeachCourse(r.teachers,r,"teach"),d)for(i=0;i<d.length;i++)h=d[i].id,c.a.findIdPos(r.teachers,h)<0&&e.UserNotTeachCourse(h,r,"teach");if(e.NUsersTeachCourse(r.assistants,r,"assist"),m)for(v=0;v<m.length;v++)f=m[v].id,c.a.findIdPos(r.assistants,f)<0&&e.UserNotTeachCourse(f,r,"assist");return t.next=15,e.$store.dispatch("getCourseT","LIST");case 15:return _=t.sent,x=e.$copyObject(_),k=r.id,delete r.id,x[k]=r,t.next=22,e.$store.dispatch("setCourse",{id:"LIST",value:x});case 22:e.workMode="show",e.infoAlert=!0,e.info={title:"Update",message:"OK"};case 25:case"end":return t.stop()}}),t)})))()}},watch:{course:function(e){this.init(e)}}},d=r(55),component=Object(d.a)(l,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("b-modal",{attrs:{title:e.info.title},model:{value:e.infoAlert,callback:function(t){e.infoAlert=t},expression:"infoAlert"}},[e._v(e._s(e.info.message))]),e._v(" "),r("b-modal",{attrs:{size:"lg"},model:{value:e.selectUser,callback:function(t){e.selectUser=t},expression:"selectUser"}},[r("user-selector",{on:{getUser:e.addUser}})],1),e._v(" "),"show"==e.workMode?r("div",{staticClass:"ml-3"},[r("p",[e._v("Name: "+e._s(e.course.name))]),e._v(" "),r("p",[e._v("Teacher: "+e._s(e.showNames(e.course.teachers)))]),e._v(" "),r("p",[e._v("Assistant: "+e._s(e.showNames(e.course.assistants)))]),e._v(" "),r("p",[e._v("School: "+e._s(e.course.school))]),e._v(" "),r("p",[e._v("Dept: "+e._s(e.course.dept))]),e._v(" "),e.course.enrollCode?r("p",[e._v("Enroll code: "+e._s(e.course.enrollCode))]):e._e(),e._v(" "),e.course.codeExpired?r("p",[e._v("\n            Enroll code expired: "+e._s(e.course.codeExpired)+"\n        ")]):e._e(),e._v(" "),e.course.needApproval?r("p",[e._v("\n            Enroll code need approval: "+e._s(e.course.needApproval)+"\n        ")]):e._e(),e._v(" "),e.course.endDate?r("p",[e._v("\n            Course end date: "+e._s(e.course.endDate)+"\n        ")]):e._e(),e._v(" "),e.course.whitelist?r("p",[e._v("White List: "+e._s(e.course.whitelist))]):e._e(),e._v(" "),e.course.note?r("p",[e._v("Note: "+e._s(e.course.note))]):e._e(),e._v(" "),r("b-button",{attrs:{size:"sm",variant:"primary"},on:{click:e.editCourse}},[e._v("Edit")])],1):e._e(),e._v(" "),"edit"==e.workMode?r("div",[r("p",{staticClass:"ml-2"},[e._v("\n            Teachers:\n            "),e.courseForm.teachers&&e.courseForm.teachers.length>0?r("span",e._l(e.courseForm.teachers,(function(t,o){return r("span",{key:t.id},[e._v("\n                    "+e._s(t.name)+"\n                    "),e.manager?r("b-link",{staticClass:"mr-3",on:{click:function(t){return e.removeUser("teachers",o)}}},[r("b-icon",{attrs:{icon:"x"}})],1):e._e()],1)})),0):e._e(),e._v(" "),e.manager?r("button",{staticClass:"ml-3",on:{click:function(t){return e.getUser("teachers")}}},[e._v("\n                Add\n            ")]):e._e()]),e._v(" "),r("p",{staticClass:"ml-2"},[e._v("\n            Assistants:\n            "),e.courseForm.assistants&&e.courseForm.assistants.length>0?r("span",e._l(e.courseForm.assistants,(function(t,o){return r("span",{key:t.id},[e._v("\n                    "+e._s(t.name)+"\n                    "),r("b-link",{staticClass:"mr-3",on:{click:function(t){return e.removeUser("assistants",o)}}},[r("b-icon",{attrs:{icon:"x"}})],1)],1)})),0):e._e(),e._v(" "),r("button",{staticClass:"ml-3",on:{click:function(t){return e.getUser("assistants")}}},[e._v("Add")])]),e._v(" "),r("b-input",{staticClass:"mb-3",attrs:{placeholder:"Name"},model:{value:e.courseForm.name,callback:function(t){e.$set(e.courseForm,"name",t)},expression:"courseForm.name"}}),e._v(" "),r("b-input",{staticClass:"mb-3",attrs:{placeholder:"School"},model:{value:e.courseForm.school,callback:function(t){e.$set(e.courseForm,"school",t)},expression:"courseForm.school"}}),e._v(" "),r("b-input",{staticClass:"mb-3",attrs:{placeholder:"Department"},model:{value:e.courseForm.dept,callback:function(t){e.$set(e.courseForm,"dept",t)},expression:"courseForm.dept"}}),e._v(" "),r("b-input",{staticClass:"mb-3",attrs:{placeholder:"enrollCode"},model:{value:e.courseForm.enrollCode,callback:function(t){e.$set(e.courseForm,"enrollCode",t)},expression:"courseForm.enrollCode"}}),e._v(" "),r("b-form-datepicker",{attrs:{placeholder:"Enroll Code Expired Date",locale:e.$user("locale"),"today-button":"","reset-button":"","close-button":""},model:{value:e.courseForm.codeExpiredDate,callback:function(t){e.$set(e.courseForm,"codeExpiredDate",t)},expression:"courseForm.codeExpiredDate"}}),e._v(" "),r("b-form-timepicker",{attrs:{placeholder:"Enroll Code Expired Time",locale:e.$user("locale"),"show-seconds":"","reset-button":"","close-button":""},model:{value:e.courseForm.codeExpiredTime,callback:function(t){e.$set(e.courseForm,"codeExpiredTime",t)},expression:"courseForm.codeExpiredTime"}}),e._v(" "),r("p",{staticClass:"my-3 ml-2"},[r("b-form-radio-group",{attrs:{options:[{value:!0,text:"Approval needed"},{value:!1,text:"No approval needed"}]},model:{value:e.courseForm.needApproval,callback:function(t){e.$set(e.courseForm,"needApproval",t)},expression:"courseForm.needApproval"}})],1),e._v(" "),r("b-form-datepicker",{attrs:{placeholder:"Course End Date",locale:e.$user("locale"),"today-button":"","reset-button":"","close-button":""},model:{value:e.courseForm.endDate,callback:function(t){e.$set(e.courseForm,"endDate",t)},expression:"courseForm.endDate"}}),e._v(" "),r("b-textarea",{staticClass:"mb-3",attrs:{placeholder:"White List",rows:"5"},model:{value:e.courseForm.whitelist,callback:function(t){e.$set(e.courseForm,"whitelist",t)},expression:"courseForm.whitelist"}}),e._v(" "),r("b-input",{staticClass:"mb-3",attrs:{placeholder:"Note"},model:{value:e.courseForm.note,callback:function(t){e.$set(e.courseForm,"note",t)},expression:"courseForm.note"}}),e._v(" "),r("b-button",{staticClass:"mr-3",attrs:{size:"sm",variant:"primary"},on:{click:e.cancel}},[e._v("Cancel")]),e._v(" "),r("b-button",{attrs:{size:"sm",variant:"primary"},on:{click:e.updateCourse}},[e._v("Update")])],1):e._e()],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{UserSelector:r(905).default})},851:function(e,t,r){"use strict";r(10),r(14),r(22),r(86),r(9),r(852),r(27),r(15);var o=r(227),n=r.n(o),c={pad:function(e){return("0"+e).slice(-2)},mmss:function(e){var t=Math.floor(e/60);return e%=60,"".concat(this.pad(t),":").concat(this.pad(e))},hhmmss:function(e){var t=Math.floor(e/60);e%=60;var r=Math.floor(t/60);return t%=60,"".concat(this.pad(r),":").concat(this.pad(t),":").concat(this.pad(e))},getToday:function(){var e=new Date,dd=String(e.getDate()).padStart(2,"0"),t=String(e.getMonth()+1).padStart(2,"0");return e.getFullYear()+t+dd},getNow:function(){var e=new Date;return""+e.getFullYear()+this.pad(e.getMonth()+1)+this.pad(e.getDate())+this.pad(e.getHours())+this.pad(e.getMinutes())+this.pad(e.getSeconds())},obj2arr:function(e){var t=[],r=Object.keys(e);return r.sort(),r.forEach((function(r){t.push(Object.assign({id:r},e[r]))})),t},arr2obj:function(e){var t={};return e.forEach((function(e){var r=JSON.parse(JSON.stringify(e)),o=e.id;delete r.id,t[o]=r})),t},getOptions:function(e){var t=[];return e.split("#@@#").forEach((function(e){var s=e.split("#@");t.push({text:s[0],value:s[1]})})),t},findIdPos:function(e,t){if(!e)return-1;for(var r=0;r<e.length;r++)if(t==e[r].id)return r;return-1},encode:function(e,t){return new n.a(e).encrypt(t)},decode:function(e,t){return new n.a(e).decrypt(t)}};t.a=c},852:function(e,t,r){"use strict";var o=r(8),n=r(853).start;o({target:"String",proto:!0,forced:r(854)},{padStart:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}})},853:function(e,t,r){var o=r(50),n=r(228),c=r(52),l=Math.ceil,d=function(e){return function(t,r,d){var m,h,v=String(c(t)),f=v.length,_=void 0===d?" ":String(d),x=o(r);return x<=f||""==_?v:(m=x-f,(h=n.call(_,l(m/_.length))).length>m&&(h=h.slice(0,m)),e?v+h:h+v)}};e.exports={start:d(!1),end:d(!0)}},854:function(e,t,r){var o=r(127);e.exports=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o)},905:function(e,t,r){"use strict";r.r(t);r(29),r(49);var o=r(7),n=r(32),c={data:function(){return{name:"",candidates:{}}},methods:{selectUser:function(e,t){var r={id:e,name:t.name};this.$emit("getUser",r)},searchUser:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r,o,i,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.name.length<2)){t.next=2;break}return t.abrupt("return");case 2:return r={},t.next=5,n.d.collection("users").where("name","==",e.name).get();case 5:if(!(o=t.sent).empty)for(i=0;i<o.docs.length;i++)c=o.docs[i],r[c.id]=c.data();e.candidates=r;case 8:case"end":return t.stop()}}),t)})))()}}},l=r(55),component=Object(l.a)(c,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("p",{attrs:{align:"center"}},[e._v("User name: \n        "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],staticClass:"ml-2",domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}}),e._v(" "),r("button",{attrs:{size:"sm",variant:"success"},on:{click:e.searchUser}},[e._v("Search")])]),e._v(" "),e._l(e.candidates,(function(t,o,n){return r("p",{key:t.id,attrs:{align:"center"}},[e._v("\n        "+e._s(n+1)+". "),r("b-link",{on:{click:function(r){return e.selectUser(o,t)}}},[e._v(e._s(t.name)+" - "+e._s(t.email))])],1)}))],2)}),[],!1,null,null,null);t.default=component.exports}}]);